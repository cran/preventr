<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Using preventr with a data frame</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Using preventr with a data frame</h1>


<div id="TOC">
<ul>
<li><a href="#using-use_dat-and-add_to_dat" id="toc-using-use_dat-and-add_to_dat">Using <code>use_dat</code> and
<code>add_to_dat</code></a>
<ul>
<li><a href="#our-first-call-using-use_dat" id="toc-our-first-call-using-use_dat">Our first call using
<code>use_dat</code></a></li>
<li><a href="#progress-bar" id="toc-progress-bar">Progress bar</a></li>
<li><a href="#passing-a-data-frame-with-a-predictor-variable-located-in-a-differently-named-column" id="toc-passing-a-data-frame-with-a-predictor-variable-located-in-a-differently-named-column">Passing
a data frame with a predictor variable located in a differently-named
column</a></li>
<li><a href="#optional-behavior-variables-data-frame-vs.-in-the-call" id="toc-optional-behavior-variables-data-frame-vs.-in-the-call">Optional
behavior variables: Data frame vs. in the call</a></li>
<li><a href="#number-of-rows-returned-for-a-given-input-row-number-of-models-requested" id="toc-number-of-rows-returned-for-a-given-input-row-number-of-models-requested">Number
of rows returned for a given input row = number of models
requested</a></li>
<li><a href="#add_to_dat" id="toc-add_to_dat"><code>add_to_dat</code></a></li>
<li><a href="#type-stability-of-return" id="toc-type-stability-of-return">Type-stability of return</a></li>
<li><a href="#what-about-the-pces" id="toc-what-about-the-pces">What
about the PCEs?</a></li>
<li><a href="#what-about-the-convenience-functions-for-egfr-and-bmi" id="toc-what-about-the-convenience-functions-for-egfr-and-bmi">What
about the convenience functions for eGFR and BMI?</a></li>
</ul></li>
<li><a href="#i-dont-want-to-use-use_dat-and-add_to_dat" id="toc-i-dont-want-to-use-use_dat-and-add_to_dat">I don’t want to use
<code>use_dat</code> and <code>add_to_dat</code></a>
<ul>
<li><a href="#then-dont" id="toc-then-dont">Then don’t!</a></li>
<li><a href="#lapply" id="toc-lapply"><code>lapply()</code></a></li>
<li><a href="#map" id="toc-map"><code>Map()</code></a></li>
<li><a href="#purrrpmap" id="toc-purrrpmap"><code>purrr::pmap()</code></a></li>
</ul></li>
<li><a href="#wrap-up" id="toc-wrap-up">Wrap-up</a></li>
</ul>
</div>

<style type="text/css">

.row>main {
overflow-wrap:normal;
hyphens:none;
}
</style>
<p>This vignette shows how you can use a data frame with
<code>preventr</code>. This has always been possible since the inception
of <code>preventr</code>, but things became more convenient with the
introduction of the <code>use_dat</code> and <code>add_to_dat</code>
arguments for the functions <code>estimate_risk()</code> and its synonym
<code>est_risk()</code> in version 0.11. Hereafter, this vignette will
use <code>est_risk()</code>. This vignette also assumes the reader has
already read the relevant documentation for <code>est_risk()</code>,
especially pertaining to arguments <code>use_dat</code> and
<code>add_to_dat</code>.</p>
<div id="using-use_dat-and-add_to_dat" class="section level2">
<h2>Using <code>use_dat</code> and <code>add_to_dat</code></h2>
<p>Let’s start by defining some data to use.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>make_vignette_dat <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">10</span>, <span class="at">add_time_and_model =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>    <span class="co"># I am specifying `age`, `sex`, `egfr`, and `bmi` manually while letting</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>    <span class="co"># other parameters vary via `sample()` to facilitate later aspects of this</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>    <span class="co"># vignette (to show identical results from approaches I show below).</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>    <span class="at">age =</span> <span class="fu">c</span>(<span class="dv">40</span>, <span class="dv">55</span>, <span class="dv">45</span>, <span class="dv">51</span>, <span class="dv">52</span>, <span class="dv">58</span>, <span class="dv">57</span>, <span class="dv">36</span>, <span class="dv">49</span>, <span class="dv">47</span>),</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>    <span class="at">sex =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;female&quot;</span>, <span class="st">&quot;male&quot;</span>), <span class="dv">5</span>),</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>    <span class="at">sbp =</span> <span class="fu">sample</span>(<span class="dv">90</span><span class="sc">:</span><span class="dv">180</span>, n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    <span class="at">bp_tx =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>    <span class="at">total_c =</span> <span class="fu">sample</span>(<span class="dv">130</span><span class="sc">:</span><span class="dv">320</span>, n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>    <span class="at">hdl_c =</span> <span class="fu">sample</span>(<span class="dv">20</span><span class="sc">:</span><span class="dv">100</span>, n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>    <span class="at">statin =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>    <span class="at">dm =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>    <span class="at">smoking =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>    <span class="at">egfr =</span> <span class="fu">c</span>(<span class="dv">73</span>, <span class="dv">71</span>, <span class="dv">80</span>, <span class="dv">73</span>, <span class="dv">77</span>, <span class="dv">70</span>, <span class="dv">86</span>, <span class="dv">89</span>, <span class="dv">78</span>, <span class="dv">68</span>),</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>    <span class="at">bmi =</span> <span class="fu">c</span>(<span class="fl">37.4</span>, <span class="fl">32.9</span>, <span class="fl">37.5</span>, <span class="fl">28.6</span>, <span class="fl">37.5</span>, <span class="fl">36.0</span>, <span class="fl">36.7</span>, <span class="fl">28.6</span>, <span class="fl">18.7</span>, <span class="fl">38.6</span>),</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>    <span class="at">hba1c =</span> <span class="fu">sample</span>(</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>      <span class="co"># I want to ensure NAs are equally represented in the sample space,</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>      <span class="co"># hence the composition shown below.</span></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>      <span class="fu">c</span>(</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>        <span class="fu">seq</span>(<span class="fl">4.5</span>, <span class="dv">15</span>, <span class="fl">0.1</span>), </span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>        <span class="fu">rep</span>(<span class="cn">NA_real_</span>, <span class="fu">length</span>(<span class="fu">seq</span>(<span class="fl">4.5</span>, <span class="dv">15</span>, <span class="fl">0.1</span>)))</span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>      ), </span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a>      n, </span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>      <span class="at">replace =</span> <span class="cn">TRUE</span></span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a>    ),</span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a>    <span class="at">uacr =</span> <span class="fu">sample</span>(</span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a>      <span class="fu">c</span>(</span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a>        <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="dv">25000</span>, <span class="fl">0.1</span>), </span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a>        <span class="fu">rep</span>(<span class="cn">NA_real_</span>, <span class="fu">length</span>(<span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="dv">25000</span>, <span class="fl">0.1</span>)))</span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a>      ), </span>
<span id="cb1-32"><a href="#cb1-32" tabindex="-1"></a>      n, </span>
<span id="cb1-33"><a href="#cb1-33" tabindex="-1"></a>      <span class="at">replace =</span> <span class="cn">TRUE</span></span>
<span id="cb1-34"><a href="#cb1-34" tabindex="-1"></a>    ),</span>
<span id="cb1-35"><a href="#cb1-35" tabindex="-1"></a>    <span class="at">zip =</span> <span class="fu">sample</span>(</span>
<span id="cb1-36"><a href="#cb1-36" tabindex="-1"></a>      <span class="co"># (random sample of valid zips)</span></span>
<span id="cb1-37"><a href="#cb1-37" tabindex="-1"></a>      <span class="fu">c</span>(</span>
<span id="cb1-38"><a href="#cb1-38" tabindex="-1"></a>        <span class="st">&quot;01518&quot;</span>, <span class="st">&quot;33321&quot;</span>, <span class="st">&quot;85206&quot;</span>, <span class="st">&quot;98591&quot;</span>, <span class="st">&quot;29138&quot;</span>, </span>
<span id="cb1-39"><a href="#cb1-39" tabindex="-1"></a>        <span class="st">&quot;98101&quot;</span>, <span class="st">&quot;44124&quot;</span>, <span class="st">&quot;48708&quot;</span>, <span class="st">&quot;48206&quot;</span>, <span class="st">&quot;77642&quot;</span>, </span>
<span id="cb1-40"><a href="#cb1-40" tabindex="-1"></a>        <span class="fu">rep</span>(<span class="cn">NA_character_</span>, n)</span>
<span id="cb1-41"><a href="#cb1-41" tabindex="-1"></a>      ), </span>
<span id="cb1-42"><a href="#cb1-42" tabindex="-1"></a>      n, </span>
<span id="cb1-43"><a href="#cb1-43" tabindex="-1"></a>      <span class="at">replace =</span> <span class="cn">TRUE</span></span>
<span id="cb1-44"><a href="#cb1-44" tabindex="-1"></a>    )</span>
<span id="cb1-45"><a href="#cb1-45" tabindex="-1"></a>  )</span>
<span id="cb1-46"><a href="#cb1-46" tabindex="-1"></a>  </span>
<span id="cb1-47"><a href="#cb1-47" tabindex="-1"></a>  <span class="cf">if</span>(add_time_and_model) {</span>
<span id="cb1-48"><a href="#cb1-48" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span> </span>
<span id="cb1-49"><a href="#cb1-49" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb1-50"><a href="#cb1-50" tabindex="-1"></a>        <span class="co"># I use `rep(&quot;both&quot;, 2)` for `time` because I want that option to have a</span></span>
<span id="cb1-51"><a href="#cb1-51" tabindex="-1"></a>        <span class="co"># higher chance of being selected for this example.</span></span>
<span id="cb1-52"><a href="#cb1-52" tabindex="-1"></a>        <span class="at">time =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;10yr&quot;</span>, <span class="st">&quot;30yr&quot;</span>, <span class="fu">rep</span>(<span class="st">&quot;both&quot;</span>, <span class="dv">2</span>)), n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-53"><a href="#cb1-53" tabindex="-1"></a>        <span class="at">model =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;base&quot;</span>, <span class="st">&quot;hba1c&quot;</span>, <span class="st">&quot;uacr&quot;</span>, <span class="st">&quot;sdi&quot;</span>, <span class="st">&quot;full&quot;</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-54"><a href="#cb1-54" tabindex="-1"></a>      )</span>
<span id="cb1-55"><a href="#cb1-55" tabindex="-1"></a>  }</span>
<span id="cb1-56"><a href="#cb1-56" tabindex="-1"></a>  </span>
<span id="cb1-57"><a href="#cb1-57" tabindex="-1"></a>  dat</span>
<span id="cb1-58"><a href="#cb1-58" tabindex="-1"></a>}</span>
<span id="cb1-59"><a href="#cb1-59" tabindex="-1"></a></span>
<span id="cb1-60"><a href="#cb1-60" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">make_vignette_dat</span>()</span>
<span id="cb1-61"><a href="#cb1-61" tabindex="-1"></a></span>
<span id="cb1-62"><a href="#cb1-62" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(dat)</span></code></pre></div>
<table>
<colgroup>
<col width="4%" />
<col width="8%" />
<col width="4%" />
<col width="6%" />
<col width="9%" />
<col width="6%" />
<col width="8%" />
<col width="6%" />
<col width="9%" />
<col width="5%" />
<col width="5%" />
<col width="6%" />
<col width="9%" />
<col width="6%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">age</th>
<th align="left">sex</th>
<th align="right">sbp</th>
<th align="left">bp_tx</th>
<th align="right">total_c</th>
<th align="right">hdl_c</th>
<th align="left">statin</th>
<th align="left">dm</th>
<th align="left">smoking</th>
<th align="right">egfr</th>
<th align="right">bmi</th>
<th align="right">hba1c</th>
<th align="right">uacr</th>
<th align="left">zip</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">40</td>
<td align="left">female</td>
<td align="right">90</td>
<td align="left">TRUE</td>
<td align="right">176</td>
<td align="right">45</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">73</td>
<td align="right">37.4</td>
<td align="right">5.3</td>
<td align="right">8373.1</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">55</td>
<td align="left">male</td>
<td align="right">125</td>
<td align="left">TRUE</td>
<td align="right">190</td>
<td align="right">94</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">71</td>
<td align="right">32.9</td>
<td align="right">NA</td>
<td align="right">13187.1</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">45</td>
<td align="left">female</td>
<td align="right">94</td>
<td align="left">TRUE</td>
<td align="right">171</td>
<td align="right">55</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">80</td>
<td align="right">37.5</td>
<td align="right">NA</td>
<td align="right">6484.9</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">51</td>
<td align="left">male</td>
<td align="right">171</td>
<td align="left">FALSE</td>
<td align="right">229</td>
<td align="right">26</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">73</td>
<td align="right">28.6</td>
<td align="right">13.4</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">52</td>
<td align="left">female</td>
<td align="right">128</td>
<td align="left">TRUE</td>
<td align="right">167</td>
<td align="right">77</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">77</td>
<td align="right">37.5</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">58</td>
<td align="left">male</td>
<td align="right">126</td>
<td align="left">FALSE</td>
<td align="right">241</td>
<td align="right">85</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">70</td>
<td align="right">36.0</td>
<td align="right">NA</td>
<td align="right">2751.9</td>
<td align="left">01518</td>
</tr>
<tr class="odd">
<td align="right">57</td>
<td align="left">female</td>
<td align="right">126</td>
<td align="left">TRUE</td>
<td align="right">148</td>
<td align="right">83</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">86</td>
<td align="right">36.7</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">01518</td>
</tr>
<tr class="even">
<td align="right">36</td>
<td align="left">male</td>
<td align="right">127</td>
<td align="left">FALSE</td>
<td align="right">247</td>
<td align="right">77</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">89</td>
<td align="right">28.6</td>
<td align="right">NA</td>
<td align="right">18194.1</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">49</td>
<td align="left">female</td>
<td align="right">178</td>
<td align="left">TRUE</td>
<td align="right">289</td>
<td align="right">68</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">78</td>
<td align="right">18.7</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">47</td>
<td align="left">male</td>
<td align="right">178</td>
<td align="left">TRUE</td>
<td align="right">305</td>
<td align="right">30</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">68</td>
<td align="right">38.6</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">77642</td>
</tr>
</tbody>
</table>
<div id="our-first-call-using-use_dat" class="section level3">
<h3>Our first call using <code>use_dat</code></h3>
<p>In the call below to <code>est_risk()</code>, because (1)
<code>dat</code> does not contain any columns for optional behavior
variables and (2) the call omits optional behavior variable arguments
aside from <code>progress = FALSE</code>, the optional behavior
variables will take their default values.</p>
<p>Note also the first column in the return table is
<code>preventr_id</code>. This is a unique identifier for each row of
the input data frame passed to <code>use_dat</code>. In this case, each
row of the return data frame has 2 rows; this is expected, because we
did not pass anything to arguments <code>time</code> or
<code>model</code> in the call to <code>est_risk()</code>. They thus
take their default values of <code>time = &quot;both&quot;</code> and
<code>model = NULL</code>, with the latter meaning
<code>est_risk()</code> will automatically select the model based on the
input.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">est_risk</span>(<span class="at">use_dat =</span> dat, <span class="at">progress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(res)</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="6%" />
<col width="2%" />
<col width="4%" />
<col width="2%" />
<col width="3%" />
<col width="4%" />
<col width="3%" />
<col width="4%" />
<col width="3%" />
<col width="4%" />
<col width="2%" />
<col width="2%" />
<col width="3%" />
<col width="4%" />
<col width="3%" />
<col width="5%" />
<col width="3%" />
<col width="8%" />
<col width="3%" />
<col width="4%" />
<col width="3%" />
<col width="6%" />
<col width="8%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">preventr_id</th>
<th align="right">age</th>
<th align="left">sex</th>
<th align="right">sbp</th>
<th align="left">bp_tx</th>
<th align="right">total_c</th>
<th align="right">hdl_c</th>
<th align="left">statin</th>
<th align="left">dm</th>
<th align="left">smoking</th>
<th align="right">egfr</th>
<th align="right">bmi</th>
<th align="right">hba1c</th>
<th align="right">uacr</th>
<th align="left">zip</th>
<th align="right">total_cvd</th>
<th align="right">ascvd</th>
<th align="right">heart_failure</th>
<th align="right">chd</th>
<th align="right">stroke</th>
<th align="left">model</th>
<th align="right">over_years</th>
<th align="left">input_problems</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">40</td>
<td align="left">female</td>
<td align="right">90</td>
<td align="left">TRUE</td>
<td align="right">176</td>
<td align="right">45</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">73</td>
<td align="right">37.4</td>
<td align="right">5.3</td>
<td align="right">8373.1</td>
<td align="left">NA</td>
<td align="right">0.044</td>
<td align="right">0.018</td>
<td align="right">0.033</td>
<td align="right">0.008</td>
<td align="right">0.010</td>
<td align="left">full</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">40</td>
<td align="left">female</td>
<td align="right">90</td>
<td align="left">TRUE</td>
<td align="right">176</td>
<td align="right">45</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">73</td>
<td align="right">37.4</td>
<td align="right">5.3</td>
<td align="right">8373.1</td>
<td align="left">NA</td>
<td align="right">0.189</td>
<td align="right">0.079</td>
<td align="right">0.167</td>
<td align="right">0.038</td>
<td align="right">0.044</td>
<td align="left">full</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">55</td>
<td align="left">male</td>
<td align="right">125</td>
<td align="left">TRUE</td>
<td align="right">190</td>
<td align="right">94</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">71</td>
<td align="right">32.9</td>
<td align="right">NA</td>
<td align="right">13187.1</td>
<td align="left">NA</td>
<td align="right">0.145</td>
<td align="right">0.064</td>
<td align="right">0.186</td>
<td align="right">0.024</td>
<td align="right">0.052</td>
<td align="left">uacr</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">55</td>
<td align="left">male</td>
<td align="right">125</td>
<td align="left">TRUE</td>
<td align="right">190</td>
<td align="right">94</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">71</td>
<td align="right">32.9</td>
<td align="right">NA</td>
<td align="right">13187.1</td>
<td align="left">NA</td>
<td align="right">0.348</td>
<td align="right">0.166</td>
<td align="right">0.435</td>
<td align="right">0.067</td>
<td align="right">0.136</td>
<td align="left">uacr</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">45</td>
<td align="left">female</td>
<td align="right">94</td>
<td align="left">TRUE</td>
<td align="right">171</td>
<td align="right">55</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">80</td>
<td align="right">37.5</td>
<td align="right">NA</td>
<td align="right">6484.9</td>
<td align="left">NA</td>
<td align="right">0.050</td>
<td align="right">0.021</td>
<td align="right">0.050</td>
<td align="right">0.010</td>
<td align="right">0.012</td>
<td align="left">uacr</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">45</td>
<td align="left">female</td>
<td align="right">94</td>
<td align="left">TRUE</td>
<td align="right">171</td>
<td align="right">55</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">80</td>
<td align="right">37.5</td>
<td align="right">NA</td>
<td align="right">6484.9</td>
<td align="left">NA</td>
<td align="right">0.219</td>
<td align="right">0.093</td>
<td align="right">0.244</td>
<td align="right">0.046</td>
<td align="right">0.054</td>
<td align="left">uacr</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">51</td>
<td align="left">male</td>
<td align="right">171</td>
<td align="left">FALSE</td>
<td align="right">229</td>
<td align="right">26</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">73</td>
<td align="right">28.6</td>
<td align="right">13.4</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">0.351</td>
<td align="right">0.253</td>
<td align="right">0.185</td>
<td align="right">0.206</td>
<td align="right">0.090</td>
<td align="left">hba1c</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">51</td>
<td align="left">male</td>
<td align="right">171</td>
<td align="left">FALSE</td>
<td align="right">229</td>
<td align="right">26</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">73</td>
<td align="right">28.6</td>
<td align="right">13.4</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">0.688</td>
<td align="right">0.537</td>
<td align="right">0.518</td>
<td align="right">0.465</td>
<td align="right">0.242</td>
<td align="left">hba1c</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">52</td>
<td align="left">female</td>
<td align="right">128</td>
<td align="left">TRUE</td>
<td align="right">167</td>
<td align="right">77</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">77</td>
<td align="right">37.5</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">0.061</td>
<td align="right">0.031</td>
<td align="right">0.068</td>
<td align="right">0.012</td>
<td align="right">0.022</td>
<td align="left">base</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">52</td>
<td align="left">female</td>
<td align="right">128</td>
<td align="left">TRUE</td>
<td align="right">167</td>
<td align="right">77</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">77</td>
<td align="right">37.5</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">0.291</td>
<td align="right">0.147</td>
<td align="right">0.345</td>
<td align="right">0.063</td>
<td align="right">0.099</td>
<td align="left">base</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">6</td>
<td align="right">58</td>
<td align="left">male</td>
<td align="right">126</td>
<td align="left">FALSE</td>
<td align="right">241</td>
<td align="right">85</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">70</td>
<td align="right">36.0</td>
<td align="right">NA</td>
<td align="right">2751.9</td>
<td align="left">01518</td>
<td align="right">0.177</td>
<td align="right">0.093</td>
<td align="right">0.181</td>
<td align="right">0.048</td>
<td align="right">0.049</td>
<td align="left">full</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">58</td>
<td align="left">male</td>
<td align="right">126</td>
<td align="left">FALSE</td>
<td align="right">241</td>
<td align="right">85</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">70</td>
<td align="right">36.0</td>
<td align="right">NA</td>
<td align="right">2751.9</td>
<td align="left">01518</td>
<td align="right">0.382</td>
<td align="right">0.212</td>
<td align="right">0.417</td>
<td align="right">0.119</td>
<td align="right">0.118</td>
<td align="left">full</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">57</td>
<td align="left">female</td>
<td align="right">126</td>
<td align="left">TRUE</td>
<td align="right">148</td>
<td align="right">83</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">86</td>
<td align="right">36.7</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">01518</td>
<td align="right">0.064</td>
<td align="right">0.032</td>
<td align="right">0.069</td>
<td align="right">0.012</td>
<td align="right">0.022</td>
<td align="left">sdi</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">7</td>
<td align="right">57</td>
<td align="left">female</td>
<td align="right">126</td>
<td align="left">TRUE</td>
<td align="right">148</td>
<td align="right">83</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">86</td>
<td align="right">36.7</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">01518</td>
<td align="right">0.265</td>
<td align="right">0.130</td>
<td align="right">0.315</td>
<td align="right">0.054</td>
<td align="right">0.090</td>
<td align="left">sdi</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">8</td>
<td align="right">36</td>
<td align="left">male</td>
<td align="right">127</td>
<td align="left">FALSE</td>
<td align="right">247</td>
<td align="right">77</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">89</td>
<td align="right">28.6</td>
<td align="right">NA</td>
<td align="right">18194.1</td>
<td align="left">NA</td>
<td align="right">0.059</td>
<td align="right">0.032</td>
<td align="right">0.033</td>
<td align="right">0.013</td>
<td align="right">0.019</td>
<td align="left">uacr</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">36</td>
<td align="left">male</td>
<td align="right">127</td>
<td align="left">FALSE</td>
<td align="right">247</td>
<td align="right">77</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">89</td>
<td align="right">28.6</td>
<td align="right">NA</td>
<td align="right">18194.1</td>
<td align="left">NA</td>
<td align="right">0.201</td>
<td align="right">0.112</td>
<td align="right">0.141</td>
<td align="right">0.051</td>
<td align="right">0.068</td>
<td align="left">uacr</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">49</td>
<td align="left">female</td>
<td align="right">178</td>
<td align="left">TRUE</td>
<td align="right">289</td>
<td align="right">68</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">78</td>
<td align="right">18.7</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">0.120</td>
<td align="right">0.088</td>
<td align="right">0.046</td>
<td align="right">0.039</td>
<td align="right">0.051</td>
<td align="left">base</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">9</td>
<td align="right">49</td>
<td align="left">female</td>
<td align="right">178</td>
<td align="left">TRUE</td>
<td align="right">289</td>
<td align="right">68</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">78</td>
<td align="right">18.7</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">0.485</td>
<td align="right">0.359</td>
<td align="right">0.239</td>
<td align="right">0.190</td>
<td align="right">0.224</td>
<td align="left">base</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">10</td>
<td align="right">47</td>
<td align="left">male</td>
<td align="right">178</td>
<td align="left">TRUE</td>
<td align="right">305</td>
<td align="right">30</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">68</td>
<td align="right">38.6</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">77642</td>
<td align="right">0.217</td>
<td align="right">0.179</td>
<td align="right">0.112</td>
<td align="right">0.141</td>
<td align="right">0.056</td>
<td align="left">sdi</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">47</td>
<td align="left">male</td>
<td align="right">178</td>
<td align="left">TRUE</td>
<td align="right">305</td>
<td align="right">30</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">68</td>
<td align="right">38.6</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">77642</td>
<td align="right">0.636</td>
<td align="right">0.546</td>
<td align="right">0.445</td>
<td align="right">0.471</td>
<td align="right">0.233</td>
<td align="left">sdi</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
</div>
<div id="progress-bar" class="section level3">
<h3>Progress bar</h3>
<p>Because some data frames may be large, <code>est_risk()</code> now
has a progress bar that will automatically show (unless
<code>progress = FALSE</code>) when <code>use_dat</code> is a data
frame. This is independent of the <code>quiet</code> argument. The
progress bar requires the <code>utils</code> package, but this is part
of the R distribution, so outside of unusual situations, you should not
need to install it yourself. The code below will not actually execute in
this vignette because the progress bar is intended for the console. I
include it below simply for demonstration.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># The default for `progress` when `use_dat` is a data frame is `TRUE`, so this</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co"># call would yield a progress bar during computation.</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>res_for_prog_bar <span class="ot">&lt;-</span> <span class="fu">est_risk</span>(<span class="at">use_dat =</span> dat)</span></code></pre></div>
</div>
<div id="passing-a-data-frame-with-a-predictor-variable-located-in-a-differently-named-column" class="section level3">
<h3>Passing a data frame with a predictor variable located in a
differently-named column</h3>
<p>You can pass a data frame with a predictor variable located in a
differently-named column, and the column can be specified as a character
string or symbol.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>dat_age_rename <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">years_old =</span> age)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>res_age_rename_sym <span class="ot">&lt;-</span> <span class="fu">est_risk</span>(</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  <span class="at">use_dat =</span> dat_age_rename, </span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  <span class="at">age =</span> years_old, </span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>  <span class="at">progress =</span> <span class="cn">FALSE</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>)</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>res_age_rename_chr <span class="ot">&lt;-</span> <span class="fu">est_risk</span>(</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>  <span class="at">use_dat =</span> dat_age_rename, </span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>  <span class="at">age =</span> <span class="st">&quot;years_old&quot;</span>, </span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>  <span class="at">progress =</span> <span class="cn">FALSE</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>)</span></code></pre></div>
<p>The following two tests will be <code>FALSE</code>, because the
column names housing the age data differ.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">identical</span>(res, res_age_rename_sym) </span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="fu">identical</span>(res, res_age_rename_chr)</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>But all of these will be <code>TRUE</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">identical</span>(</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  res <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>age),</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  res_age_rename_sym <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>years_old)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>)</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="fu">identical</span>(</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>  res <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>age),</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>  res_age_rename_chr <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>years_old)</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>)</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="fu">identical</span>(res_age_rename_sym, res_age_rename_chr)</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>And thus, if we rename the <code>years_old</code> columns …</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>res_age_rename_sym <span class="ot">&lt;-</span> res_age_rename_sym <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">age =</span> years_old)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>res_age_rename_chr <span class="ot">&lt;-</span> res_age_rename_chr <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">age =</span> years_old)</span></code></pre></div>
<p>… everything will be identical.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">identical</span>(res, res_age_rename_sym) </span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="fu">identical</span>(res, res_age_rename_chr)</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<div id="optional-behavior-variables-data-frame-vs.-in-the-call" class="section level3">
<h3>Optional behavior variables: Data frame vs. in the call</h3>
<p>You can also pass optional behavior variables via the data frame. As
a reminder, optional behavior variables may <em>either</em> be in the
data frame passed to <code>use_dat</code> in a column with the same name
as the argument <em>or</em> passed to the function call as usual. If an
optional behavior variable is omitted from the call when a user passes a
data frame to <code>use_dat</code>, the function will first look for a
column with the name of the optional behavior variable in the data
frame; if it does not find such a column, it will use the default
behavior for the optional behavior variable. If the user includes an
argument for an optional behavior variable in the call, the function
will always use this, irrespective of any column in the data frame that
might share the same name. Additionally, the following arguments are not
passable via the data frame: <code>collapse</code> (ignored when
<code>use_dat</code> is a data frame), <code>use_dat</code> (this would
be self-referential), <code>add_to_dat</code> (again, essentially
self-referential), and <code>progress</code> (this applies to the entire
call when <code>use_dat</code> is a data frame).</p>
<p>In what follows, I will show <code>time</code> and
<code>model</code>, but you could also pass, for example,
<code>optional_strict</code> or <code>quiet</code> if you wanted.
Passing optional behavior variables via the data frame is likely most
useful when you wish for <code>est_risk()</code>’s behavior to vary
across rows within the data frame passed to <code>use_dat</code>.
Otherwise, if you desire the same behavior for the entirety of the call
to <code>est_risk()</code>, it is likely easier to pass the optional
behavior variables in the call to <code>est_risk()</code> (or pass
nothing to those arguments if you just want the default behavior).</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>dat_time_model <span class="ot">&lt;-</span> <span class="fu">make_vignette_dat</span>(<span class="at">add_time_and_model =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>res_time_model_in_dat <span class="ot">&lt;-</span> <span class="fu">est_risk</span>(<span class="at">use_dat =</span> dat_time_model, <span class="at">progress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(res_time_model_in_dat)</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="6%" />
<col width="2%" />
<col width="3%" />
<col width="2%" />
<col width="3%" />
<col width="4%" />
<col width="3%" />
<col width="3%" />
<col width="3%" />
<col width="4%" />
<col width="2%" />
<col width="2%" />
<col width="3%" />
<col width="4%" />
<col width="3%" />
<col width="2%" />
<col width="6%" />
<col width="5%" />
<col width="3%" />
<col width="7%" />
<col width="3%" />
<col width="3%" />
<col width="3%" />
<col width="5%" />
<col width="7%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">preventr_id</th>
<th align="right">age</th>
<th align="left">sex</th>
<th align="right">sbp</th>
<th align="left">bp_tx</th>
<th align="right">total_c</th>
<th align="right">hdl_c</th>
<th align="left">statin</th>
<th align="left">dm</th>
<th align="left">smoking</th>
<th align="right">egfr</th>
<th align="right">bmi</th>
<th align="right">hba1c</th>
<th align="right">uacr</th>
<th align="left">zip</th>
<th align="left">time</th>
<th align="left">model_input</th>
<th align="right">total_cvd</th>
<th align="right">ascvd</th>
<th align="right">heart_failure</th>
<th align="right">chd</th>
<th align="right">stroke</th>
<th align="left">model</th>
<th align="right">over_years</th>
<th align="left">input_problems</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">40</td>
<td align="left">female</td>
<td align="right">153</td>
<td align="left">FALSE</td>
<td align="right">204</td>
<td align="right">80</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">73</td>
<td align="right">37.4</td>
<td align="right">4.6</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">sdi</td>
<td align="right">0.042</td>
<td align="right">0.028</td>
<td align="right">0.049</td>
<td align="right">0.010</td>
<td align="right">0.020</td>
<td align="left">sdi</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">40</td>
<td align="left">female</td>
<td align="right">153</td>
<td align="left">FALSE</td>
<td align="right">204</td>
<td align="right">80</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">73</td>
<td align="right">37.4</td>
<td align="right">4.6</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">sdi</td>
<td align="right">0.238</td>
<td align="right">0.147</td>
<td align="right">0.295</td>
<td align="right">0.057</td>
<td align="right">0.104</td>
<td align="left">sdi</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">55</td>
<td align="left">male</td>
<td align="right">156</td>
<td align="left">FALSE</td>
<td align="right">282</td>
<td align="right">67</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">71</td>
<td align="right">32.9</td>
<td align="right">12.2</td>
<td align="right">23040.0</td>
<td align="left">48708</td>
<td align="left">10yr</td>
<td align="left">uacr</td>
<td align="right">0.317</td>
<td align="right">0.204</td>
<td align="right">0.244</td>
<td align="right">0.117</td>
<td align="right">0.107</td>
<td align="left">uacr</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">45</td>
<td align="left">female</td>
<td align="right">172</td>
<td align="left">FALSE</td>
<td align="right">276</td>
<td align="right">91</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">80</td>
<td align="right">37.5</td>
<td align="right">7.1</td>
<td align="right">NA</td>
<td align="left">98591</td>
<td align="left">both</td>
<td align="left">hba1c</td>
<td align="right">0.115</td>
<td align="right">0.077</td>
<td align="right">0.143</td>
<td align="right">0.034</td>
<td align="right">0.047</td>
<td align="left">hba1c</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">45</td>
<td align="left">female</td>
<td align="right">172</td>
<td align="left">FALSE</td>
<td align="right">276</td>
<td align="right">91</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">80</td>
<td align="right">37.5</td>
<td align="right">7.1</td>
<td align="right">NA</td>
<td align="left">98591</td>
<td align="left">both</td>
<td align="left">hba1c</td>
<td align="right">0.440</td>
<td align="right">0.294</td>
<td align="right">0.528</td>
<td align="right">0.150</td>
<td align="right">0.186</td>
<td align="left">hba1c</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">51</td>
<td align="left">male</td>
<td align="right">169</td>
<td align="left">TRUE</td>
<td align="right">177</td>
<td align="right">88</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">73</td>
<td align="right">28.6</td>
<td align="right">NA</td>
<td align="right">13289.2</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">uacr</td>
<td align="right">0.305</td>
<td align="right">0.144</td>
<td align="right">0.288</td>
<td align="right">0.049</td>
<td align="right">0.146</td>
<td align="left">uacr</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">51</td>
<td align="left">male</td>
<td align="right">169</td>
<td align="left">TRUE</td>
<td align="right">177</td>
<td align="right">88</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">73</td>
<td align="right">28.6</td>
<td align="right">NA</td>
<td align="right">13289.2</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">uacr</td>
<td align="right">0.565</td>
<td align="right">0.313</td>
<td align="right">0.592</td>
<td align="right">0.120</td>
<td align="right">0.309</td>
<td align="left">uacr</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">52</td>
<td align="left">female</td>
<td align="right">160</td>
<td align="left">TRUE</td>
<td align="right">241</td>
<td align="right">95</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">77</td>
<td align="right">37.5</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">33321</td>
<td align="left">both</td>
<td align="left">full</td>
<td align="right">0.031</td>
<td align="right">0.022</td>
<td align="right">0.035</td>
<td align="right">0.008</td>
<td align="right">0.015</td>
<td align="left">full</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">52</td>
<td align="left">female</td>
<td align="right">160</td>
<td align="left">TRUE</td>
<td align="right">241</td>
<td align="right">95</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">77</td>
<td align="right">37.5</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">33321</td>
<td align="left">both</td>
<td align="left">full</td>
<td align="right">0.192</td>
<td align="right">0.125</td>
<td align="right">0.229</td>
<td align="right">0.049</td>
<td align="right">0.084</td>
<td align="left">full</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">58</td>
<td align="left">male</td>
<td align="right">171</td>
<td align="left">FALSE</td>
<td align="right">175</td>
<td align="right">36</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">70</td>
<td align="right">36.0</td>
<td align="right">13.9</td>
<td align="right">9073.3</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">hba1c</td>
<td align="right">0.444</td>
<td align="right">0.295</td>
<td align="right">0.444</td>
<td align="right">0.206</td>
<td align="right">0.143</td>
<td align="left">hba1c</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">6</td>
<td align="right">58</td>
<td align="left">male</td>
<td align="right">171</td>
<td align="left">FALSE</td>
<td align="right">175</td>
<td align="right">36</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">70</td>
<td align="right">36.0</td>
<td align="right">13.9</td>
<td align="right">9073.3</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">hba1c</td>
<td align="right">0.678</td>
<td align="right">0.487</td>
<td align="right">0.668</td>
<td align="right">0.368</td>
<td align="right">0.267</td>
<td align="left">hba1c</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">7</td>
<td align="right">57</td>
<td align="left">female</td>
<td align="right">95</td>
<td align="left">TRUE</td>
<td align="right">152</td>
<td align="right">64</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">86</td>
<td align="right">36.7</td>
<td align="right">5.6</td>
<td align="right">NA</td>
<td align="left">77642</td>
<td align="left">30yr</td>
<td align="left">full</td>
<td align="right">0.191</td>
<td align="right">0.085</td>
<td align="right">0.188</td>
<td align="right">0.038</td>
<td align="right">0.055</td>
<td align="left">full</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">8</td>
<td align="right">36</td>
<td align="left">male</td>
<td align="right">175</td>
<td align="left">TRUE</td>
<td align="right">261</td>
<td align="right">82</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">89</td>
<td align="right">28.6</td>
<td align="right">6.2</td>
<td align="right">4523.9</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">uacr</td>
<td align="right">0.154</td>
<td align="right">0.084</td>
<td align="right">0.098</td>
<td align="right">0.031</td>
<td align="right">0.065</td>
<td align="left">uacr</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">36</td>
<td align="left">male</td>
<td align="right">175</td>
<td align="left">TRUE</td>
<td align="right">261</td>
<td align="right">82</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">89</td>
<td align="right">28.6</td>
<td align="right">6.2</td>
<td align="right">4523.9</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">uacr</td>
<td align="right">0.428</td>
<td align="right">0.255</td>
<td align="right">0.340</td>
<td align="right">0.106</td>
<td align="right">0.203</td>
<td align="left">uacr</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">49</td>
<td align="left">female</td>
<td align="right">121</td>
<td align="left">TRUE</td>
<td align="right">217</td>
<td align="right">50</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">78</td>
<td align="right">18.7</td>
<td align="right">NA</td>
<td align="right">6996.0</td>
<td align="left">NA</td>
<td align="left">30yr</td>
<td align="left">uacr</td>
<td align="right">0.433</td>
<td align="right">0.242</td>
<td align="right">0.268</td>
<td align="right">0.146</td>
<td align="right">0.128</td>
<td align="left">uacr</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">47</td>
<td align="left">male</td>
<td align="right">160</td>
<td align="left">FALSE</td>
<td align="right">269</td>
<td align="right">45</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">68</td>
<td align="right">38.6</td>
<td align="right">14.0</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">sdi</td>
<td align="right">0.078</td>
<td align="right">0.059</td>
<td align="right">0.034</td>
<td align="right">0.038</td>
<td align="right">0.022</td>
<td align="left">sdi</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">10</td>
<td align="right">47</td>
<td align="left">male</td>
<td align="right">160</td>
<td align="left">FALSE</td>
<td align="right">269</td>
<td align="right">45</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">68</td>
<td align="right">38.6</td>
<td align="right">14.0</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">sdi</td>
<td align="right">0.422</td>
<td align="right">0.319</td>
<td align="right">0.226</td>
<td align="right">0.229</td>
<td align="right">0.137</td>
<td align="left">sdi</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>Because the input data frame in the above call to
<code>est_risk()</code> has a column named <code>model</code>,
<code>est_risk()</code> will rename this column to
<code>model_input</code> in the return data frame. This is to
accommodate the return data frame also needing to specify the
<code>model</code> used for any given row, as specified in the
documentation of how <code>use_dat</code> works when <code>model</code>
is in the data frame passed to <code>use_dat</code> (see the “Value”
section of the documentation in particular). This is perhaps most useful
when the model input consists of a request for both PREVENT and PCE
models (examples involving the PCEs will appear later).</p>
<p>Remember, you can override any of the optional behavior variables by
passing them as an argument. Note the different values for
<code>time</code> and <code>model</code> in the data frame.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>dat_time_model[[<span class="st">&quot;time&quot;</span>]] </span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;both&quot; &quot;10yr&quot; &quot;both&quot; &quot;both&quot; &quot;both&quot; &quot;both&quot; &quot;30yr&quot; &quot;both&quot; &quot;30yr&quot; &quot;both&quot;</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>dat_time_model[[<span class="st">&quot;model&quot;</span>]]</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;sdi&quot;   &quot;uacr&quot;  &quot;hba1c&quot; &quot;uacr&quot;  &quot;full&quot;  &quot;hba1c&quot; &quot;full&quot;  &quot;uacr&quot;  &quot;uacr&quot; </span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#&gt; [10] &quot;sdi&quot;</span></span></code></pre></div>
<p>Despite that, we will only get 10-year estimates from the base model
of the PREVENT equations with the following call.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>res_time_and_model_in_call <span class="ot">&lt;-</span> <span class="fu">est_risk</span>(</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  <span class="at">use_dat =</span> dat_time_model, </span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="at">time =</span> <span class="dv">10</span>, </span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">&quot;base&quot;</span>,</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>  <span class="at">progress =</span> <span class="cn">FALSE</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>) </span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">unique</span>(res_time_and_model_in_call[[<span class="st">&quot;over_years&quot;</span>]]), <span class="dv">10</span>) </span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">unique</span>(res_time_and_model_in_call[[<span class="st">&quot;model&quot;</span>]]), <span class="st">&quot;base&quot;</span>)  </span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>And likewise, the following call will invoke automatic model
selection despite the <code>model</code> column being all
<code>&quot;base&quot;</code>, because we pass the argument
<code>model = NULL</code> to the call.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>res_time_and_model_in_call <span class="ot">&lt;-</span> <span class="fu">est_risk</span>(</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="at">use_dat =</span> dat_time_model <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;base&quot;</span>), </span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  <span class="at">model =</span> <span class="cn">NULL</span>,</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>  <span class="at">progress =</span> <span class="cn">FALSE</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>) </span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">unique</span>(res_time_and_model_in_call[[<span class="st">&quot;model_input&quot;</span>]]), <span class="st">&quot;base&quot;</span>) </span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>res_time_and_model_in_call[[<span class="st">&quot;model&quot;</span>]]</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;hba1c&quot; &quot;hba1c&quot; &quot;full&quot;  &quot;full&quot;  &quot;full&quot;  &quot;uacr&quot;  &quot;uacr&quot;  &quot;sdi&quot;   &quot;sdi&quot;  </span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co">#&gt; [10] &quot;full&quot;  &quot;full&quot;  &quot;full&quot;  &quot;full&quot;  &quot;full&quot;  &quot;uacr&quot;  &quot;hba1c&quot; &quot;hba1c&quot;</span></span></code></pre></div>
</div>
<div id="number-of-rows-returned-for-a-given-input-row-number-of-models-requested" class="section level3">
<h3>Number of rows returned for a given input row = number of models
requested</h3>
<p>For any given input row in the data frame passed to
<code>use_dat</code>, the row will be expanded to match the number of
models requested. Stated more formally, each row in the input data frame
will be assigned a <code>preventr_id</code> value. For the row with
<code>preventr_id</code> <em>x</em> (hereafter, “row <em>x</em>”), if
<em>n</em> represents the number of models requested for row <em>x</em>,
then row <em>x</em> will be replicated <em>n</em> times in the return
data frame to accommodate reporting the different model outputs for that
row. Note also <em>n</em> is determined by what the function receives
for both the <code>model</code> and <code>time</code> arguments
(because, for example, if <code>model = &quot;base&quot;</code> and
<code>time = &quot;both&quot;</code>, this is a request for 2 models).</p>
<p>One can explore this further by examining the <code>model</code> and
<code>time</code> values in an arbitrary row of the data frame passed to
<code>use_dat</code> and the corresponding row(s) in the return data
frame. In this example, there will only ever be a maximum of 2 rows per
row of input, because the example here only considers the PREVENT
equations and time horizons of 10 and 30 years. Phrased differently, the
variability in number of rows per <code>preventr_id</code> for this
example will be relatively small: 1 or 2 rows. However, if one were also
considering the PCEs, then there could be a maximum of 4 rows per row of
input (if one asked for both the original and revised PCEs and both the
10- and 30-year estimates, as this would yield a 10-year estimate from
the PREVENT equations, the original PCEs, and the revised PCEs, and a
30-year estimate from the PREVENT equations).</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>show_random_row <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, res, <span class="at">n =</span> <span class="dv">5</span>) {</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>  </span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>  rows <span class="ot">&lt;-</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(dat))</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>  already_seen <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;double&quot;</span>, n)</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>  </span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_len</span>(n)) {</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>    </span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>    random_row <span class="ot">&lt;-</span> <span class="fu">sample</span>(rows, <span class="dv">1</span>)</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>    <span class="cf">while</span>(random_row <span class="sc">%in%</span> already_seen) random_row <span class="ot">&lt;-</span> <span class="fu">sample</span>(rows, <span class="dv">1</span>)</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>    already_seen[[i]] <span class="ot">&lt;-</span> random_row</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>    </span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="st">&quot;--- `preventr_id` &quot;</span>, random_row, <span class="st">&quot; ---&quot;</span>, <span class="st">&quot;</span><span class="sc">\n\n</span><span class="st">&quot;</span>))</span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>    </span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>    <span class="fu">print</span>(</span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>      <span class="fu">list</span>(</span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a>        <span class="co"># `model_input` has `unlist(..., recursive = FALSE)` because sometimes</span></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>        <span class="co"># column `model` will be a list column, so each item therein will be</span></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a>        <span class="co"># enclosed in a list, and unlisting one level improves the appearance of</span></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a>        <span class="co"># printing a bit in this case.</span></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a>        <span class="at">model_input =</span> <span class="fu">unlist</span>(dat[random_row, ][[<span class="st">&quot;model&quot;</span>]], <span class="at">recursive =</span> <span class="cn">FALSE</span>),</span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a>        <span class="at">time_input =</span> dat[random_row, ][[<span class="st">&quot;time&quot;</span>]],</span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a>        <span class="at">nrow_res =</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(res, preventr_id <span class="sc">==</span> random_row) <span class="sc">|&gt;</span> <span class="fu">nrow</span>()</span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a>      )</span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a>    )</span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a>  }</span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a>  </span>
<span id="cb13-27"><a href="#cb13-27" tabindex="-1"></a>}</span>
<span id="cb13-28"><a href="#cb13-28" tabindex="-1"></a></span>
<span id="cb13-29"><a href="#cb13-29" tabindex="-1"></a><span class="fu">show_random_row</span>(dat_time_model, res_time_model_in_dat)</span>
<span id="cb13-30"><a href="#cb13-30" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-31"><a href="#cb13-31" tabindex="-1"></a><span class="co">#&gt; --- `preventr_id` 7 ---</span></span>
<span id="cb13-32"><a href="#cb13-32" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-33"><a href="#cb13-33" tabindex="-1"></a><span class="co">#&gt; $model_input</span></span>
<span id="cb13-34"><a href="#cb13-34" tabindex="-1"></a><span class="co">#&gt; [1] &quot;full&quot;</span></span>
<span id="cb13-35"><a href="#cb13-35" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-36"><a href="#cb13-36" tabindex="-1"></a><span class="co">#&gt; $time_input</span></span>
<span id="cb13-37"><a href="#cb13-37" tabindex="-1"></a><span class="co">#&gt; [1] &quot;30yr&quot;</span></span>
<span id="cb13-38"><a href="#cb13-38" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-39"><a href="#cb13-39" tabindex="-1"></a><span class="co">#&gt; $nrow_res</span></span>
<span id="cb13-40"><a href="#cb13-40" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb13-41"><a href="#cb13-41" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-42"><a href="#cb13-42" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-43"><a href="#cb13-43" tabindex="-1"></a><span class="co">#&gt; --- `preventr_id` 2 ---</span></span>
<span id="cb13-44"><a href="#cb13-44" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-45"><a href="#cb13-45" tabindex="-1"></a><span class="co">#&gt; $model_input</span></span>
<span id="cb13-46"><a href="#cb13-46" tabindex="-1"></a><span class="co">#&gt; [1] &quot;uacr&quot;</span></span>
<span id="cb13-47"><a href="#cb13-47" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-48"><a href="#cb13-48" tabindex="-1"></a><span class="co">#&gt; $time_input</span></span>
<span id="cb13-49"><a href="#cb13-49" tabindex="-1"></a><span class="co">#&gt; [1] &quot;10yr&quot;</span></span>
<span id="cb13-50"><a href="#cb13-50" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-51"><a href="#cb13-51" tabindex="-1"></a><span class="co">#&gt; $nrow_res</span></span>
<span id="cb13-52"><a href="#cb13-52" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb13-53"><a href="#cb13-53" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-54"><a href="#cb13-54" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-55"><a href="#cb13-55" tabindex="-1"></a><span class="co">#&gt; --- `preventr_id` 1 ---</span></span>
<span id="cb13-56"><a href="#cb13-56" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-57"><a href="#cb13-57" tabindex="-1"></a><span class="co">#&gt; $model_input</span></span>
<span id="cb13-58"><a href="#cb13-58" tabindex="-1"></a><span class="co">#&gt; [1] &quot;sdi&quot;</span></span>
<span id="cb13-59"><a href="#cb13-59" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-60"><a href="#cb13-60" tabindex="-1"></a><span class="co">#&gt; $time_input</span></span>
<span id="cb13-61"><a href="#cb13-61" tabindex="-1"></a><span class="co">#&gt; [1] &quot;both&quot;</span></span>
<span id="cb13-62"><a href="#cb13-62" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-63"><a href="#cb13-63" tabindex="-1"></a><span class="co">#&gt; $nrow_res</span></span>
<span id="cb13-64"><a href="#cb13-64" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span>
<span id="cb13-65"><a href="#cb13-65" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-66"><a href="#cb13-66" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-67"><a href="#cb13-67" tabindex="-1"></a><span class="co">#&gt; --- `preventr_id` 3 ---</span></span>
<span id="cb13-68"><a href="#cb13-68" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-69"><a href="#cb13-69" tabindex="-1"></a><span class="co">#&gt; $model_input</span></span>
<span id="cb13-70"><a href="#cb13-70" tabindex="-1"></a><span class="co">#&gt; [1] &quot;hba1c&quot;</span></span>
<span id="cb13-71"><a href="#cb13-71" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-72"><a href="#cb13-72" tabindex="-1"></a><span class="co">#&gt; $time_input</span></span>
<span id="cb13-73"><a href="#cb13-73" tabindex="-1"></a><span class="co">#&gt; [1] &quot;both&quot;</span></span>
<span id="cb13-74"><a href="#cb13-74" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-75"><a href="#cb13-75" tabindex="-1"></a><span class="co">#&gt; $nrow_res</span></span>
<span id="cb13-76"><a href="#cb13-76" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span>
<span id="cb13-77"><a href="#cb13-77" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-78"><a href="#cb13-78" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-79"><a href="#cb13-79" tabindex="-1"></a><span class="co">#&gt; --- `preventr_id` 6 ---</span></span>
<span id="cb13-80"><a href="#cb13-80" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-81"><a href="#cb13-81" tabindex="-1"></a><span class="co">#&gt; $model_input</span></span>
<span id="cb13-82"><a href="#cb13-82" tabindex="-1"></a><span class="co">#&gt; [1] &quot;hba1c&quot;</span></span>
<span id="cb13-83"><a href="#cb13-83" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-84"><a href="#cb13-84" tabindex="-1"></a><span class="co">#&gt; $time_input</span></span>
<span id="cb13-85"><a href="#cb13-85" tabindex="-1"></a><span class="co">#&gt; [1] &quot;both&quot;</span></span>
<span id="cb13-86"><a href="#cb13-86" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-87"><a href="#cb13-87" tabindex="-1"></a><span class="co">#&gt; $nrow_res</span></span>
<span id="cb13-88"><a href="#cb13-88" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span></code></pre></div>
</div>
<div id="add_to_dat" class="section level3">
<h3><code>add_to_dat</code></h3>
<p>If you do not want the risk estimation results to be added back to
the data frame passed to <code>use_dat</code>, set
<code>add_to_dat = FALSE</code>. The results will be returned as a data
frame, and the first column will again be <code>preventr_id</code> to
identify the row in the <code>use_dat</code> data frame that corresponds
with the results shown in the return data frame. This column is perhaps
of additional importance when <code>add_to_dat = FALSE</code>, as the
return data frame will <em>not</em> have the columns contained in the
data frame passed to <code>use_dat</code>, so <code>preventr_id</code>
provides a ready way to reassociate the data frame passed to
<code>use_dat</code> with the results in the return data frame.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>res_without_dat <span class="ot">&lt;-</span> <span class="fu">est_risk</span>(</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  <span class="at">use_dat =</span> dat_time_model, </span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>  <span class="at">add_to_dat =</span> <span class="cn">FALSE</span>, </span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  <span class="at">progress =</span> <span class="cn">FALSE</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>)</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(res_without_dat)</span></code></pre></div>
<table>
<colgroup>
<col width="13%" />
<col width="11%" />
<col width="6%" />
<col width="16%" />
<col width="6%" />
<col width="8%" />
<col width="6%" />
<col width="12%" />
<col width="17%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">preventr_id</th>
<th align="right">total_cvd</th>
<th align="right">ascvd</th>
<th align="right">heart_failure</th>
<th align="right">chd</th>
<th align="right">stroke</th>
<th align="left">model</th>
<th align="right">over_years</th>
<th align="left">input_problems</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.042</td>
<td align="right">0.028</td>
<td align="right">0.049</td>
<td align="right">0.010</td>
<td align="right">0.020</td>
<td align="left">sdi</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">0.238</td>
<td align="right">0.147</td>
<td align="right">0.295</td>
<td align="right">0.057</td>
<td align="right">0.104</td>
<td align="left">sdi</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">0.317</td>
<td align="right">0.204</td>
<td align="right">0.244</td>
<td align="right">0.117</td>
<td align="right">0.107</td>
<td align="left">uacr</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">0.115</td>
<td align="right">0.077</td>
<td align="right">0.143</td>
<td align="right">0.034</td>
<td align="right">0.047</td>
<td align="left">hba1c</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">0.440</td>
<td align="right">0.294</td>
<td align="right">0.528</td>
<td align="right">0.150</td>
<td align="right">0.186</td>
<td align="left">hba1c</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">0.305</td>
<td align="right">0.144</td>
<td align="right">0.288</td>
<td align="right">0.049</td>
<td align="right">0.146</td>
<td align="left">uacr</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">0.565</td>
<td align="right">0.313</td>
<td align="right">0.592</td>
<td align="right">0.120</td>
<td align="right">0.309</td>
<td align="left">uacr</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">0.031</td>
<td align="right">0.022</td>
<td align="right">0.035</td>
<td align="right">0.008</td>
<td align="right">0.015</td>
<td align="left">full</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">0.192</td>
<td align="right">0.125</td>
<td align="right">0.229</td>
<td align="right">0.049</td>
<td align="right">0.084</td>
<td align="left">full</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">0.444</td>
<td align="right">0.295</td>
<td align="right">0.444</td>
<td align="right">0.206</td>
<td align="right">0.143</td>
<td align="left">hba1c</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">6</td>
<td align="right">0.678</td>
<td align="right">0.487</td>
<td align="right">0.668</td>
<td align="right">0.368</td>
<td align="right">0.267</td>
<td align="left">hba1c</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">7</td>
<td align="right">0.191</td>
<td align="right">0.085</td>
<td align="right">0.188</td>
<td align="right">0.038</td>
<td align="right">0.055</td>
<td align="left">full</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">8</td>
<td align="right">0.154</td>
<td align="right">0.084</td>
<td align="right">0.098</td>
<td align="right">0.031</td>
<td align="right">0.065</td>
<td align="left">uacr</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">0.428</td>
<td align="right">0.255</td>
<td align="right">0.340</td>
<td align="right">0.106</td>
<td align="right">0.203</td>
<td align="left">uacr</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">0.433</td>
<td align="right">0.242</td>
<td align="right">0.268</td>
<td align="right">0.146</td>
<td align="right">0.128</td>
<td align="left">uacr</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">0.078</td>
<td align="right">0.059</td>
<td align="right">0.034</td>
<td align="right">0.038</td>
<td align="right">0.022</td>
<td align="left">sdi</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">10</td>
<td align="right">0.422</td>
<td align="right">0.319</td>
<td align="right">0.226</td>
<td align="right">0.229</td>
<td align="right">0.137</td>
<td align="left">sdi</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>The default for <code>add_to_dat</code> is <code>TRUE</code> when
<code>use_dat</code> is a data frame (it is ignored when
<code>use_dat</code> is anything other than a data frame).
<code>add_to_dat = TRUE</code> essentially just triggers a left join
behind the scenes. As we’ll see in the example immediately below, calls
with <code>add_to_dat = FALSE</code> are still easy to reassociate with
the data frame passed to <code>use_dat</code>, thanks to the
<code>preventr_id</code> column in the return data frame.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>res_with_dat <span class="ot">&lt;-</span> <span class="fu">est_risk</span>(<span class="at">use_dat =</span> dat_time_model, <span class="at">progress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co"># Now, let&#39;s check identicality of `res_with_dat` with a version we</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co"># recreate using `dat_for_join` and `res_without_dat`.</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>dat_for_join <span class="ot">&lt;-</span> dat_time_model <span class="sc">|&gt;</span> </span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>  <span class="co"># First, add the `preventer_id` column ...</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">preventr_id =</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(dat_time_model))) <span class="sc">|&gt;</span> </span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>  <span class="co"># ... and then move it to be the first column in the data frame.</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(preventr_id) </span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a><span class="co"># Now, do the left join.</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a>res_with_dat_manual_join <span class="ot">&lt;-</span> dat_for_join <span class="sc">|&gt;</span> </span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a>    res_without_dat, </span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">&quot;preventr_id&quot;</span>,</span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a>    <span class="co"># Because both data frames will have a column named `model`, I&#39;ll provide</span></span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a>    <span class="co"># suffixes to distinguish them. The suffixes below will result in the column </span></span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a>    <span class="co"># `model` in `dat_for_join` being renamed to `model_input` and column</span></span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a>    <span class="co"># `model` in the data frame `res_without_dat` retaining the same name.</span></span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a>    <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;_input&quot;</span>, <span class="st">&quot;&quot;</span>)  </span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a>    )</span>
<span id="cb15-22"><a href="#cb15-22" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" tabindex="-1"></a><span class="co"># (You could also do all the above without a pipe sequence, of course.)</span></span>
<span id="cb15-24"><a href="#cb15-24" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" tabindex="-1"></a><span class="fu">identical</span>(res_with_dat, res_with_dat_manual_join)   </span>
<span id="cb15-26"><a href="#cb15-26" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<div id="type-stability-of-return" class="section level3">
<h3>Type-stability of return</h3>
<p>The return data frame will be of the same type as the data frame
passed to <code>use_dat</code>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>dat_tbl <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">quiet =</span> <span class="cn">TRUE</span>)       </span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>dat_dt <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">as.data.table</span>(dat_tbl)</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>dat_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(dat_tbl)</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="fu">class</span>(dat_tbl)</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co">#&gt; [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="fu">class</span>(dat_dt)</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="co">#&gt; [1] &quot;data.table&quot; &quot;data.frame&quot;</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="fu">class</span>(dat_df)</span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="co">#&gt; [1] &quot;data.frame&quot;</span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a>res_tbl <span class="ot">&lt;-</span> <span class="fu">est_risk</span>(<span class="at">use_dat =</span> dat_tbl, <span class="at">progress =</span> <span class="cn">FALSE</span>)  <span class="co"># Return: tibble</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a>res_dt <span class="ot">&lt;-</span> <span class="fu">est_risk</span>(<span class="at">use_dat =</span> dat_dt, <span class="at">progress =</span> <span class="cn">FALSE</span>)    <span class="co"># Return: data.table</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a>res_df <span class="ot">&lt;-</span> <span class="fu">est_risk</span>(<span class="at">use_dat =</span> dat_df, <span class="at">progress =</span> <span class="cn">FALSE</span>)    <span class="co"># Return: data frame</span></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">class</span>(dat_tbl), <span class="fu">class</span>(res_tbl))</span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">class</span>(dat_dt), <span class="fu">class</span>(res_dt))</span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">class</span>(dat_df), <span class="fu">class</span>(res_df))</span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" tabindex="-1"></a><span class="co"># Other than the attributes, these are all equal (of course).</span></span>
<span id="cb16-24"><a href="#cb16-24" tabindex="-1"></a><span class="fu">all.equal</span>(res_tbl, res_dt, <span class="at">check.attributes =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-25"><a href="#cb16-25" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb16-26"><a href="#cb16-26" tabindex="-1"></a><span class="fu">all.equal</span>(res_tbl, res_df, <span class="at">check.attributes =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-27"><a href="#cb16-27" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<div id="what-about-the-pces" class="section level3">
<h3>What about the PCEs?</h3>
<p>Yes, you can request the PCEs in conjunction with using
<code>use_dat</code>. Because of how the <code>model</code> argument
works when requesting the PCEs (namely, it expects a list in this case),
the <code>model</code> column in the data frame being passed to
<code>use_dat</code> needs to be a list column.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>dat_with_pce_requests <span class="ot">&lt;-</span> dat_time_model <span class="sc">|&gt;</span> </span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>  <span class="co"># We&#39;ll start with the data in `dat_time_model` and then overwrite the `model`</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>  <span class="co"># column for this example.</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>    <span class="co"># Base R `lapply()` is a convenient choice here, as it will return a list; </span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>    <span class="co"># however, this is not the only way to create list columns.</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">lapply</span>(</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>      <span class="fu">seq_len</span>(<span class="fu">nrow</span>(dat_time_model)),</span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>      <span class="cf">function</span>(x) {</span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>        <span class="co"># Let&#39;s make some rows just have `NA` (leading to automatic PREVENT</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>        <span class="co"># model selection and no risk estimation from the PCEs) and other rows</span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>        <span class="co"># specify both the PREVENT and PCE models. This is just to demonstrate</span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a>        <span class="co"># flexibility. You could also just generate a basic list column, and</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a>        <span class="co"># that would be less involved than what I do here.</span></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a>        <span class="cf">if</span>(x <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a>          <span class="cn">NA</span></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a>        } <span class="cf">else</span> { </span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a>          <span class="fu">list</span>(</span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a>            <span class="co"># (We could also omit `main_model`, in which case the PREVENT model</span></span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a>            <span class="co"># will be selected automatically.)</span></span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a>            <span class="at">main_model =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;base&quot;</span>, <span class="st">&quot;hba1c&quot;</span>, <span class="st">&quot;uacr&quot;</span>, <span class="st">&quot;sdi&quot;</span>, <span class="st">&quot;full&quot;</span>), <span class="dv">1</span>),</span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a>            <span class="at">other_models =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;pce_both&quot;</span>, <span class="st">&quot;pce_rev&quot;</span>, <span class="st">&quot;pce_orig&quot;</span>), <span class="dv">1</span>),</span>
<span id="cb17-23"><a href="#cb17-23" tabindex="-1"></a>            <span class="at">race_eth =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;Black&quot;</span>, <span class="st">&quot;White&quot;</span>, <span class="st">&quot;Other&quot;</span>), <span class="dv">1</span>)</span>
<span id="cb17-24"><a href="#cb17-24" tabindex="-1"></a>          )</span>
<span id="cb17-25"><a href="#cb17-25" tabindex="-1"></a>        }</span>
<span id="cb17-26"><a href="#cb17-26" tabindex="-1"></a>      }</span>
<span id="cb17-27"><a href="#cb17-27" tabindex="-1"></a>    )</span>
<span id="cb17-28"><a href="#cb17-28" tabindex="-1"></a>  )</span>
<span id="cb17-29"><a href="#cb17-29" tabindex="-1"></a></span>
<span id="cb17-30"><a href="#cb17-30" tabindex="-1"></a>res_with_pce_requests <span class="ot">&lt;-</span> <span class="fu">est_risk</span>(</span>
<span id="cb17-31"><a href="#cb17-31" tabindex="-1"></a>  <span class="at">use_dat =</span> dat_with_pce_requests, </span>
<span id="cb17-32"><a href="#cb17-32" tabindex="-1"></a>  <span class="at">progress =</span> <span class="cn">FALSE</span></span>
<span id="cb17-33"><a href="#cb17-33" tabindex="-1"></a>)</span>
<span id="cb17-34"><a href="#cb17-34" tabindex="-1"></a></span>
<span id="cb17-35"><a href="#cb17-35" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(res_with_pce_requests)</span></code></pre></div>
<table>
<colgroup>
<col width="5%" />
<col width="1%" />
<col width="3%" />
<col width="1%" />
<col width="2%" />
<col width="3%" />
<col width="2%" />
<col width="3%" />
<col width="2%" />
<col width="3%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="3%" />
<col width="2%" />
<col width="2%" />
<col width="12%" />
<col width="4%" />
<col width="2%" />
<col width="6%" />
<col width="2%" />
<col width="3%" />
<col width="4%" />
<col width="5%" />
<col width="7%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">preventr_id</th>
<th align="right">age</th>
<th align="left">sex</th>
<th align="right">sbp</th>
<th align="left">bp_tx</th>
<th align="right">total_c</th>
<th align="right">hdl_c</th>
<th align="left">statin</th>
<th align="left">dm</th>
<th align="left">smoking</th>
<th align="right">egfr</th>
<th align="right">bmi</th>
<th align="right">hba1c</th>
<th align="right">uacr</th>
<th align="left">zip</th>
<th align="left">time</th>
<th align="left">model_input</th>
<th align="right">total_cvd</th>
<th align="right">ascvd</th>
<th align="right">heart_failure</th>
<th align="right">chd</th>
<th align="right">stroke</th>
<th align="left">model</th>
<th align="right">over_years</th>
<th align="left">input_problems</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">40</td>
<td align="left">female</td>
<td align="right">153</td>
<td align="left">FALSE</td>
<td align="right">204</td>
<td align="right">80</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">73</td>
<td align="right">37.4</td>
<td align="right">4.6</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">uacr , pce_both, Other</td>
<td align="right">0.025</td>
<td align="right">0.017</td>
<td align="right">0.026</td>
<td align="right">0.006</td>
<td align="right">0.012</td>
<td align="left">uacr</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">40</td>
<td align="left">female</td>
<td align="right">153</td>
<td align="left">FALSE</td>
<td align="right">204</td>
<td align="right">80</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">73</td>
<td align="right">37.4</td>
<td align="right">4.6</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">uacr , pce_both, Other</td>
<td align="right">NA</td>
<td align="right">0.008</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">pce_orig</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">40</td>
<td align="left">female</td>
<td align="right">153</td>
<td align="left">FALSE</td>
<td align="right">204</td>
<td align="right">80</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">73</td>
<td align="right">37.4</td>
<td align="right">4.6</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">uacr , pce_both, Other</td>
<td align="right">NA</td>
<td align="right">0.015</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">pce_rev</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">40</td>
<td align="left">female</td>
<td align="right">153</td>
<td align="left">FALSE</td>
<td align="right">204</td>
<td align="right">80</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">73</td>
<td align="right">37.4</td>
<td align="right">4.6</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">uacr , pce_both, Other</td>
<td align="right">0.180</td>
<td align="right">0.110</td>
<td align="right">0.210</td>
<td align="right">0.044</td>
<td align="right">0.077</td>
<td align="left">uacr</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">55</td>
<td align="left">male</td>
<td align="right">156</td>
<td align="left">FALSE</td>
<td align="right">282</td>
<td align="right">67</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">71</td>
<td align="right">32.9</td>
<td align="right">12.2</td>
<td align="right">23040.0</td>
<td align="left">48708</td>
<td align="left">10yr</td>
<td align="left">NA</td>
<td align="right">0.474</td>
<td align="right">0.336</td>
<td align="right">0.420</td>
<td align="right">0.198</td>
<td align="right">0.201</td>
<td align="left">full</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">45</td>
<td align="left">female</td>
<td align="right">172</td>
<td align="left">FALSE</td>
<td align="right">276</td>
<td align="right">91</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">80</td>
<td align="right">37.5</td>
<td align="right">7.1</td>
<td align="right">NA</td>
<td align="left">98591</td>
<td align="left">both</td>
<td align="left">full , pce_rev, White</td>
<td align="right">0.057</td>
<td align="right">0.042</td>
<td align="right">0.068</td>
<td align="right">0.017</td>
<td align="right">0.027</td>
<td align="left">full</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">45</td>
<td align="left">female</td>
<td align="right">172</td>
<td align="left">FALSE</td>
<td align="right">276</td>
<td align="right">91</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">80</td>
<td align="right">37.5</td>
<td align="right">7.1</td>
<td align="right">NA</td>
<td align="left">98591</td>
<td align="left">both</td>
<td align="left">full , pce_rev, White</td>
<td align="right">NA</td>
<td align="right">0.108</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">pce_rev</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">45</td>
<td align="left">female</td>
<td align="right">172</td>
<td align="left">FALSE</td>
<td align="right">276</td>
<td align="right">91</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">80</td>
<td align="right">37.5</td>
<td align="right">7.1</td>
<td align="right">NA</td>
<td align="left">98591</td>
<td align="left">both</td>
<td align="left">full , pce_rev, White</td>
<td align="right">0.305</td>
<td align="right">0.206</td>
<td align="right">0.377</td>
<td align="right">0.095</td>
<td align="right">0.134</td>
<td align="left">full</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">51</td>
<td align="left">male</td>
<td align="right">169</td>
<td align="left">TRUE</td>
<td align="right">177</td>
<td align="right">88</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">73</td>
<td align="right">28.6</td>
<td align="right">NA</td>
<td align="right">13289.2</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">NA</td>
<td align="right">0.305</td>
<td align="right">0.144</td>
<td align="right">0.288</td>
<td align="right">0.049</td>
<td align="right">0.146</td>
<td align="left">uacr</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">51</td>
<td align="left">male</td>
<td align="right">169</td>
<td align="left">TRUE</td>
<td align="right">177</td>
<td align="right">88</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">73</td>
<td align="right">28.6</td>
<td align="right">NA</td>
<td align="right">13289.2</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">NA</td>
<td align="right">0.565</td>
<td align="right">0.313</td>
<td align="right">0.592</td>
<td align="right">0.120</td>
<td align="right">0.309</td>
<td align="left">uacr</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">52</td>
<td align="left">female</td>
<td align="right">160</td>
<td align="left">TRUE</td>
<td align="right">241</td>
<td align="right">95</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">77</td>
<td align="right">37.5</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">33321</td>
<td align="left">both</td>
<td align="left">hba1c , pce_rev, White</td>
<td align="right">0.052</td>
<td align="right">0.033</td>
<td align="right">0.062</td>
<td align="right">0.012</td>
<td align="right">0.023</td>
<td align="left">hba1c</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">52</td>
<td align="left">female</td>
<td align="right">160</td>
<td align="left">TRUE</td>
<td align="right">241</td>
<td align="right">95</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">77</td>
<td align="right">37.5</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">33321</td>
<td align="left">both</td>
<td align="left">hba1c , pce_rev, White</td>
<td align="right">NA</td>
<td align="right">0.060</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">pce_rev</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">52</td>
<td align="left">female</td>
<td align="right">160</td>
<td align="left">TRUE</td>
<td align="right">241</td>
<td align="right">95</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">77</td>
<td align="right">37.5</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">33321</td>
<td align="left">both</td>
<td align="left">hba1c , pce_rev, White</td>
<td align="right">0.257</td>
<td align="right">0.159</td>
<td align="right">0.307</td>
<td align="right">0.063</td>
<td align="right">0.108</td>
<td align="left">hba1c</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">58</td>
<td align="left">male</td>
<td align="right">171</td>
<td align="left">FALSE</td>
<td align="right">175</td>
<td align="right">36</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">70</td>
<td align="right">36.0</td>
<td align="right">13.9</td>
<td align="right">9073.3</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">NA</td>
<td align="right">0.656</td>
<td align="right">0.449</td>
<td align="right">0.697</td>
<td align="right">0.348</td>
<td align="right">0.238</td>
<td align="left">full</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">6</td>
<td align="right">58</td>
<td align="left">male</td>
<td align="right">171</td>
<td align="left">FALSE</td>
<td align="right">175</td>
<td align="right">36</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">70</td>
<td align="right">36.0</td>
<td align="right">13.9</td>
<td align="right">9073.3</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">NA</td>
<td align="right">0.760</td>
<td align="right">0.549</td>
<td align="right">0.778</td>
<td align="right">0.444</td>
<td align="right">0.311</td>
<td align="left">full</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">7</td>
<td align="right">57</td>
<td align="left">female</td>
<td align="right">95</td>
<td align="left">TRUE</td>
<td align="right">152</td>
<td align="right">64</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">86</td>
<td align="right">36.7</td>
<td align="right">5.6</td>
<td align="right">NA</td>
<td align="left">77642</td>
<td align="left">30yr</td>
<td align="left">sdi , pce_both, Black</td>
<td align="right">NA</td>
<td align="right">0.015</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">pce_orig</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">57</td>
<td align="left">female</td>
<td align="right">95</td>
<td align="left">TRUE</td>
<td align="right">152</td>
<td align="right">64</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">86</td>
<td align="right">36.7</td>
<td align="right">5.6</td>
<td align="right">NA</td>
<td align="left">77642</td>
<td align="left">30yr</td>
<td align="left">sdi , pce_both, Black</td>
<td align="right">NA</td>
<td align="right">0.013</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">pce_rev</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">7</td>
<td align="right">57</td>
<td align="left">female</td>
<td align="right">95</td>
<td align="left">TRUE</td>
<td align="right">152</td>
<td align="right">64</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">86</td>
<td align="right">36.7</td>
<td align="right">5.6</td>
<td align="right">NA</td>
<td align="left">77642</td>
<td align="left">30yr</td>
<td align="left">sdi , pce_both, Black</td>
<td align="right">0.224</td>
<td align="right">0.098</td>
<td align="right">0.234</td>
<td align="right">0.044</td>
<td align="right">0.063</td>
<td align="left">sdi</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">8</td>
<td align="right">36</td>
<td align="left">male</td>
<td align="right">175</td>
<td align="left">TRUE</td>
<td align="right">261</td>
<td align="right">82</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">89</td>
<td align="right">28.6</td>
<td align="right">6.2</td>
<td align="right">4523.9</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">NA</td>
<td align="right">0.138</td>
<td align="right">0.073</td>
<td align="right">0.085</td>
<td align="right">0.026</td>
<td align="right">0.060</td>
<td align="left">full</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">36</td>
<td align="left">male</td>
<td align="right">175</td>
<td align="left">TRUE</td>
<td align="right">261</td>
<td align="right">82</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">89</td>
<td align="right">28.6</td>
<td align="right">6.2</td>
<td align="right">4523.9</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">NA</td>
<td align="right">0.386</td>
<td align="right">0.221</td>
<td align="right">0.295</td>
<td align="right">0.085</td>
<td align="right">0.185</td>
<td align="left">full</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">49</td>
<td align="left">female</td>
<td align="right">121</td>
<td align="left">TRUE</td>
<td align="right">217</td>
<td align="right">50</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">78</td>
<td align="right">18.7</td>
<td align="right">NA</td>
<td align="right">6996.0</td>
<td align="left">NA</td>
<td align="left">30yr</td>
<td align="left">hba1c , pce_rev, Black</td>
<td align="right">NA</td>
<td align="right">0.045</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">pce_rev</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">9</td>
<td align="right">49</td>
<td align="left">female</td>
<td align="right">121</td>
<td align="left">TRUE</td>
<td align="right">217</td>
<td align="right">50</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">78</td>
<td align="right">18.7</td>
<td align="right">NA</td>
<td align="right">6996.0</td>
<td align="left">NA</td>
<td align="left">30yr</td>
<td align="left">hba1c , pce_rev, Black</td>
<td align="right">0.264</td>
<td align="right">0.149</td>
<td align="right">0.126</td>
<td align="right">0.082</td>
<td align="right">0.078</td>
<td align="left">hba1c</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">10</td>
<td align="right">47</td>
<td align="left">male</td>
<td align="right">160</td>
<td align="left">FALSE</td>
<td align="right">269</td>
<td align="right">45</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">68</td>
<td align="right">38.6</td>
<td align="right">14.0</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">NA</td>
<td align="right">0.193</td>
<td align="right">0.150</td>
<td align="right">0.111</td>
<td align="right">0.089</td>
<td align="right">0.066</td>
<td align="left">hba1c</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">47</td>
<td align="left">male</td>
<td align="right">160</td>
<td align="left">FALSE</td>
<td align="right">269</td>
<td align="right">45</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">68</td>
<td align="right">38.6</td>
<td align="right">14.0</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">NA</td>
<td align="right">0.566</td>
<td align="right">0.468</td>
<td align="right">0.397</td>
<td align="right">0.326</td>
<td align="right">0.253</td>
<td align="left">hba1c</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>Those reviewing closely will notice printing the list column
<code>model_input</code> results in some extra spaces and the list item
names being dropped, but it nevertheless permits insight into what was
contained in the list for <code>model</code> for each row of the input
data frame passed to <code>use_dat</code>. And note this is solely a
side effect of printing the list column via <code>knitr::kable()</code>.
The column <code>model_input</code> in the return data frame is
identical to the column <code>model</code> in the data frame passed to
<code>use_dat</code> aside from the expansion behavior already described
(see section “Number of rows returned for a given input row = number of
models requested” in this vignette).</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>identical_cols <span class="ot">&lt;-</span> <span class="fu">vapply</span>(</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  <span class="fu">seq_len</span>(<span class="fu">nrow</span>(dat_with_pce_requests)),</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>  </span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>  <span class="cf">function</span>(x) {</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>    n_row <span class="ot">&lt;-</span> res_with_pce_requests <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(preventr_id <span class="sc">==</span> x) <span class="sc">|&gt;</span> <span class="fu">nrow</span>()</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>    </span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>    <span class="fu">identical</span>(</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>      <span class="fu">rep</span>(dat_with_pce_requests[[<span class="st">&quot;model&quot;</span>]][x], n_row),</span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>      </span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>      res_with_pce_requests <span class="sc">|&gt;</span> </span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(preventr_id <span class="sc">==</span> x) <span class="sc">|&gt;</span></span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">pull</span>(model_input)</span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a>    )</span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a>  },</span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a>  </span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a>  <span class="fu">logical</span>(<span class="dv">1</span>)</span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a>)</span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a><span class="fu">all</span>(identical_cols)</span>
<span id="cb18-20"><a href="#cb18-20" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>On the note of the expansion behavior, note the results here further
demonstrate the concept of the number of rows in the return data frame
equaling the number of models requested for a given row in the input
data frame.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">show_random_row</span>(dat_with_pce_requests, res_with_pce_requests)</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="co">#&gt; --- `preventr_id` 6 ---</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="co">#&gt; $model_input</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="co">#&gt; [1] NA</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="co">#&gt; $time_input</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="co">#&gt; [1] &quot;both&quot;</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a><span class="co">#&gt; $nrow_res</span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a><span class="co">#&gt; --- `preventr_id` 8 ---</span></span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a><span class="co">#&gt; $model_input</span></span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a><span class="co">#&gt; [1] NA</span></span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a><span class="co">#&gt; $time_input</span></span>
<span id="cb19-21"><a href="#cb19-21" tabindex="-1"></a><span class="co">#&gt; [1] &quot;both&quot;</span></span>
<span id="cb19-22"><a href="#cb19-22" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-23"><a href="#cb19-23" tabindex="-1"></a><span class="co">#&gt; $nrow_res</span></span>
<span id="cb19-24"><a href="#cb19-24" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span>
<span id="cb19-25"><a href="#cb19-25" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-26"><a href="#cb19-26" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-27"><a href="#cb19-27" tabindex="-1"></a><span class="co">#&gt; --- `preventr_id` 5 ---</span></span>
<span id="cb19-28"><a href="#cb19-28" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-29"><a href="#cb19-29" tabindex="-1"></a><span class="co">#&gt; $model_input</span></span>
<span id="cb19-30"><a href="#cb19-30" tabindex="-1"></a><span class="co">#&gt; $model_input$main_model</span></span>
<span id="cb19-31"><a href="#cb19-31" tabindex="-1"></a><span class="co">#&gt; [1] &quot;hba1c&quot;</span></span>
<span id="cb19-32"><a href="#cb19-32" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-33"><a href="#cb19-33" tabindex="-1"></a><span class="co">#&gt; $model_input$other_models</span></span>
<span id="cb19-34"><a href="#cb19-34" tabindex="-1"></a><span class="co">#&gt; [1] &quot;pce_rev&quot;</span></span>
<span id="cb19-35"><a href="#cb19-35" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-36"><a href="#cb19-36" tabindex="-1"></a><span class="co">#&gt; $model_input$race_eth</span></span>
<span id="cb19-37"><a href="#cb19-37" tabindex="-1"></a><span class="co">#&gt; [1] &quot;White&quot;</span></span>
<span id="cb19-38"><a href="#cb19-38" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-39"><a href="#cb19-39" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-40"><a href="#cb19-40" tabindex="-1"></a><span class="co">#&gt; $time_input</span></span>
<span id="cb19-41"><a href="#cb19-41" tabindex="-1"></a><span class="co">#&gt; [1] &quot;both&quot;</span></span>
<span id="cb19-42"><a href="#cb19-42" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-43"><a href="#cb19-43" tabindex="-1"></a><span class="co">#&gt; $nrow_res</span></span>
<span id="cb19-44"><a href="#cb19-44" tabindex="-1"></a><span class="co">#&gt; [1] 3</span></span>
<span id="cb19-45"><a href="#cb19-45" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-46"><a href="#cb19-46" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-47"><a href="#cb19-47" tabindex="-1"></a><span class="co">#&gt; --- `preventr_id` 10 ---</span></span>
<span id="cb19-48"><a href="#cb19-48" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-49"><a href="#cb19-49" tabindex="-1"></a><span class="co">#&gt; $model_input</span></span>
<span id="cb19-50"><a href="#cb19-50" tabindex="-1"></a><span class="co">#&gt; [1] NA</span></span>
<span id="cb19-51"><a href="#cb19-51" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-52"><a href="#cb19-52" tabindex="-1"></a><span class="co">#&gt; $time_input</span></span>
<span id="cb19-53"><a href="#cb19-53" tabindex="-1"></a><span class="co">#&gt; [1] &quot;both&quot;</span></span>
<span id="cb19-54"><a href="#cb19-54" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-55"><a href="#cb19-55" tabindex="-1"></a><span class="co">#&gt; $nrow_res</span></span>
<span id="cb19-56"><a href="#cb19-56" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span>
<span id="cb19-57"><a href="#cb19-57" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-58"><a href="#cb19-58" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-59"><a href="#cb19-59" tabindex="-1"></a><span class="co">#&gt; --- `preventr_id` 1 ---</span></span>
<span id="cb19-60"><a href="#cb19-60" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-61"><a href="#cb19-61" tabindex="-1"></a><span class="co">#&gt; $model_input</span></span>
<span id="cb19-62"><a href="#cb19-62" tabindex="-1"></a><span class="co">#&gt; $model_input$main_model</span></span>
<span id="cb19-63"><a href="#cb19-63" tabindex="-1"></a><span class="co">#&gt; [1] &quot;uacr&quot;</span></span>
<span id="cb19-64"><a href="#cb19-64" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-65"><a href="#cb19-65" tabindex="-1"></a><span class="co">#&gt; $model_input$other_models</span></span>
<span id="cb19-66"><a href="#cb19-66" tabindex="-1"></a><span class="co">#&gt; [1] &quot;pce_both&quot;</span></span>
<span id="cb19-67"><a href="#cb19-67" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-68"><a href="#cb19-68" tabindex="-1"></a><span class="co">#&gt; $model_input$race_eth</span></span>
<span id="cb19-69"><a href="#cb19-69" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Other&quot;</span></span>
<span id="cb19-70"><a href="#cb19-70" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-71"><a href="#cb19-71" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-72"><a href="#cb19-72" tabindex="-1"></a><span class="co">#&gt; $time_input</span></span>
<span id="cb19-73"><a href="#cb19-73" tabindex="-1"></a><span class="co">#&gt; [1] &quot;both&quot;</span></span>
<span id="cb19-74"><a href="#cb19-74" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-75"><a href="#cb19-75" tabindex="-1"></a><span class="co">#&gt; $nrow_res</span></span>
<span id="cb19-76"><a href="#cb19-76" tabindex="-1"></a><span class="co">#&gt; [1] 4</span></span></code></pre></div>
<p>Again, specifying the <code>model</code> variable in the data frame
is likely most helpful when one desires to request different behavior
across different rows of the input data frame passed to
<code>use_dat</code> (just like for any optional behavior variable). If
instead you want the same model behavior across all rows, you can either
(1) pass nothing to the <code>model</code> argument and <em>not</em>
include a <code>model</code> column in the data frame passed to
<code>use_dat</code> or (2) specify the desired model behavior in the
<code>model</code> argument, which will also override anything that
might exist in a column named <code>model</code> in the data frame
passed to <code>use_dat</code>.</p>
</div>
<div id="what-about-the-convenience-functions-for-egfr-and-bmi" class="section level3">
<h3>What about the convenience functions for eGFR and BMI?</h3>
<p>Yes, you can use the convenience functions for eGFR and BMI when
using <code>use_dat</code> and <code>add_to_dat</code> (see the
documentation for <code>est_risk()</code>’s arguments <code>egfr</code>
and <code>bmi</code> if you are not familiar with these convenience
functions). The input data frame passed to <code>use_dat</code> will
need to have the calls to the convenience functions in columns. Because
these will be columns, they will need to be list columns.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>dat_with_calls_basic <span class="ot">&lt;-</span> dat_with_pce_requests <span class="sc">|&gt;</span> </span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>    <span class="at">egfr =</span> <span class="fu">lapply</span>(</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>      <span class="fu">seq_len</span>(<span class="fu">nrow</span>(dat)),</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>      <span class="cf">function</span>(x) {</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>        <span class="co"># We can make some rows have calls to `calc_egfr` and some just have</span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>        <span class="co"># values. This is just for demonstration, and one could instead have a</span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>        <span class="co"># simple list column composed entirely of calls.</span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>        <span class="cf">if</span>(x <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a>          <span class="fu">call</span>(<span class="st">&quot;calc_egfr&quot;</span>, <span class="at">cr =</span> <span class="fu">sample</span>(<span class="fu">seq</span>(<span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">0.1</span>), <span class="dv">1</span>))</span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a>          <span class="fu">sample</span>(<span class="dv">45</span><span class="sc">:</span><span class="dv">90</span>, <span class="dv">1</span>)</span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a>        }</span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a>      }</span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a>    ),</span>
<span id="cb20-16"><a href="#cb20-16" tabindex="-1"></a>    <span class="at">bmi =</span> <span class="fu">lapply</span>(</span>
<span id="cb20-17"><a href="#cb20-17" tabindex="-1"></a>      <span class="fu">seq_len</span>(<span class="fu">nrow</span>(dat)),</span>
<span id="cb20-18"><a href="#cb20-18" tabindex="-1"></a>      <span class="cf">function</span>(x) {</span>
<span id="cb20-19"><a href="#cb20-19" tabindex="-1"></a>        <span class="co"># The comment above for `egfr` applies here as well.</span></span>
<span id="cb20-20"><a href="#cb20-20" tabindex="-1"></a>        <span class="cf">if</span>(x <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb20-21"><a href="#cb20-21" tabindex="-1"></a>          <span class="fu">call</span>(</span>
<span id="cb20-22"><a href="#cb20-22" tabindex="-1"></a>            <span class="st">&quot;calc_bmi&quot;</span>, </span>
<span id="cb20-23"><a href="#cb20-23" tabindex="-1"></a>            <span class="at">height =</span> <span class="fu">sample</span>(<span class="dv">60</span><span class="sc">:</span><span class="dv">78</span>, <span class="dv">1</span>),</span>
<span id="cb20-24"><a href="#cb20-24" tabindex="-1"></a>            <span class="at">weight =</span> <span class="fu">sample</span>(<span class="dv">110</span><span class="sc">:</span><span class="dv">200</span>, <span class="dv">1</span>)</span>
<span id="cb20-25"><a href="#cb20-25" tabindex="-1"></a>          )</span>
<span id="cb20-26"><a href="#cb20-26" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb20-27"><a href="#cb20-27" tabindex="-1"></a>          <span class="fu">sample</span>(<span class="dv">20</span><span class="sc">:</span><span class="dv">38</span>, <span class="dv">1</span>)</span>
<span id="cb20-28"><a href="#cb20-28" tabindex="-1"></a>        }</span>
<span id="cb20-29"><a href="#cb20-29" tabindex="-1"></a>      }</span>
<span id="cb20-30"><a href="#cb20-30" tabindex="-1"></a>    )</span>
<span id="cb20-31"><a href="#cb20-31" tabindex="-1"></a>  )</span>
<span id="cb20-32"><a href="#cb20-32" tabindex="-1"></a></span>
<span id="cb20-33"><a href="#cb20-33" tabindex="-1"></a>res_with_calls_basic <span class="ot">&lt;-</span> <span class="fu">est_risk</span>(</span>
<span id="cb20-34"><a href="#cb20-34" tabindex="-1"></a>  <span class="at">use_dat =</span> dat_with_calls_basic, </span>
<span id="cb20-35"><a href="#cb20-35" tabindex="-1"></a>  <span class="at">progress =</span> <span class="cn">FALSE</span></span>
<span id="cb20-36"><a href="#cb20-36" tabindex="-1"></a>)</span>
<span id="cb20-37"><a href="#cb20-37" tabindex="-1"></a></span>
<span id="cb20-38"><a href="#cb20-38" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(res_with_calls_basic)</span></code></pre></div>
<table>
<colgroup>
<col width="4%" />
<col width="1%" />
<col width="2%" />
<col width="1%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="6%" />
<col width="12%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="1%" />
<col width="8%" />
<col width="3%" />
<col width="2%" />
<col width="4%" />
<col width="2%" />
<col width="2%" />
<col width="3%" />
<col width="3%" />
<col width="19%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">preventr_id</th>
<th align="right">age</th>
<th align="left">sex</th>
<th align="right">sbp</th>
<th align="left">bp_tx</th>
<th align="right">total_c</th>
<th align="right">hdl_c</th>
<th align="left">statin</th>
<th align="left">dm</th>
<th align="left">smoking</th>
<th align="left">egfr</th>
<th align="left">bmi</th>
<th align="right">hba1c</th>
<th align="right">uacr</th>
<th align="left">zip</th>
<th align="left">time</th>
<th align="left">model_input</th>
<th align="right">total_cvd</th>
<th align="right">ascvd</th>
<th align="right">heart_failure</th>
<th align="right">chd</th>
<th align="right">stroke</th>
<th align="left">model</th>
<th align="right">over_years</th>
<th align="left">input_problems</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">40</td>
<td align="left">female</td>
<td align="right">153</td>
<td align="left">FALSE</td>
<td align="right">204</td>
<td align="right">80</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">68</td>
<td align="left">20</td>
<td align="right">4.6</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">uacr , pce_both, Other</td>
<td align="right">0.025</td>
<td align="right">0.017</td>
<td align="right">0.017</td>
<td align="right">0.006</td>
<td align="right">0.013</td>
<td align="left">uacr</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">40</td>
<td align="left">female</td>
<td align="right">153</td>
<td align="left">FALSE</td>
<td align="right">204</td>
<td align="right">80</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">68</td>
<td align="left">20</td>
<td align="right">4.6</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">uacr , pce_both, Other</td>
<td align="right">NA</td>
<td align="right">0.008</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">pce_orig</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">40</td>
<td align="left">female</td>
<td align="right">153</td>
<td align="left">FALSE</td>
<td align="right">204</td>
<td align="right">80</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">68</td>
<td align="left">20</td>
<td align="right">4.6</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">uacr , pce_both, Other</td>
<td align="right">NA</td>
<td align="right">0.015</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">pce_rev</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">40</td>
<td align="left">female</td>
<td align="right">153</td>
<td align="left">FALSE</td>
<td align="right">204</td>
<td align="right">80</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">68</td>
<td align="left">20</td>
<td align="right">4.6</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">uacr , pce_both, Other</td>
<td align="right">0.183</td>
<td align="right">0.112</td>
<td align="right">0.139</td>
<td align="right">0.044</td>
<td align="right">0.078</td>
<td align="left">uacr</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">55</td>
<td align="left">male</td>
<td align="right">156</td>
<td align="left">FALSE</td>
<td align="right">282</td>
<td align="right">67</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">calc_egfr(cr = 0.6)</td>
<td align="left">calc_bmi(height = 60L, weight = 181L)</td>
<td align="right">12.2</td>
<td align="right">23040.0</td>
<td align="left">48708</td>
<td align="left">10yr</td>
<td align="left">NA</td>
<td align="right">0.468</td>
<td align="right">0.326</td>
<td align="right">0.451</td>
<td align="right">0.192</td>
<td align="right">0.193</td>
<td align="left">full</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">45</td>
<td align="left">female</td>
<td align="right">172</td>
<td align="left">FALSE</td>
<td align="right">276</td>
<td align="right">91</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">77</td>
<td align="left">22</td>
<td align="right">7.1</td>
<td align="right">NA</td>
<td align="left">98591</td>
<td align="left">both</td>
<td align="left">full , pce_rev, White</td>
<td align="right">0.058</td>
<td align="right">0.042</td>
<td align="right">0.048</td>
<td align="right">0.017</td>
<td align="right">0.027</td>
<td align="left">full</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">45</td>
<td align="left">female</td>
<td align="right">172</td>
<td align="left">FALSE</td>
<td align="right">276</td>
<td align="right">91</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">77</td>
<td align="left">22</td>
<td align="right">7.1</td>
<td align="right">NA</td>
<td align="left">98591</td>
<td align="left">both</td>
<td align="left">full , pce_rev, White</td>
<td align="right">NA</td>
<td align="right">0.108</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">pce_rev</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">45</td>
<td align="left">female</td>
<td align="right">172</td>
<td align="left">FALSE</td>
<td align="right">276</td>
<td align="right">91</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">77</td>
<td align="left">22</td>
<td align="right">7.1</td>
<td align="right">NA</td>
<td align="left">98591</td>
<td align="left">both</td>
<td align="left">full , pce_rev, White</td>
<td align="right">0.308</td>
<td align="right">0.208</td>
<td align="right">0.283</td>
<td align="right">0.096</td>
<td align="right">0.136</td>
<td align="left">full</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">51</td>
<td align="left">male</td>
<td align="right">169</td>
<td align="left">TRUE</td>
<td align="right">177</td>
<td align="right">88</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">calc_egfr(cr = 0.7)</td>
<td align="left">calc_bmi(height = 65L, weight = 165L)</td>
<td align="right">NA</td>
<td align="right">13289.2</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">NA</td>
<td align="right">0.300</td>
<td align="right">0.140</td>
<td align="right">0.283</td>
<td align="right">0.047</td>
<td align="right">0.142</td>
<td align="left">uacr</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">51</td>
<td align="left">male</td>
<td align="right">169</td>
<td align="left">TRUE</td>
<td align="right">177</td>
<td align="right">88</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">calc_egfr(cr = 0.7)</td>
<td align="left">calc_bmi(height = 65L, weight = 165L)</td>
<td align="right">NA</td>
<td align="right">13289.2</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">NA</td>
<td align="right">0.530</td>
<td align="right">0.282</td>
<td align="right">0.553</td>
<td align="right">0.106</td>
<td align="right">0.281</td>
<td align="left">uacr</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">52</td>
<td align="left">female</td>
<td align="right">160</td>
<td align="left">TRUE</td>
<td align="right">241</td>
<td align="right">95</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">80</td>
<td align="left">26</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">33321</td>
<td align="left">both</td>
<td align="left">hba1c , pce_rev, White</td>
<td align="right">0.051</td>
<td align="right">0.033</td>
<td align="right">0.041</td>
<td align="right">0.012</td>
<td align="right">0.022</td>
<td align="left">hba1c</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">52</td>
<td align="left">female</td>
<td align="right">160</td>
<td align="left">TRUE</td>
<td align="right">241</td>
<td align="right">95</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">80</td>
<td align="left">26</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">33321</td>
<td align="left">both</td>
<td align="left">hba1c , pce_rev, White</td>
<td align="right">NA</td>
<td align="right">0.060</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">pce_rev</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">52</td>
<td align="left">female</td>
<td align="right">160</td>
<td align="left">TRUE</td>
<td align="right">241</td>
<td align="right">95</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">80</td>
<td align="left">26</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">33321</td>
<td align="left">both</td>
<td align="left">hba1c , pce_rev, White</td>
<td align="right">0.255</td>
<td align="right">0.158</td>
<td align="right">0.223</td>
<td align="right">0.063</td>
<td align="right">0.106</td>
<td align="left">hba1c</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">58</td>
<td align="left">male</td>
<td align="right">171</td>
<td align="left">FALSE</td>
<td align="right">175</td>
<td align="right">36</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">calc_egfr(cr = 0.8)</td>
<td align="left">calc_bmi(height = 67L, weight = 169L)</td>
<td align="right">13.9</td>
<td align="right">9073.3</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">NA</td>
<td align="right">0.651</td>
<td align="right">0.441</td>
<td align="right">0.606</td>
<td align="right">0.342</td>
<td align="right">0.231</td>
<td align="left">full</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">6</td>
<td align="right">58</td>
<td align="left">male</td>
<td align="right">171</td>
<td align="left">FALSE</td>
<td align="right">175</td>
<td align="right">36</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">calc_egfr(cr = 0.8)</td>
<td align="left">calc_bmi(height = 67L, weight = 169L)</td>
<td align="right">13.9</td>
<td align="right">9073.3</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">NA</td>
<td align="right">0.737</td>
<td align="right">0.517</td>
<td align="right">0.684</td>
<td align="right">0.415</td>
<td align="right">0.284</td>
<td align="left">full</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">7</td>
<td align="right">57</td>
<td align="left">female</td>
<td align="right">95</td>
<td align="left">TRUE</td>
<td align="right">152</td>
<td align="right">64</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">49</td>
<td align="left">23</td>
<td align="right">5.6</td>
<td align="right">NA</td>
<td align="left">77642</td>
<td align="left">30yr</td>
<td align="left">sdi , pce_both, Black</td>
<td align="right">NA</td>
<td align="right">0.015</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">pce_orig</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">57</td>
<td align="left">female</td>
<td align="right">95</td>
<td align="left">TRUE</td>
<td align="right">152</td>
<td align="right">64</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">49</td>
<td align="left">23</td>
<td align="right">5.6</td>
<td align="right">NA</td>
<td align="left">77642</td>
<td align="left">30yr</td>
<td align="left">sdi , pce_both, Black</td>
<td align="right">NA</td>
<td align="right">0.013</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">pce_rev</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">7</td>
<td align="right">57</td>
<td align="left">female</td>
<td align="right">95</td>
<td align="left">TRUE</td>
<td align="right">152</td>
<td align="right">64</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">49</td>
<td align="left">23</td>
<td align="right">5.6</td>
<td align="right">NA</td>
<td align="left">77642</td>
<td align="left">30yr</td>
<td align="left">sdi , pce_both, Black</td>
<td align="right">0.263</td>
<td align="right">0.112</td>
<td align="right">0.218</td>
<td align="right">0.050</td>
<td align="right">0.073</td>
<td align="left">sdi</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">8</td>
<td align="right">36</td>
<td align="left">male</td>
<td align="right">175</td>
<td align="left">TRUE</td>
<td align="right">261</td>
<td align="right">82</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">calc_egfr(cr = 1.1)</td>
<td align="left">calc_bmi(height = 77L, weight = 122L)</td>
<td align="right">6.2</td>
<td align="right">4523.9</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">none</td>
<td align="right">NA</td>
<td align="left"><code>bmi</code> entered as 14.5, but must be between
18.5 and 39.9</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">36</td>
<td align="left">male</td>
<td align="right">175</td>
<td align="left">TRUE</td>
<td align="right">261</td>
<td align="right">82</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">calc_egfr(cr = 1.1)</td>
<td align="left">calc_bmi(height = 77L, weight = 122L)</td>
<td align="right">6.2</td>
<td align="right">4523.9</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">none</td>
<td align="right">NA</td>
<td align="left"><code>bmi</code> entered as 14.5, but must be between
18.5 and 39.9</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">49</td>
<td align="left">female</td>
<td align="right">121</td>
<td align="left">TRUE</td>
<td align="right">217</td>
<td align="right">50</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">54</td>
<td align="left">37</td>
<td align="right">NA</td>
<td align="right">6996.0</td>
<td align="left">NA</td>
<td align="left">30yr</td>
<td align="left">hba1c , pce_rev, Black</td>
<td align="right">NA</td>
<td align="right">0.045</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">pce_rev</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">9</td>
<td align="right">49</td>
<td align="left">female</td>
<td align="right">121</td>
<td align="left">TRUE</td>
<td align="right">217</td>
<td align="right">50</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">54</td>
<td align="left">37</td>
<td align="right">NA</td>
<td align="right">6996.0</td>
<td align="left">NA</td>
<td align="left">30yr</td>
<td align="left">hba1c , pce_rev, Black</td>
<td align="right">0.300</td>
<td align="right">0.166</td>
<td align="right">0.228</td>
<td align="right">0.092</td>
<td align="right">0.088</td>
<td align="left">hba1c</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">10</td>
<td align="right">47</td>
<td align="left">male</td>
<td align="right">160</td>
<td align="left">FALSE</td>
<td align="right">269</td>
<td align="right">45</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">calc_egfr(cr = 1.4)</td>
<td align="left">calc_bmi(height = 62L, weight = 190L)</td>
<td align="right">14.0</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">NA</td>
<td align="right">0.195</td>
<td align="right">0.151</td>
<td align="right">0.087</td>
<td align="right">0.090</td>
<td align="right">0.067</td>
<td align="left">hba1c</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">47</td>
<td align="left">male</td>
<td align="right">160</td>
<td align="left">FALSE</td>
<td align="right">269</td>
<td align="right">45</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">calc_egfr(cr = 1.4)</td>
<td align="left">calc_bmi(height = 62L, weight = 190L)</td>
<td align="right">14.0</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">NA</td>
<td align="right">0.572</td>
<td align="right">0.474</td>
<td align="right">0.352</td>
<td align="right">0.331</td>
<td align="right">0.257</td>
<td align="left">hba1c</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>The above scenario might be less realistic than something like having
columns in a data frame for creatinine in mg/dL or μmol/L, height in cm,
and weight in kg, and wanting to construct the calls from those. No
worries, this is also quite doable.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>dat_with_cr_cm_kg <span class="ot">&lt;-</span> dat_with_pce_requests <span class="sc">|&gt;</span> </span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>    <span class="co"># Let&#39;s use values for `cr` in mg/dL, `cm`, and `kg` that would yield the</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>    <span class="co"># values originally entered directly for `egfr` and `bmi` in</span></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>    <span class="co"># `make_vignette_dat()` to demonstrate identical results when using the</span></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>    <span class="co"># direct values for eGFR and BMI vs. using calls to the convenience</span></span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>    <span class="co"># functions. This is why the function `make_vignette_dat()` specifies values</span></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>    <span class="co"># for `age`, `sex`, `egfr`, and `bmi` directly while letting others vary</span></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a>    <span class="co"># randomly.</span></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a>    <span class="at">cr =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">1.2</span>, <span class="fl">0.9</span>, <span class="fl">1.2</span>, <span class="fl">0.9</span>, <span class="fl">1.2</span>, <span class="fl">0.8</span>, <span class="fl">1.1</span>, <span class="fl">0.9</span>, <span class="fl">1.3</span>),</span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a>    <span class="at">cm =</span> <span class="fu">c</span>(<span class="dv">199</span>, <span class="dv">182</span>, <span class="dv">184</span>, <span class="dv">197</span>, <span class="dv">189</span>, <span class="dv">187</span>, <span class="dv">191</span>, <span class="dv">163</span>, <span class="dv">199</span>, <span class="dv">171</span>),</span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a>    <span class="at">kg =</span> <span class="fu">c</span>(<span class="dv">148</span>, <span class="dv">109</span>, <span class="dv">127</span>, <span class="dv">111</span>, <span class="dv">134</span>, <span class="dv">126</span>, <span class="dv">134</span>, <span class="dv">76</span>, <span class="dv">74</span>, <span class="dv">113</span>),</span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a>    <span class="co"># Now, we&#39;ll create new list columns containing calls to calculate eGFR and</span></span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a>    <span class="co"># BMI (and remember, `dat_with_pce_requests` will already have columns for</span></span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a>    <span class="co"># `egfr` and `bmi`).</span></span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a>    <span class="at">egfr_call =</span> <span class="fu">lapply</span>(</span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a>      <span class="fu">seq_len</span>(<span class="fu">nrow</span>(dat_with_pce_requests)),</span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a>      <span class="cf">function</span>(x) {</span>
<span id="cb21-19"><a href="#cb21-19" tabindex="-1"></a>        <span class="fu">call</span>(<span class="st">&quot;calc_egfr&quot;</span>, <span class="at">cr =</span> cr[[x]])</span>
<span id="cb21-20"><a href="#cb21-20" tabindex="-1"></a>      }</span>
<span id="cb21-21"><a href="#cb21-21" tabindex="-1"></a>    ),</span>
<span id="cb21-22"><a href="#cb21-22" tabindex="-1"></a>    <span class="at">bmi_call =</span> <span class="fu">lapply</span>(</span>
<span id="cb21-23"><a href="#cb21-23" tabindex="-1"></a>      <span class="fu">seq_len</span>(<span class="fu">nrow</span>(dat_with_pce_requests)),</span>
<span id="cb21-24"><a href="#cb21-24" tabindex="-1"></a>      <span class="cf">function</span>(x) {</span>
<span id="cb21-25"><a href="#cb21-25" tabindex="-1"></a>        <span class="fu">call</span>(<span class="st">&quot;calc_bmi&quot;</span>, <span class="at">height =</span> cm[[x]], <span class="at">weight =</span> kg[[x]], <span class="at">units =</span> <span class="st">&quot;metric&quot;</span>)</span>
<span id="cb21-26"><a href="#cb21-26" tabindex="-1"></a>      }</span>
<span id="cb21-27"><a href="#cb21-27" tabindex="-1"></a>    )</span>
<span id="cb21-28"><a href="#cb21-28" tabindex="-1"></a>  )</span>
<span id="cb21-29"><a href="#cb21-29" tabindex="-1"></a></span>
<span id="cb21-30"><a href="#cb21-30" tabindex="-1"></a>res_with_calls <span class="ot">&lt;-</span> <span class="fu">est_risk</span>(</span>
<span id="cb21-31"><a href="#cb21-31" tabindex="-1"></a>  <span class="at">use_dat =</span> dat_with_cr_cm_kg, </span>
<span id="cb21-32"><a href="#cb21-32" tabindex="-1"></a>  <span class="co"># Instruct `est_risk()` to use the call columns, else it will default to</span></span>
<span id="cb21-33"><a href="#cb21-33" tabindex="-1"></a>  <span class="co"># grabbing values from `egfr` and `bmi`, which have direct values in them.</span></span>
<span id="cb21-34"><a href="#cb21-34" tabindex="-1"></a>  <span class="at">egfr =</span> <span class="st">&quot;egfr_call&quot;</span>, <span class="co"># Again, can pass column names as a character string ...</span></span>
<span id="cb21-35"><a href="#cb21-35" tabindex="-1"></a>  <span class="at">bmi =</span> bmi_call,     <span class="co"># ... or as a symbol</span></span>
<span id="cb21-36"><a href="#cb21-36" tabindex="-1"></a>  <span class="at">progress =</span> <span class="cn">FALSE</span></span>
<span id="cb21-37"><a href="#cb21-37" tabindex="-1"></a>)</span>
<span id="cb21-38"><a href="#cb21-38" tabindex="-1"></a></span>
<span id="cb21-39"><a href="#cb21-39" tabindex="-1"></a>res_without_calls <span class="ot">&lt;-</span> <span class="fu">est_risk</span>(</span>
<span id="cb21-40"><a href="#cb21-40" tabindex="-1"></a>  <span class="at">use_dat =</span> dat_with_cr_cm_kg,</span>
<span id="cb21-41"><a href="#cb21-41" tabindex="-1"></a>  <span class="co"># If you don&#39;t specify the call columns, `est_risk()` will default to using</span></span>
<span id="cb21-42"><a href="#cb21-42" tabindex="-1"></a>  <span class="co"># the columns `egfr` and `bmi`, which have the original, direct values for</span></span>
<span id="cb21-43"><a href="#cb21-43" tabindex="-1"></a>  <span class="co"># eGFR and BMI</span></span>
<span id="cb21-44"><a href="#cb21-44" tabindex="-1"></a>  <span class="at">progress =</span> <span class="cn">FALSE</span></span>
<span id="cb21-45"><a href="#cb21-45" tabindex="-1"></a>)</span>
<span id="cb21-46"><a href="#cb21-46" tabindex="-1"></a></span>
<span id="cb21-47"><a href="#cb21-47" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(res_with_calls)</span></code></pre></div>
<table>
<colgroup>
<col width="4%" />
<col width="1%" />
<col width="2%" />
<col width="1%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="1%" />
<col width="1%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="1%" />
<col width="8%" />
<col width="1%" />
<col width="1%" />
<col width="1%" />
<col width="6%" />
<col width="18%" />
<col width="3%" />
<col width="2%" />
<col width="4%" />
<col width="2%" />
<col width="2%" />
<col width="3%" />
<col width="3%" />
<col width="5%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">preventr_id</th>
<th align="right">age</th>
<th align="left">sex</th>
<th align="right">sbp</th>
<th align="left">bp_tx</th>
<th align="right">total_c</th>
<th align="right">hdl_c</th>
<th align="left">statin</th>
<th align="left">dm</th>
<th align="left">smoking</th>
<th align="right">egfr</th>
<th align="right">bmi</th>
<th align="right">hba1c</th>
<th align="right">uacr</th>
<th align="left">zip</th>
<th align="left">time</th>
<th align="left">model_input</th>
<th align="right">cr</th>
<th align="right">cm</th>
<th align="right">kg</th>
<th align="left">egfr_call</th>
<th align="left">bmi_call</th>
<th align="right">total_cvd</th>
<th align="right">ascvd</th>
<th align="right">heart_failure</th>
<th align="right">chd</th>
<th align="right">stroke</th>
<th align="left">model</th>
<th align="right">over_years</th>
<th align="left">input_problems</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">40</td>
<td align="left">female</td>
<td align="right">153</td>
<td align="left">FALSE</td>
<td align="right">204</td>
<td align="right">80</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">73</td>
<td align="right">37.4</td>
<td align="right">4.6</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">uacr , pce_both, Other</td>
<td align="right">1.0</td>
<td align="right">199</td>
<td align="right">148</td>
<td align="left">calc_egfr(cr = 1)</td>
<td align="left">calc_bmi(height = 199, weight = 148, units =
“metric”)</td>
<td align="right">0.025</td>
<td align="right">0.017</td>
<td align="right">0.026</td>
<td align="right">0.006</td>
<td align="right">0.012</td>
<td align="left">uacr</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">40</td>
<td align="left">female</td>
<td align="right">153</td>
<td align="left">FALSE</td>
<td align="right">204</td>
<td align="right">80</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">73</td>
<td align="right">37.4</td>
<td align="right">4.6</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">uacr , pce_both, Other</td>
<td align="right">1.0</td>
<td align="right">199</td>
<td align="right">148</td>
<td align="left">calc_egfr(cr = 1)</td>
<td align="left">calc_bmi(height = 199, weight = 148, units =
“metric”)</td>
<td align="right">NA</td>
<td align="right">0.008</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">pce_orig</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">40</td>
<td align="left">female</td>
<td align="right">153</td>
<td align="left">FALSE</td>
<td align="right">204</td>
<td align="right">80</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">73</td>
<td align="right">37.4</td>
<td align="right">4.6</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">uacr , pce_both, Other</td>
<td align="right">1.0</td>
<td align="right">199</td>
<td align="right">148</td>
<td align="left">calc_egfr(cr = 1)</td>
<td align="left">calc_bmi(height = 199, weight = 148, units =
“metric”)</td>
<td align="right">NA</td>
<td align="right">0.015</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">pce_rev</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">40</td>
<td align="left">female</td>
<td align="right">153</td>
<td align="left">FALSE</td>
<td align="right">204</td>
<td align="right">80</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">73</td>
<td align="right">37.4</td>
<td align="right">4.6</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">uacr , pce_both, Other</td>
<td align="right">1.0</td>
<td align="right">199</td>
<td align="right">148</td>
<td align="left">calc_egfr(cr = 1)</td>
<td align="left">calc_bmi(height = 199, weight = 148, units =
“metric”)</td>
<td align="right">0.180</td>
<td align="right">0.110</td>
<td align="right">0.210</td>
<td align="right">0.044</td>
<td align="right">0.077</td>
<td align="left">uacr</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">55</td>
<td align="left">male</td>
<td align="right">156</td>
<td align="left">FALSE</td>
<td align="right">282</td>
<td align="right">67</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">71</td>
<td align="right">32.9</td>
<td align="right">12.2</td>
<td align="right">23040.0</td>
<td align="left">48708</td>
<td align="left">10yr</td>
<td align="left">NA</td>
<td align="right">1.2</td>
<td align="right">182</td>
<td align="right">109</td>
<td align="left">calc_egfr(cr = 1.2)</td>
<td align="left">calc_bmi(height = 182, weight = 109, units =
“metric”)</td>
<td align="right">0.474</td>
<td align="right">0.336</td>
<td align="right">0.420</td>
<td align="right">0.198</td>
<td align="right">0.201</td>
<td align="left">full</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">45</td>
<td align="left">female</td>
<td align="right">172</td>
<td align="left">FALSE</td>
<td align="right">276</td>
<td align="right">91</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">80</td>
<td align="right">37.5</td>
<td align="right">7.1</td>
<td align="right">NA</td>
<td align="left">98591</td>
<td align="left">both</td>
<td align="left">full , pce_rev, White</td>
<td align="right">0.9</td>
<td align="right">184</td>
<td align="right">127</td>
<td align="left">calc_egfr(cr = 0.9)</td>
<td align="left">calc_bmi(height = 184, weight = 127, units =
“metric”)</td>
<td align="right">0.057</td>
<td align="right">0.042</td>
<td align="right">0.068</td>
<td align="right">0.017</td>
<td align="right">0.027</td>
<td align="left">full</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">45</td>
<td align="left">female</td>
<td align="right">172</td>
<td align="left">FALSE</td>
<td align="right">276</td>
<td align="right">91</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">80</td>
<td align="right">37.5</td>
<td align="right">7.1</td>
<td align="right">NA</td>
<td align="left">98591</td>
<td align="left">both</td>
<td align="left">full , pce_rev, White</td>
<td align="right">0.9</td>
<td align="right">184</td>
<td align="right">127</td>
<td align="left">calc_egfr(cr = 0.9)</td>
<td align="left">calc_bmi(height = 184, weight = 127, units =
“metric”)</td>
<td align="right">NA</td>
<td align="right">0.108</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">pce_rev</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">45</td>
<td align="left">female</td>
<td align="right">172</td>
<td align="left">FALSE</td>
<td align="right">276</td>
<td align="right">91</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">80</td>
<td align="right">37.5</td>
<td align="right">7.1</td>
<td align="right">NA</td>
<td align="left">98591</td>
<td align="left">both</td>
<td align="left">full , pce_rev, White</td>
<td align="right">0.9</td>
<td align="right">184</td>
<td align="right">127</td>
<td align="left">calc_egfr(cr = 0.9)</td>
<td align="left">calc_bmi(height = 184, weight = 127, units =
“metric”)</td>
<td align="right">0.305</td>
<td align="right">0.206</td>
<td align="right">0.377</td>
<td align="right">0.095</td>
<td align="right">0.134</td>
<td align="left">full</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">51</td>
<td align="left">male</td>
<td align="right">169</td>
<td align="left">TRUE</td>
<td align="right">177</td>
<td align="right">88</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">73</td>
<td align="right">28.6</td>
<td align="right">NA</td>
<td align="right">13289.2</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">NA</td>
<td align="right">1.2</td>
<td align="right">197</td>
<td align="right">111</td>
<td align="left">calc_egfr(cr = 1.2)</td>
<td align="left">calc_bmi(height = 197, weight = 111, units =
“metric”)</td>
<td align="right">0.305</td>
<td align="right">0.144</td>
<td align="right">0.288</td>
<td align="right">0.049</td>
<td align="right">0.146</td>
<td align="left">uacr</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">51</td>
<td align="left">male</td>
<td align="right">169</td>
<td align="left">TRUE</td>
<td align="right">177</td>
<td align="right">88</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">73</td>
<td align="right">28.6</td>
<td align="right">NA</td>
<td align="right">13289.2</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">NA</td>
<td align="right">1.2</td>
<td align="right">197</td>
<td align="right">111</td>
<td align="left">calc_egfr(cr = 1.2)</td>
<td align="left">calc_bmi(height = 197, weight = 111, units =
“metric”)</td>
<td align="right">0.565</td>
<td align="right">0.313</td>
<td align="right">0.592</td>
<td align="right">0.120</td>
<td align="right">0.309</td>
<td align="left">uacr</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">52</td>
<td align="left">female</td>
<td align="right">160</td>
<td align="left">TRUE</td>
<td align="right">241</td>
<td align="right">95</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">77</td>
<td align="right">37.5</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">33321</td>
<td align="left">both</td>
<td align="left">hba1c , pce_rev, White</td>
<td align="right">0.9</td>
<td align="right">189</td>
<td align="right">134</td>
<td align="left">calc_egfr(cr = 0.9)</td>
<td align="left">calc_bmi(height = 189, weight = 134, units =
“metric”)</td>
<td align="right">0.052</td>
<td align="right">0.033</td>
<td align="right">0.062</td>
<td align="right">0.012</td>
<td align="right">0.023</td>
<td align="left">hba1c</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">52</td>
<td align="left">female</td>
<td align="right">160</td>
<td align="left">TRUE</td>
<td align="right">241</td>
<td align="right">95</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">77</td>
<td align="right">37.5</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">33321</td>
<td align="left">both</td>
<td align="left">hba1c , pce_rev, White</td>
<td align="right">0.9</td>
<td align="right">189</td>
<td align="right">134</td>
<td align="left">calc_egfr(cr = 0.9)</td>
<td align="left">calc_bmi(height = 189, weight = 134, units =
“metric”)</td>
<td align="right">NA</td>
<td align="right">0.060</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">pce_rev</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">52</td>
<td align="left">female</td>
<td align="right">160</td>
<td align="left">TRUE</td>
<td align="right">241</td>
<td align="right">95</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">77</td>
<td align="right">37.5</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">33321</td>
<td align="left">both</td>
<td align="left">hba1c , pce_rev, White</td>
<td align="right">0.9</td>
<td align="right">189</td>
<td align="right">134</td>
<td align="left">calc_egfr(cr = 0.9)</td>
<td align="left">calc_bmi(height = 189, weight = 134, units =
“metric”)</td>
<td align="right">0.257</td>
<td align="right">0.159</td>
<td align="right">0.307</td>
<td align="right">0.063</td>
<td align="right">0.108</td>
<td align="left">hba1c</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">58</td>
<td align="left">male</td>
<td align="right">171</td>
<td align="left">FALSE</td>
<td align="right">175</td>
<td align="right">36</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">70</td>
<td align="right">36.0</td>
<td align="right">13.9</td>
<td align="right">9073.3</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">NA</td>
<td align="right">1.2</td>
<td align="right">187</td>
<td align="right">126</td>
<td align="left">calc_egfr(cr = 1.2)</td>
<td align="left">calc_bmi(height = 187, weight = 126, units =
“metric”)</td>
<td align="right">0.656</td>
<td align="right">0.449</td>
<td align="right">0.697</td>
<td align="right">0.348</td>
<td align="right">0.238</td>
<td align="left">full</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">6</td>
<td align="right">58</td>
<td align="left">male</td>
<td align="right">171</td>
<td align="left">FALSE</td>
<td align="right">175</td>
<td align="right">36</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">70</td>
<td align="right">36.0</td>
<td align="right">13.9</td>
<td align="right">9073.3</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">NA</td>
<td align="right">1.2</td>
<td align="right">187</td>
<td align="right">126</td>
<td align="left">calc_egfr(cr = 1.2)</td>
<td align="left">calc_bmi(height = 187, weight = 126, units =
“metric”)</td>
<td align="right">0.760</td>
<td align="right">0.549</td>
<td align="right">0.778</td>
<td align="right">0.444</td>
<td align="right">0.311</td>
<td align="left">full</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">7</td>
<td align="right">57</td>
<td align="left">female</td>
<td align="right">95</td>
<td align="left">TRUE</td>
<td align="right">152</td>
<td align="right">64</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">86</td>
<td align="right">36.7</td>
<td align="right">5.6</td>
<td align="right">NA</td>
<td align="left">77642</td>
<td align="left">30yr</td>
<td align="left">sdi , pce_both, Black</td>
<td align="right">0.8</td>
<td align="right">191</td>
<td align="right">134</td>
<td align="left">calc_egfr(cr = 0.8)</td>
<td align="left">calc_bmi(height = 191, weight = 134, units =
“metric”)</td>
<td align="right">NA</td>
<td align="right">0.015</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">pce_orig</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">57</td>
<td align="left">female</td>
<td align="right">95</td>
<td align="left">TRUE</td>
<td align="right">152</td>
<td align="right">64</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">86</td>
<td align="right">36.7</td>
<td align="right">5.6</td>
<td align="right">NA</td>
<td align="left">77642</td>
<td align="left">30yr</td>
<td align="left">sdi , pce_both, Black</td>
<td align="right">0.8</td>
<td align="right">191</td>
<td align="right">134</td>
<td align="left">calc_egfr(cr = 0.8)</td>
<td align="left">calc_bmi(height = 191, weight = 134, units =
“metric”)</td>
<td align="right">NA</td>
<td align="right">0.013</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">pce_rev</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">7</td>
<td align="right">57</td>
<td align="left">female</td>
<td align="right">95</td>
<td align="left">TRUE</td>
<td align="right">152</td>
<td align="right">64</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">86</td>
<td align="right">36.7</td>
<td align="right">5.6</td>
<td align="right">NA</td>
<td align="left">77642</td>
<td align="left">30yr</td>
<td align="left">sdi , pce_both, Black</td>
<td align="right">0.8</td>
<td align="right">191</td>
<td align="right">134</td>
<td align="left">calc_egfr(cr = 0.8)</td>
<td align="left">calc_bmi(height = 191, weight = 134, units =
“metric”)</td>
<td align="right">0.224</td>
<td align="right">0.098</td>
<td align="right">0.234</td>
<td align="right">0.044</td>
<td align="right">0.063</td>
<td align="left">sdi</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">8</td>
<td align="right">36</td>
<td align="left">male</td>
<td align="right">175</td>
<td align="left">TRUE</td>
<td align="right">261</td>
<td align="right">82</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">89</td>
<td align="right">28.6</td>
<td align="right">6.2</td>
<td align="right">4523.9</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">NA</td>
<td align="right">1.1</td>
<td align="right">163</td>
<td align="right">76</td>
<td align="left">calc_egfr(cr = 1.1)</td>
<td align="left">calc_bmi(height = 163, weight = 76, units =
“metric”)</td>
<td align="right">0.138</td>
<td align="right">0.073</td>
<td align="right">0.085</td>
<td align="right">0.026</td>
<td align="right">0.060</td>
<td align="left">full</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">36</td>
<td align="left">male</td>
<td align="right">175</td>
<td align="left">TRUE</td>
<td align="right">261</td>
<td align="right">82</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">89</td>
<td align="right">28.6</td>
<td align="right">6.2</td>
<td align="right">4523.9</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">NA</td>
<td align="right">1.1</td>
<td align="right">163</td>
<td align="right">76</td>
<td align="left">calc_egfr(cr = 1.1)</td>
<td align="left">calc_bmi(height = 163, weight = 76, units =
“metric”)</td>
<td align="right">0.386</td>
<td align="right">0.221</td>
<td align="right">0.295</td>
<td align="right">0.085</td>
<td align="right">0.185</td>
<td align="left">full</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">49</td>
<td align="left">female</td>
<td align="right">121</td>
<td align="left">TRUE</td>
<td align="right">217</td>
<td align="right">50</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">78</td>
<td align="right">18.7</td>
<td align="right">NA</td>
<td align="right">6996.0</td>
<td align="left">NA</td>
<td align="left">30yr</td>
<td align="left">hba1c , pce_rev, Black</td>
<td align="right">0.9</td>
<td align="right">199</td>
<td align="right">74</td>
<td align="left">calc_egfr(cr = 0.9)</td>
<td align="left">calc_bmi(height = 199, weight = 74, units =
“metric”)</td>
<td align="right">NA</td>
<td align="right">0.045</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">pce_rev</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">9</td>
<td align="right">49</td>
<td align="left">female</td>
<td align="right">121</td>
<td align="left">TRUE</td>
<td align="right">217</td>
<td align="right">50</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">78</td>
<td align="right">18.7</td>
<td align="right">NA</td>
<td align="right">6996.0</td>
<td align="left">NA</td>
<td align="left">30yr</td>
<td align="left">hba1c , pce_rev, Black</td>
<td align="right">0.9</td>
<td align="right">199</td>
<td align="right">74</td>
<td align="left">calc_egfr(cr = 0.9)</td>
<td align="left">calc_bmi(height = 199, weight = 74, units =
“metric”)</td>
<td align="right">0.264</td>
<td align="right">0.149</td>
<td align="right">0.126</td>
<td align="right">0.082</td>
<td align="right">0.078</td>
<td align="left">hba1c</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">10</td>
<td align="right">47</td>
<td align="left">male</td>
<td align="right">160</td>
<td align="left">FALSE</td>
<td align="right">269</td>
<td align="right">45</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">68</td>
<td align="right">38.6</td>
<td align="right">14.0</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">NA</td>
<td align="right">1.3</td>
<td align="right">171</td>
<td align="right">113</td>
<td align="left">calc_egfr(cr = 1.3)</td>
<td align="left">calc_bmi(height = 171, weight = 113, units =
“metric”)</td>
<td align="right">0.193</td>
<td align="right">0.150</td>
<td align="right">0.111</td>
<td align="right">0.089</td>
<td align="right">0.066</td>
<td align="left">hba1c</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">47</td>
<td align="left">male</td>
<td align="right">160</td>
<td align="left">FALSE</td>
<td align="right">269</td>
<td align="right">45</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">68</td>
<td align="right">38.6</td>
<td align="right">14.0</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">NA</td>
<td align="right">1.3</td>
<td align="right">171</td>
<td align="right">113</td>
<td align="left">calc_egfr(cr = 1.3)</td>
<td align="left">calc_bmi(height = 171, weight = 113, units =
“metric”)</td>
<td align="right">0.566</td>
<td align="right">0.468</td>
<td align="right">0.397</td>
<td align="right">0.326</td>
<td align="right">0.253</td>
<td align="left">hba1c</td>
<td align="right">30</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="fu">identical</span>(res_with_calls, res_without_calls)  </span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
</div>
<div id="i-dont-want-to-use-use_dat-and-add_to_dat" class="section level2">
<h2>I don’t want to use <code>use_dat</code> and
<code>add_to_dat</code></h2>
<div id="then-dont" class="section level3">
<h3>Then don’t!</h3>
<p>Perhaps you’ve already created a workflow and don’t want to update it
to incorporate <code>use_dat</code> or <code>add_to_dat</code>. Perhaps
your use case requires some more nuanced intermediate steps that
wouldn’t work in conjunction with this new functionality. Perhaps you
just vehemently dislike this functionality for some reason (though,
admittedly, I would be curious to hear your reasons if this is you; feel
free to get in touch). Whatever the case may be, you can still use
<code>est_risk()</code> in the same way as before. And this includes
being able to use a data frame with <code>est_risk()</code>. The
arguments <code>use_dat</code> and <code>add_to_dat</code> just likely
make many workflows more streamlined. But for example, you can still use
<code>est_risk()</code> with base R solutions like <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/lapply.html">lapply()</a>
or (the perhaps lesser-known) <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/funprog.html">Map()</a>,
or tidyverse solutions like those found in the <a href="https://purrr.tidyverse.org/">purrr</a> package.</p>
<p>Before we start, let’s remind ourselves what
<code>dat_with_cr_cm_kg</code> looks like.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(dat_with_cr_cm_kg))</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="1%" />
<col width="3%" />
<col width="1%" />
<col width="2%" />
<col width="3%" />
<col width="2%" />
<col width="3%" />
<col width="2%" />
<col width="3%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="3%" />
<col width="2%" />
<col width="2%" />
<col width="12%" />
<col width="1%" />
<col width="1%" />
<col width="1%" />
<col width="9%" />
<col width="26%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">age</th>
<th align="left">sex</th>
<th align="right">sbp</th>
<th align="left">bp_tx</th>
<th align="right">total_c</th>
<th align="right">hdl_c</th>
<th align="left">statin</th>
<th align="left">dm</th>
<th align="left">smoking</th>
<th align="right">egfr</th>
<th align="right">bmi</th>
<th align="right">hba1c</th>
<th align="right">uacr</th>
<th align="left">zip</th>
<th align="left">time</th>
<th align="left">model</th>
<th align="right">cr</th>
<th align="right">cm</th>
<th align="right">kg</th>
<th align="left">egfr_call</th>
<th align="left">bmi_call</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">40</td>
<td align="left">female</td>
<td align="right">153</td>
<td align="left">FALSE</td>
<td align="right">204</td>
<td align="right">80</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">73</td>
<td align="right">37.4</td>
<td align="right">4.6</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">uacr , pce_both, Other</td>
<td align="right">1.0</td>
<td align="right">199</td>
<td align="right">148</td>
<td align="left">calc_egfr(cr = 1)</td>
<td align="left">calc_bmi(height = 199, weight = 148, units =
“metric”)</td>
</tr>
<tr class="even">
<td align="right">55</td>
<td align="left">male</td>
<td align="right">156</td>
<td align="left">FALSE</td>
<td align="right">282</td>
<td align="right">67</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">71</td>
<td align="right">32.9</td>
<td align="right">12.2</td>
<td align="right">23040.0</td>
<td align="left">48708</td>
<td align="left">10yr</td>
<td align="left">NA</td>
<td align="right">1.2</td>
<td align="right">182</td>
<td align="right">109</td>
<td align="left">calc_egfr(cr = 1.2)</td>
<td align="left">calc_bmi(height = 182, weight = 109, units =
“metric”)</td>
</tr>
<tr class="odd">
<td align="right">45</td>
<td align="left">female</td>
<td align="right">172</td>
<td align="left">FALSE</td>
<td align="right">276</td>
<td align="right">91</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">80</td>
<td align="right">37.5</td>
<td align="right">7.1</td>
<td align="right">NA</td>
<td align="left">98591</td>
<td align="left">both</td>
<td align="left">full , pce_rev, White</td>
<td align="right">0.9</td>
<td align="right">184</td>
<td align="right">127</td>
<td align="left">calc_egfr(cr = 0.9)</td>
<td align="left">calc_bmi(height = 184, weight = 127, units =
“metric”)</td>
</tr>
<tr class="even">
<td align="right">51</td>
<td align="left">male</td>
<td align="right">169</td>
<td align="left">TRUE</td>
<td align="right">177</td>
<td align="right">88</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">73</td>
<td align="right">28.6</td>
<td align="right">NA</td>
<td align="right">13289.2</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">NA</td>
<td align="right">1.2</td>
<td align="right">197</td>
<td align="right">111</td>
<td align="left">calc_egfr(cr = 1.2)</td>
<td align="left">calc_bmi(height = 197, weight = 111, units =
“metric”)</td>
</tr>
<tr class="odd">
<td align="right">52</td>
<td align="left">female</td>
<td align="right">160</td>
<td align="left">TRUE</td>
<td align="right">241</td>
<td align="right">95</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">77</td>
<td align="right">37.5</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">33321</td>
<td align="left">both</td>
<td align="left">hba1c , pce_rev, White</td>
<td align="right">0.9</td>
<td align="right">189</td>
<td align="right">134</td>
<td align="left">calc_egfr(cr = 0.9)</td>
<td align="left">calc_bmi(height = 189, weight = 134, units =
“metric”)</td>
</tr>
<tr class="even">
<td align="right">58</td>
<td align="left">male</td>
<td align="right">171</td>
<td align="left">FALSE</td>
<td align="right">175</td>
<td align="right">36</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">70</td>
<td align="right">36.0</td>
<td align="right">13.9</td>
<td align="right">9073.3</td>
<td align="left">NA</td>
<td align="left">both</td>
<td align="left">NA</td>
<td align="right">1.2</td>
<td align="right">187</td>
<td align="right">126</td>
<td align="left">calc_egfr(cr = 1.2)</td>
<td align="left">calc_bmi(height = 187, weight = 126, units =
“metric”)</td>
</tr>
</tbody>
</table>
</div>
<div id="lapply" class="section level3">
<h3><code>lapply()</code></h3>
<p>Now, let’s use good old <code>lapply()</code> with
<code>dat_with_cr_cm_kg</code> and <code>est_risk()</code>.</p>
<p>(As a brief aside, you could also certainly use a good old
<code>for()</code> loop here instead of <code>lapply()</code>. Although
I do not give a direct demonstration of using a <code>for()</code> loop
in this vignette, the examples using <code>lapply()</code> should make
it clear how you could do this with a <code>for()</code> loop if you
prefer that for some reason. Just make sure you’ve taken care of
pre-allocation. This isn’t a <em>requirement</em>, but it’s good
practice and helps with performance in general.)</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="co"># First, add `preventr_id` to data frame for joining later, then move it to the</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="co"># first position.</span></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>dat_with_cr_cm_kg <span class="ot">&lt;-</span> dat_with_cr_cm_kg <span class="sc">|&gt;</span> </span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">preventr_id =</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(dat))) <span class="sc">|&gt;</span> </span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(preventr_id)</span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a>res_basic_lapply <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a>  <span class="co"># Using the row numbers of `dat_with_cr_cm_kg` as `x` in `function(x)`...</span></span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a>  <span class="fu">seq_len</span>(<span class="fu">nrow</span>(dat_with_cr_cm_kg)),</span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a>  <span class="cf">function</span>(x) {</span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a>    <span class="co"># ... run `est_risk()` on each row of `dat_with_cr_cm_kg`</span></span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a>    <span class="fu">est_risk</span>(</span>
<span id="cb24-13"><a href="#cb24-13" tabindex="-1"></a>      <span class="at">age =</span> dat_with_cr_cm_kg[[<span class="st">&quot;age&quot;</span>]][[x]],</span>
<span id="cb24-14"><a href="#cb24-14" tabindex="-1"></a>      <span class="at">sex =</span> dat_with_cr_cm_kg[[<span class="st">&quot;sex&quot;</span>]][[x]],</span>
<span id="cb24-15"><a href="#cb24-15" tabindex="-1"></a>      <span class="at">sbp =</span> dat_with_cr_cm_kg[[<span class="st">&quot;sbp&quot;</span>]][[x]],</span>
<span id="cb24-16"><a href="#cb24-16" tabindex="-1"></a>      <span class="at">bp_tx =</span> dat_with_cr_cm_kg[[<span class="st">&quot;bp_tx&quot;</span>]][[x]],</span>
<span id="cb24-17"><a href="#cb24-17" tabindex="-1"></a>      <span class="at">total_c =</span> dat_with_cr_cm_kg[[<span class="st">&quot;total_c&quot;</span>]][[x]],</span>
<span id="cb24-18"><a href="#cb24-18" tabindex="-1"></a>      <span class="at">hdl_c =</span> dat_with_cr_cm_kg[[<span class="st">&quot;hdl_c&quot;</span>]][[x]],</span>
<span id="cb24-19"><a href="#cb24-19" tabindex="-1"></a>      <span class="at">statin =</span> dat_with_cr_cm_kg[[<span class="st">&quot;statin&quot;</span>]][[x]],</span>
<span id="cb24-20"><a href="#cb24-20" tabindex="-1"></a>      <span class="at">dm =</span> dat_with_cr_cm_kg[[<span class="st">&quot;dm&quot;</span>]][[x]],</span>
<span id="cb24-21"><a href="#cb24-21" tabindex="-1"></a>      <span class="at">smoking =</span> dat_with_cr_cm_kg[[<span class="st">&quot;smoking&quot;</span>]][[x]],</span>
<span id="cb24-22"><a href="#cb24-22" tabindex="-1"></a>      <span class="at">egfr =</span> dat_with_cr_cm_kg[[<span class="st">&quot;egfr&quot;</span>]][[x]],</span>
<span id="cb24-23"><a href="#cb24-23" tabindex="-1"></a>      <span class="at">bmi =</span> dat_with_cr_cm_kg[[<span class="st">&quot;bmi&quot;</span>]][[x]],</span>
<span id="cb24-24"><a href="#cb24-24" tabindex="-1"></a>      <span class="at">hba1c =</span> dat_with_cr_cm_kg[[<span class="st">&quot;hba1c&quot;</span>]][[x]],</span>
<span id="cb24-25"><a href="#cb24-25" tabindex="-1"></a>      <span class="at">uacr =</span> dat_with_cr_cm_kg[[<span class="st">&quot;uacr&quot;</span>]][[x]],</span>
<span id="cb24-26"><a href="#cb24-26" tabindex="-1"></a>      <span class="at">zip =</span> dat_with_cr_cm_kg[[<span class="st">&quot;zip&quot;</span>]][[x]],</span>
<span id="cb24-27"><a href="#cb24-27" tabindex="-1"></a>      <span class="at">model =</span> dat_with_cr_cm_kg[[<span class="st">&quot;model&quot;</span>]][[x]],</span>
<span id="cb24-28"><a href="#cb24-28" tabindex="-1"></a>      <span class="at">time =</span> dat_with_cr_cm_kg[[<span class="st">&quot;time&quot;</span>]][[x]],</span>
<span id="cb24-29"><a href="#cb24-29" tabindex="-1"></a>      <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb24-30"><a href="#cb24-30" tabindex="-1"></a>    )  <span class="sc">|&gt;</span></span>
<span id="cb24-31"><a href="#cb24-31" tabindex="-1"></a>      <span class="co"># Bind the rows of the return from `est_risk()` together.</span></span>
<span id="cb24-32"><a href="#cb24-32" tabindex="-1"></a>      <span class="co"># (Side note: You can skip this step if you call `est_risk()` with</span></span>
<span id="cb24-33"><a href="#cb24-33" tabindex="-1"></a>      <span class="co"># `collapse = TRUE`.)</span></span>
<span id="cb24-34"><a href="#cb24-34" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">bind_rows</span>() <span class="sc">|&gt;</span></span>
<span id="cb24-35"><a href="#cb24-35" tabindex="-1"></a>      <span class="co"># Add column `preventr_id` to facilitate reassociation with the input</span></span>
<span id="cb24-36"><a href="#cb24-36" tabindex="-1"></a>      <span class="co"># data frame.</span></span>
<span id="cb24-37"><a href="#cb24-37" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">preventr_id =</span> x)</span>
<span id="cb24-38"><a href="#cb24-38" tabindex="-1"></a>  }</span>
<span id="cb24-39"><a href="#cb24-39" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb24-40"><a href="#cb24-40" tabindex="-1"></a>  <span class="co"># Bind all the results from the `lapply()` call together to make a</span></span>
<span id="cb24-41"><a href="#cb24-41" tabindex="-1"></a>  <span class="co"># single data frame.</span></span>
<span id="cb24-42"><a href="#cb24-42" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>() <span class="sc">|&gt;</span> </span>
<span id="cb24-43"><a href="#cb24-43" tabindex="-1"></a>  <span class="co"># Finally, do a quick left join to match the results with their</span></span>
<span id="cb24-44"><a href="#cb24-44" tabindex="-1"></a>  <span class="co"># corresponding input row in `dat_with_cr_cm_kg`.</span></span>
<span id="cb24-45"><a href="#cb24-45" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb24-46"><a href="#cb24-46" tabindex="-1"></a>    <span class="at">x =</span> dat_with_cr_cm_kg, </span>
<span id="cb24-47"><a href="#cb24-47" tabindex="-1"></a>    <span class="at">y =</span> _, </span>
<span id="cb24-48"><a href="#cb24-48" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">&quot;preventr_id&quot;</span>,</span>
<span id="cb24-49"><a href="#cb24-49" tabindex="-1"></a>    <span class="co"># Because both data frames will have a column named `model`, we&#39;ll provide</span></span>
<span id="cb24-50"><a href="#cb24-50" tabindex="-1"></a>    <span class="co"># suffixes to distinguish them. The suffixes below will cause the column </span></span>
<span id="cb24-51"><a href="#cb24-51" tabindex="-1"></a>    <span class="co"># `model` in `dat_with_cr_cm_kg` to be renamed to `model_input` and column</span></span>
<span id="cb24-52"><a href="#cb24-52" tabindex="-1"></a>    <span class="co"># `model` in the data frame from the pipe sequence (represented via `_`) </span></span>
<span id="cb24-53"><a href="#cb24-53" tabindex="-1"></a>    <span class="co"># retaining the same name.</span></span>
<span id="cb24-54"><a href="#cb24-54" tabindex="-1"></a>    <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;_input&quot;</span>, <span class="st">&quot;&quot;</span>)  </span>
<span id="cb24-55"><a href="#cb24-55" tabindex="-1"></a>  )</span>
<span id="cb24-56"><a href="#cb24-56" tabindex="-1"></a></span>
<span id="cb24-57"><a href="#cb24-57" tabindex="-1"></a><span class="co"># If all has proceeded as it should&#39;ve, `res_basic_lapply` should be identical</span></span>
<span id="cb24-58"><a href="#cb24-58" tabindex="-1"></a><span class="co"># to `res_without_calls` (and thus also to `res_with_calls`) from the above </span></span>
<span id="cb24-59"><a href="#cb24-59" tabindex="-1"></a><span class="co"># example (spoiler, it will be).</span></span>
<span id="cb24-60"><a href="#cb24-60" tabindex="-1"></a><span class="fu">identical</span>(res_basic_lapply, res_without_calls)</span>
<span id="cb24-61"><a href="#cb24-61" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>As somewhat of a quick side note, repeatedly calling
<code>dat_with_cr_cm_kg[[&quot;{var}&quot;]][[x]]</code> in the
<code>lapply()</code> call above is relatively inefficient vs. doing
something like:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="fu">with</span>(</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>  dat_with_cr_cm_kg[x, ],</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>  <span class="fu">est_risk</span>(</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>    <span class="at">age =</span> age,</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>    <span class="at">sex =</span> sex,</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>    ...</span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>  )</span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>)</span></code></pre></div>
<p>However, <code>dat_with_cr_cm_kg[[&quot;{var}&quot;]][[x]]</code> is at least
unambiguous, whereas using <code>with()</code> requires understanding
its data-masking feature.</p>
<p>I used the more verbose approach for the initial
<code>lapply()</code> call for a reason, namely to show variations in
approach that might be used. Subsequent <code>lapply()</code> calls will
in fact make use of <code>with()</code>.</p>
<p>In addition to reading the <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/with.html">documentation
for the <code>with()</code> function</a>, you can read more about data
masking <a href="https://rlang.r-lib.org/reference/topic-data-mask.html">here (from
the rlang package)</a> if interested.</p>
<p>To show some other variants using <code>lapply()</code>, I’m going to
delve into the concept of metaprogramming just a wee bit. Hadley
Wickham’s <a href="https://adv-r.hadley.nz/index.html">Advanced R</a>
has some excellent content about this in the <a href="https://adv-r.hadley.nz/metaprogramming.html">metaprogramming
section</a>, and the tidyverse team has supported such efforts with the
fantastic <a href="https://rlang.r-lib.org/">rlang package</a>. However,
I’m actually just going to use base R functions here.</p>
<p>In what follows, I define a function that allows us to alter (1) the
first argument in the call to <code>with()</code> and (2) the arguments
passed to the <code>est_risk()</code> call inside the
<code>lapply()</code> call.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>do_lapply_and_join <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, with_arg, ..., <span class="at">eval =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>  </span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">substitute</span>(dat)</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a>  with_arg <span class="ot">&lt;-</span> <span class="fu">substitute</span>(with_arg)</span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a>  dots <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">substitute</span>(<span class="fu">alist</span>(...)))</span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>  </span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>  mini_cl <span class="ot">&lt;-</span> <span class="fu">bquote</span>(</span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a>    {</span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a>      <span class="fu">lapply</span>(</span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a>        <span class="co"># Using the row numbers of `.(dat)` as `x` in `function(x)`...</span></span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a>        <span class="fu">seq_len</span>(<span class="fu">nrow</span>(.(dat))),</span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a>        <span class="cf">function</span>(x) {</span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a>          <span class="fu">with</span>(</span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a>            <span class="co"># With the data mask contained in `with_arg` ...</span></span>
<span id="cb26-15"><a href="#cb26-15" tabindex="-1"></a>            .(with_arg),</span>
<span id="cb26-16"><a href="#cb26-16" tabindex="-1"></a>              <span class="co"># ... run `est_risk()` with the arguments contained within `dots`.</span></span>
<span id="cb26-17"><a href="#cb26-17" tabindex="-1"></a>              <span class="fu">est_risk</span>(<span class="fu">..</span>(dots)) </span>
<span id="cb26-18"><a href="#cb26-18" tabindex="-1"></a>          ) <span class="sc">|&gt;</span></span>
<span id="cb26-19"><a href="#cb26-19" tabindex="-1"></a>            <span class="co"># The vast majority of the following is nearly identical to the</span></span>
<span id="cb26-20"><a href="#cb26-20" tabindex="-1"></a>            <span class="co"># basic `lapply()` example; it does not make any further use of </span></span>
<span id="cb26-21"><a href="#cb26-21" tabindex="-1"></a>            <span class="co"># metaprogramming unless otherwise noted.</span></span>
<span id="cb26-22"><a href="#cb26-22" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">bind_rows</span>() <span class="sc">|&gt;</span></span>
<span id="cb26-23"><a href="#cb26-23" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">preventr_id =</span> x)</span>
<span id="cb26-24"><a href="#cb26-24" tabindex="-1"></a>        }</span>
<span id="cb26-25"><a href="#cb26-25" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb26-26"><a href="#cb26-26" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">bind_rows</span>() <span class="sc">|&gt;</span> </span>
<span id="cb26-27"><a href="#cb26-27" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb26-28"><a href="#cb26-28" tabindex="-1"></a>          <span class="at">x =</span> .(dat),       <span class="co"># Note the use of `.(dat)` </span></span>
<span id="cb26-29"><a href="#cb26-29" tabindex="-1"></a>          <span class="at">y =</span> _, </span>
<span id="cb26-30"><a href="#cb26-30" tabindex="-1"></a>          <span class="at">by =</span> <span class="st">&quot;preventr_id&quot;</span>,</span>
<span id="cb26-31"><a href="#cb26-31" tabindex="-1"></a>          <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;_input&quot;</span>, <span class="st">&quot;&quot;</span>)  </span>
<span id="cb26-32"><a href="#cb26-32" tabindex="-1"></a>        )</span>
<span id="cb26-33"><a href="#cb26-33" tabindex="-1"></a>    },</span>
<span id="cb26-34"><a href="#cb26-34" tabindex="-1"></a>    <span class="at">splice =</span> <span class="cn">TRUE</span>           <span class="co"># This tells `bquote()` to splice anything in `..()`</span></span>
<span id="cb26-35"><a href="#cb26-35" tabindex="-1"></a>  )</span>
<span id="cb26-36"><a href="#cb26-36" tabindex="-1"></a>  </span>
<span id="cb26-37"><a href="#cb26-37" tabindex="-1"></a>  <span class="cf">if</span>(eval) <span class="fu">eval</span>(mini_cl, <span class="fu">parent.frame</span>()) <span class="cf">else</span> mini_cl</span>
<span id="cb26-38"><a href="#cb26-38" tabindex="-1"></a>}</span></code></pre></div>
<p>We can now use this “augmented” <code>lapply()</code> for further
demonstrations.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="co"># Let&#39;s start by showing results identical to `res_basic_lapply`.</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>res_aug_lapply <span class="ot">&lt;-</span> <span class="fu">do_lapply_and_join</span>(</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>  <span class="at">dat =</span> dat_with_cr_cm_kg,</span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>  <span class="at">with_arg =</span> dat_with_cr_cm_kg[x, ],</span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>  <span class="at">age =</span> age,</span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a>  <span class="at">sex =</span> sex,</span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a>  <span class="at">sbp =</span> sbp,</span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a>  <span class="at">bp_tx =</span> bp_tx,</span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a>  <span class="at">total_c =</span> total_c,</span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a>  <span class="at">hdl_c =</span> hdl_c,</span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a>  <span class="at">statin =</span> statin,</span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a>  <span class="at">dm =</span> dm,</span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a>  <span class="at">smoking =</span> smoking,</span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a>  <span class="at">egfr =</span> egfr,</span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a>  <span class="at">bmi =</span> bmi,</span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a>  <span class="at">hba1c =</span> hba1c,</span>
<span id="cb27-17"><a href="#cb27-17" tabindex="-1"></a>  <span class="at">uacr =</span> uacr,</span>
<span id="cb27-18"><a href="#cb27-18" tabindex="-1"></a>  <span class="at">zip =</span> zip,</span>
<span id="cb27-19"><a href="#cb27-19" tabindex="-1"></a>  <span class="co"># Because of the data mask passed via argument `with_arg`, the evaluation</span></span>
<span id="cb27-20"><a href="#cb27-20" tabindex="-1"></a>  <span class="co"># environment will be row x of the data frame (where x is defined within the</span></span>
<span id="cb27-21"><a href="#cb27-21" tabindex="-1"></a>  <span class="co"># `lapply()` call). Thus, `model` will still be a list column, so I need to</span></span>
<span id="cb27-22"><a href="#cb27-22" tabindex="-1"></a>  <span class="co"># get that list item out of the list column before passing it to</span></span>
<span id="cb27-23"><a href="#cb27-23" tabindex="-1"></a>  <span class="co"># `est_risk()`.</span></span>
<span id="cb27-24"><a href="#cb27-24" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb27-25"><a href="#cb27-25" tabindex="-1"></a>  <span class="co"># For `model`, I could instead do `unlist()`, but given this vignette also</span></span>
<span id="cb27-26"><a href="#cb27-26" tabindex="-1"></a>  <span class="co"># demonstrates list columns containing calls (where `unlist()` will not do),</span></span>
<span id="cb27-27"><a href="#cb27-27" tabindex="-1"></a>  <span class="co"># I will use `[[1]]` here for consistency. Note I can be confident the list</span></span>
<span id="cb27-28"><a href="#cb27-28" tabindex="-1"></a>  <span class="co"># item I need from the list column `model` is indeed the first (and only)</span></span>
<span id="cb27-29"><a href="#cb27-29" tabindex="-1"></a>  <span class="co"># list item, and the list item I extract via `[[1]]` will then either be</span></span>
<span id="cb27-30"><a href="#cb27-30" tabindex="-1"></a>  <span class="co"># `NA` or a list with list items `main_model`, `other_models`, and</span></span>
<span id="cb27-31"><a href="#cb27-31" tabindex="-1"></a>  <span class="co"># `race_eth` given how I created `dat_with_cr_cm_kg`.</span></span>
<span id="cb27-32"><a href="#cb27-32" tabindex="-1"></a>  <span class="at">model =</span> model[[<span class="dv">1</span>]],</span>
<span id="cb27-33"><a href="#cb27-33" tabindex="-1"></a>  <span class="at">time =</span> time,</span>
<span id="cb27-34"><a href="#cb27-34" tabindex="-1"></a>  <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb27-35"><a href="#cb27-35" tabindex="-1"></a>)</span></code></pre></div>
<p>Before we look at the results in <code>res_aug_lapply</code>, let’s
understand what the call to <code>do_lapply_and_join()</code> is doing.
With the above call, if we had instead set <code>eval = FALSE</code>, we
would have gotten the following:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="fu">lapply</span>(</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>  <span class="fu">seq_len</span>(<span class="fu">nrow</span>(dat_with_cr_cm_kg)),  <span class="co"># `dat_with_cr_cm_kg` replaces `.(dat)`</span></span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>  <span class="cf">function</span>(x) {</span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a>    <span class="fu">with</span>(</span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a>      dat_with_cr_cm_kg[x, ],        <span class="co"># `dat_with_cr_cm_kg[x, ]` replaces </span></span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a>      <span class="fu">est_risk</span>(                      <span class="co"># `.(with_arg)`</span></span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a>        <span class="at">age =</span> age,                   </span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a>        <span class="at">sex =</span> sex,                   <span class="co"># The arguments appearing in `est_risk()`</span></span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a>        <span class="at">sbp =</span> sbp,                   <span class="co"># were spliced into the call from `..(dots)`</span></span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a>        <span class="at">bp_tx =</span> bp_tx, </span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a>        <span class="at">total_c =</span> total_c, </span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a>        <span class="at">hdl_c =</span> hdl_c, </span>
<span id="cb28-13"><a href="#cb28-13" tabindex="-1"></a>        <span class="at">statin =</span> statin, </span>
<span id="cb28-14"><a href="#cb28-14" tabindex="-1"></a>        <span class="at">dm =</span> dm, </span>
<span id="cb28-15"><a href="#cb28-15" tabindex="-1"></a>        <span class="at">smoking =</span> smoking, </span>
<span id="cb28-16"><a href="#cb28-16" tabindex="-1"></a>        <span class="at">egfr =</span> egfr, </span>
<span id="cb28-17"><a href="#cb28-17" tabindex="-1"></a>        <span class="at">bmi =</span> bmi, </span>
<span id="cb28-18"><a href="#cb28-18" tabindex="-1"></a>        <span class="at">hba1c =</span> hba1c,</span>
<span id="cb28-19"><a href="#cb28-19" tabindex="-1"></a>        <span class="at">uacr =</span> uacr, </span>
<span id="cb28-20"><a href="#cb28-20" tabindex="-1"></a>        <span class="at">zip =</span> zip, </span>
<span id="cb28-21"><a href="#cb28-21" tabindex="-1"></a>        <span class="at">model =</span> model[[<span class="dv">1</span>]], </span>
<span id="cb28-22"><a href="#cb28-22" tabindex="-1"></a>        <span class="at">time =</span> time, </span>
<span id="cb28-23"><a href="#cb28-23" tabindex="-1"></a>        <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb28-24"><a href="#cb28-24" tabindex="-1"></a>      ) </span>
<span id="cb28-25"><a href="#cb28-25" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb28-26"><a href="#cb28-26" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">bind_rows</span>() <span class="sc">|&gt;</span></span>
<span id="cb28-27"><a href="#cb28-27" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">preventr_id =</span> x)</span>
<span id="cb28-28"><a href="#cb28-28" tabindex="-1"></a>  }</span>
<span id="cb28-29"><a href="#cb28-29" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb28-30"><a href="#cb28-30" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>() <span class="sc">|&gt;</span> </span>
<span id="cb28-31"><a href="#cb28-31" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb28-32"><a href="#cb28-32" tabindex="-1"></a>    <span class="at">x =</span> dat_with_cr_cm_kg,            <span class="co"># `dat_with_cr_cm_kg` replaces `.(dat)`</span></span>
<span id="cb28-33"><a href="#cb28-33" tabindex="-1"></a>    <span class="at">y =</span> _, </span>
<span id="cb28-34"><a href="#cb28-34" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">&quot;preventr_id&quot;</span>,</span>
<span id="cb28-35"><a href="#cb28-35" tabindex="-1"></a>    <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;_input&quot;</span>, <span class="st">&quot;&quot;</span>)  </span>
<span id="cb28-36"><a href="#cb28-36" tabindex="-1"></a>  )</span></code></pre></div>
<p>… but that’s only partly true, because the real return would have
been much harder to read due to the automatic formatting of the call and
how piping works (e.g., lots of nested calls). For the curious, the
<em>real</em> return (though functionally identical to the above) would
have actually been something like:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>{</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(<span class="at">x =</span> dat_with_cr_cm_kg, <span class="at">y =</span></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="fu">lapply</span>(<span class="fu">seq_len</span>(<span class="fu">nrow</span>(dat_with_cr_cm_kg)), </span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>        <span class="cf">function</span>(x) {</span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="fu">with</span>(dat_with_cr_cm_kg[x, </span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>                ], <span class="fu">est_risk</span>(<span class="at">age =</span> age, <span class="at">sex =</span> sex, <span class="at">sbp =</span> sbp, </span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>                <span class="at">bp_tx =</span> bp_tx, <span class="at">total_c =</span> total_c, <span class="at">hdl_c =</span> hdl_c, </span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>                <span class="at">statin =</span> statin, <span class="at">dm =</span> dm, <span class="at">smoking =</span> smoking, </span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a>                <span class="at">egfr =</span> egfr, <span class="at">bmi =</span> bmi, <span class="at">hba1c =</span> hba1c, <span class="at">uacr =</span> uacr, </span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a>                <span class="at">zip =</span> zip, <span class="at">model =</span> model[[<span class="dv">1</span>]], <span class="at">time =</span> time, <span class="at">quiet =</span> <span class="cn">TRUE</span>))), </span>
<span id="cb29-11"><a href="#cb29-11" tabindex="-1"></a>                <span class="at">preventr_id =</span> x)</span>
<span id="cb29-12"><a href="#cb29-12" tabindex="-1"></a>        })), <span class="at">by =</span> <span class="st">&quot;preventr_id&quot;</span>, <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;_input&quot;</span>, </span>
<span id="cb29-13"><a href="#cb29-13" tabindex="-1"></a>        <span class="st">&quot;&quot;</span>))</span>
<span id="cb29-14"><a href="#cb29-14" tabindex="-1"></a>}</span></code></pre></div>
<p>The point here is not to give an exhaustive (or exhausting!) vignette
on metaprogramming, so I’ll stop there. I just wanted to briefly show
what happens with the above function. With that under our belt, let’s
confirm identicality of results.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="fu">identical</span>(res_aug_lapply, res_basic_lapply)</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Let’s now look at some variations.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a>res_aug_lapply_variant <span class="ot">&lt;-</span> <span class="fu">do_lapply_and_join</span>(</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>  <span class="at">dat =</span> dat_with_cr_cm_kg,</span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>  <span class="at">with_arg =</span> dat_with_cr_cm_kg,</span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>  <span class="at">age =</span> age[[x]],</span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a>  <span class="at">sex =</span> sex[[x]],</span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a>  <span class="at">sbp =</span> sbp[[x]],</span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a>  <span class="at">bp_tx =</span> bp_tx[[x]],</span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a>  <span class="at">total_c =</span> total_c[[x]],</span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a>  <span class="at">hdl_c =</span> hdl_c[[x]],</span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a>  <span class="at">statin =</span> statin[[x]],</span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a>  <span class="at">dm =</span> dm[[x]],</span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a>  <span class="at">smoking =</span> smoking[[x]],</span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a>  <span class="at">egfr =</span> egfr[[x]],</span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a>  <span class="at">bmi =</span> bmi[[x]],</span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a>  <span class="at">hba1c =</span> hba1c[[x]],</span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a>  <span class="at">uacr =</span> uacr[[x]],</span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a>  <span class="at">zip =</span> zip[[x]],</span>
<span id="cb31-18"><a href="#cb31-18" tabindex="-1"></a>  <span class="at">model =</span> model[[x]],</span>
<span id="cb31-19"><a href="#cb31-19" tabindex="-1"></a>  <span class="at">time =</span> time[[x]],</span>
<span id="cb31-20"><a href="#cb31-20" tabindex="-1"></a>  <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb31-21"><a href="#cb31-21" tabindex="-1"></a>)</span>
<span id="cb31-22"><a href="#cb31-22" tabindex="-1"></a></span>
<span id="cb31-23"><a href="#cb31-23" tabindex="-1"></a><span class="fu">identical</span>(res_aug_lapply_variant, res_basic_lapply)</span>
<span id="cb31-24"><a href="#cb31-24" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Calls are fine as well.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>res_aug_lapply_with_calls <span class="ot">&lt;-</span> <span class="fu">do_lapply_and_join</span>(</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>  <span class="at">dat =</span> dat_with_cr_cm_kg,</span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>  <span class="at">with_arg =</span> dat_with_cr_cm_kg[x, ],</span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a>  <span class="at">age =</span> age,</span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a>  <span class="at">sex =</span> sex,</span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a>  <span class="at">sbp =</span> sbp,</span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a>  <span class="at">bp_tx =</span> bp_tx,</span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a>  <span class="at">total_c =</span> total_c,</span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a>  <span class="at">hdl_c =</span> hdl_c,</span>
<span id="cb32-10"><a href="#cb32-10" tabindex="-1"></a>  <span class="at">statin =</span> statin,</span>
<span id="cb32-11"><a href="#cb32-11" tabindex="-1"></a>  <span class="at">dm =</span> dm,</span>
<span id="cb32-12"><a href="#cb32-12" tabindex="-1"></a>  <span class="at">smoking =</span> smoking,</span>
<span id="cb32-13"><a href="#cb32-13" tabindex="-1"></a>  <span class="co"># If needed, review the comment associated with `res_aug_lapply` to understand</span></span>
<span id="cb32-14"><a href="#cb32-14" tabindex="-1"></a>  <span class="co"># why arguments `egfr`, `bmi`, and `model` are specified like this.</span></span>
<span id="cb32-15"><a href="#cb32-15" tabindex="-1"></a>  <span class="at">egfr =</span> egfr_call[[<span class="dv">1</span>]],</span>
<span id="cb32-16"><a href="#cb32-16" tabindex="-1"></a>  <span class="at">bmi =</span> bmi_call[[<span class="dv">1</span>]],</span>
<span id="cb32-17"><a href="#cb32-17" tabindex="-1"></a>  <span class="at">hba1c =</span> hba1c,</span>
<span id="cb32-18"><a href="#cb32-18" tabindex="-1"></a>  <span class="at">uacr =</span> uacr,</span>
<span id="cb32-19"><a href="#cb32-19" tabindex="-1"></a>  <span class="at">zip =</span> zip,</span>
<span id="cb32-20"><a href="#cb32-20" tabindex="-1"></a>  <span class="at">model =</span> model[[<span class="dv">1</span>]],</span>
<span id="cb32-21"><a href="#cb32-21" tabindex="-1"></a>  <span class="at">time =</span> time,</span>
<span id="cb32-22"><a href="#cb32-22" tabindex="-1"></a>  <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb32-23"><a href="#cb32-23" tabindex="-1"></a>)</span>
<span id="cb32-24"><a href="#cb32-24" tabindex="-1"></a></span>
<span id="cb32-25"><a href="#cb32-25" tabindex="-1"></a><span class="fu">identical</span>(res_aug_lapply_with_calls, res_basic_lapply)</span>
<span id="cb32-26"><a href="#cb32-26" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>You can construct calls in a more “on the fly” way as well.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>res_aug_lapply_with_calls_in_flight <span class="ot">&lt;-</span> <span class="fu">do_lapply_and_join</span>(</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>  <span class="at">dat =</span> dat_with_cr_cm_kg,</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>  <span class="at">with_arg =</span> dat_with_cr_cm_kg[x, ],</span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>  <span class="at">age =</span> age,</span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a>  <span class="at">sex =</span> sex,</span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a>  <span class="at">sbp =</span> sbp,</span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a>  <span class="at">bp_tx =</span> bp_tx,</span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a>  <span class="at">total_c =</span> total_c,</span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a>  <span class="at">hdl_c =</span> hdl_c,</span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a>  <span class="at">statin =</span> statin,</span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a>  <span class="at">dm =</span> dm,</span>
<span id="cb33-12"><a href="#cb33-12" tabindex="-1"></a>  <span class="at">smoking =</span> smoking,</span>
<span id="cb33-13"><a href="#cb33-13" tabindex="-1"></a>  <span class="at">egfr =</span> <span class="fu">call</span>(<span class="st">&quot;calc_egfr&quot;</span>, <span class="at">cr =</span> cr),</span>
<span id="cb33-14"><a href="#cb33-14" tabindex="-1"></a>  <span class="at">bmi =</span> <span class="fu">call</span>(<span class="st">&quot;calc_bmi&quot;</span>, <span class="at">height =</span> cm, <span class="at">weight =</span> kg, <span class="at">units =</span> <span class="st">&quot;metric&quot;</span>),</span>
<span id="cb33-15"><a href="#cb33-15" tabindex="-1"></a>  <span class="at">hba1c =</span> hba1c,</span>
<span id="cb33-16"><a href="#cb33-16" tabindex="-1"></a>  <span class="at">uacr =</span> uacr,</span>
<span id="cb33-17"><a href="#cb33-17" tabindex="-1"></a>  <span class="at">zip =</span> zip,</span>
<span id="cb33-18"><a href="#cb33-18" tabindex="-1"></a>  <span class="at">model =</span> model[[<span class="dv">1</span>]],</span>
<span id="cb33-19"><a href="#cb33-19" tabindex="-1"></a>  <span class="at">time =</span> time,</span>
<span id="cb33-20"><a href="#cb33-20" tabindex="-1"></a>  <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb33-21"><a href="#cb33-21" tabindex="-1"></a>)</span>
<span id="cb33-22"><a href="#cb33-22" tabindex="-1"></a></span>
<span id="cb33-23"><a href="#cb33-23" tabindex="-1"></a><span class="fu">identical</span>(res_aug_lapply_with_calls_in_flight, res_basic_lapply)</span>
<span id="cb33-24"><a href="#cb33-24" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>And of course, you can also pass optional behavior variables in the
call (again, this will override any column that might exist in the data
frame by the same name).</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>res_auto_opts_in_call <span class="ot">&lt;-</span> <span class="fu">est_risk</span>(</span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a>  <span class="at">use_dat =</span> dat_with_cr_cm_kg,</span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">&quot;base&quot;</span>,</span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a>  <span class="at">time =</span> <span class="st">&quot;10yr&quot;</span>,</span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a>  <span class="at">progress =</span> <span class="cn">FALSE</span></span>
<span id="cb34-6"><a href="#cb34-6" tabindex="-1"></a>)</span>
<span id="cb34-7"><a href="#cb34-7" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" tabindex="-1"></a>res_aug_lapply_opts_in_call <span class="ot">&lt;-</span> <span class="fu">do_lapply_and_join</span>(</span>
<span id="cb34-9"><a href="#cb34-9" tabindex="-1"></a>  <span class="at">dat =</span> dat_with_cr_cm_kg,</span>
<span id="cb34-10"><a href="#cb34-10" tabindex="-1"></a>  <span class="at">with_arg =</span> dat_with_cr_cm_kg[x, ],</span>
<span id="cb34-11"><a href="#cb34-11" tabindex="-1"></a>  <span class="at">age =</span> age,</span>
<span id="cb34-12"><a href="#cb34-12" tabindex="-1"></a>  <span class="at">sex =</span> sex,</span>
<span id="cb34-13"><a href="#cb34-13" tabindex="-1"></a>  <span class="at">sbp =</span> sbp,</span>
<span id="cb34-14"><a href="#cb34-14" tabindex="-1"></a>  <span class="at">bp_tx =</span> bp_tx,</span>
<span id="cb34-15"><a href="#cb34-15" tabindex="-1"></a>  <span class="at">total_c =</span> total_c,</span>
<span id="cb34-16"><a href="#cb34-16" tabindex="-1"></a>  <span class="at">hdl_c =</span> hdl_c,</span>
<span id="cb34-17"><a href="#cb34-17" tabindex="-1"></a>  <span class="at">statin =</span> statin,</span>
<span id="cb34-18"><a href="#cb34-18" tabindex="-1"></a>  <span class="at">dm =</span> dm,</span>
<span id="cb34-19"><a href="#cb34-19" tabindex="-1"></a>  <span class="at">smoking =</span> smoking,</span>
<span id="cb34-20"><a href="#cb34-20" tabindex="-1"></a>  <span class="at">egfr =</span> egfr,</span>
<span id="cb34-21"><a href="#cb34-21" tabindex="-1"></a>  <span class="at">bmi =</span> bmi,</span>
<span id="cb34-22"><a href="#cb34-22" tabindex="-1"></a>  <span class="at">hba1c =</span> hba1c,</span>
<span id="cb34-23"><a href="#cb34-23" tabindex="-1"></a>  <span class="at">uacr =</span> uacr,</span>
<span id="cb34-24"><a href="#cb34-24" tabindex="-1"></a>  <span class="at">zip =</span> zip,</span>
<span id="cb34-25"><a href="#cb34-25" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">&quot;base&quot;</span>,</span>
<span id="cb34-26"><a href="#cb34-26" tabindex="-1"></a>  <span class="at">time =</span> <span class="st">&quot;10yr&quot;</span>,</span>
<span id="cb34-27"><a href="#cb34-27" tabindex="-1"></a>  <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb34-28"><a href="#cb34-28" tabindex="-1"></a>)</span>
<span id="cb34-29"><a href="#cb34-29" tabindex="-1"></a></span>
<span id="cb34-30"><a href="#cb34-30" tabindex="-1"></a><span class="fu">identical</span>(res_auto_opts_in_call, res_aug_lapply_opts_in_call)</span>
<span id="cb34-31"><a href="#cb34-31" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<div id="map" class="section level3">
<h3><code>Map()</code></h3>
<p><code>est_risk()</code> also works with <code>Map()</code>.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a>do_map_and_join <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, ...) {</span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">preventr_id =</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(dat)))</span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a>  dots <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">substitute</span>(<span class="fu">alist</span>(...)))</span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a>  </span>
<span id="cb35-6"><a href="#cb35-6" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">eval</span>(</span>
<span id="cb35-7"><a href="#cb35-7" tabindex="-1"></a>    <span class="fu">bquote</span>(</span>
<span id="cb35-8"><a href="#cb35-8" tabindex="-1"></a>      <span class="co"># With the data mask introduced by `dat`, evaluate `Map()` with the</span></span>
<span id="cb35-9"><a href="#cb35-9" tabindex="-1"></a>      <span class="co"># function `est_risk()` and the arguments contained in `dots`.</span></span>
<span id="cb35-10"><a href="#cb35-10" tabindex="-1"></a>      <span class="co"># (In other words, call `est_risk()` with the arguments in `dots` for</span></span>
<span id="cb35-11"><a href="#cb35-11" tabindex="-1"></a>      <span class="co"># each row of `dat`.) </span></span>
<span id="cb35-12"><a href="#cb35-12" tabindex="-1"></a>      <span class="fu">with</span>(dat, <span class="fu">Map</span>(est_risk, <span class="fu">..</span>(dots))),</span>
<span id="cb35-13"><a href="#cb35-13" tabindex="-1"></a>      <span class="at">splice =</span> <span class="cn">TRUE</span></span>
<span id="cb35-14"><a href="#cb35-14" tabindex="-1"></a>    )</span>
<span id="cb35-15"><a href="#cb35-15" tabindex="-1"></a>  )</span>
<span id="cb35-16"><a href="#cb35-16" tabindex="-1"></a>  </span>
<span id="cb35-17"><a href="#cb35-17" tabindex="-1"></a>  <span class="co"># `res` from the above call to `Map()` will be a list, and the items in</span></span>
<span id="cb35-18"><a href="#cb35-18" tabindex="-1"></a>  <span class="co"># the list may also be a list (e.g., a list of data frames), as such, we&#39;ll</span></span>
<span id="cb35-19"><a href="#cb35-19" tabindex="-1"></a>  <span class="co"># need to iterate through `res` and bind the data frames together. We&#39;ll also</span></span>
<span id="cb35-20"><a href="#cb35-20" tabindex="-1"></a>  <span class="co"># need to add the `preventr_id` column.</span></span>
<span id="cb35-21"><a href="#cb35-21" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(res)) {</span>
<span id="cb35-22"><a href="#cb35-22" tabindex="-1"></a>    res[[i]] <span class="ot">&lt;-</span> res[[i]] <span class="sc">|&gt;</span> </span>
<span id="cb35-23"><a href="#cb35-23" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">bind_rows</span>() <span class="sc">|&gt;</span></span>
<span id="cb35-24"><a href="#cb35-24" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">preventr_id =</span> i) <span class="sc">|&gt;</span> </span>
<span id="cb35-25"><a href="#cb35-25" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">relocate</span>(preventr_id)</span>
<span id="cb35-26"><a href="#cb35-26" tabindex="-1"></a>  }</span>
<span id="cb35-27"><a href="#cb35-27" tabindex="-1"></a>  </span>
<span id="cb35-28"><a href="#cb35-28" tabindex="-1"></a>  <span class="co"># Now do the left join, detailed previously in this vignette.</span></span>
<span id="cb35-29"><a href="#cb35-29" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb35-30"><a href="#cb35-30" tabindex="-1"></a>      <span class="at">x =</span> dat, </span>
<span id="cb35-31"><a href="#cb35-31" tabindex="-1"></a>      <span class="at">y =</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(res), </span>
<span id="cb35-32"><a href="#cb35-32" tabindex="-1"></a>      <span class="at">by =</span> <span class="st">&quot;preventr_id&quot;</span>,</span>
<span id="cb35-33"><a href="#cb35-33" tabindex="-1"></a>      <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;_input&quot;</span>, <span class="st">&quot;&quot;</span>)  </span>
<span id="cb35-34"><a href="#cb35-34" tabindex="-1"></a>    )</span>
<span id="cb35-35"><a href="#cb35-35" tabindex="-1"></a>}</span>
<span id="cb35-36"><a href="#cb35-36" tabindex="-1"></a></span>
<span id="cb35-37"><a href="#cb35-37" tabindex="-1"></a>res_map <span class="ot">&lt;-</span> <span class="fu">do_map_and_join</span>(</span>
<span id="cb35-38"><a href="#cb35-38" tabindex="-1"></a>  dat_with_cr_cm_kg,</span>
<span id="cb35-39"><a href="#cb35-39" tabindex="-1"></a>  <span class="at">age =</span> age,</span>
<span id="cb35-40"><a href="#cb35-40" tabindex="-1"></a>  <span class="at">sex =</span> sex,</span>
<span id="cb35-41"><a href="#cb35-41" tabindex="-1"></a>  <span class="at">sbp =</span> sbp,</span>
<span id="cb35-42"><a href="#cb35-42" tabindex="-1"></a>  <span class="at">bp_tx =</span> bp_tx,</span>
<span id="cb35-43"><a href="#cb35-43" tabindex="-1"></a>  <span class="at">total_c =</span> total_c,</span>
<span id="cb35-44"><a href="#cb35-44" tabindex="-1"></a>  <span class="at">hdl_c =</span> hdl_c,</span>
<span id="cb35-45"><a href="#cb35-45" tabindex="-1"></a>  <span class="at">statin =</span> statin,</span>
<span id="cb35-46"><a href="#cb35-46" tabindex="-1"></a>  <span class="at">dm =</span> dm,</span>
<span id="cb35-47"><a href="#cb35-47" tabindex="-1"></a>  <span class="at">smoking =</span> smoking,</span>
<span id="cb35-48"><a href="#cb35-48" tabindex="-1"></a>  <span class="at">egfr =</span> egfr,</span>
<span id="cb35-49"><a href="#cb35-49" tabindex="-1"></a>  <span class="at">bmi =</span> bmi,</span>
<span id="cb35-50"><a href="#cb35-50" tabindex="-1"></a>  <span class="at">hba1c =</span> hba1c,</span>
<span id="cb35-51"><a href="#cb35-51" tabindex="-1"></a>  <span class="at">uacr =</span> uacr,</span>
<span id="cb35-52"><a href="#cb35-52" tabindex="-1"></a>  <span class="at">zip =</span> zip,</span>
<span id="cb35-53"><a href="#cb35-53" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">&quot;base&quot;</span>,</span>
<span id="cb35-54"><a href="#cb35-54" tabindex="-1"></a>  <span class="at">time =</span> <span class="st">&quot;10yr&quot;</span>,</span>
<span id="cb35-55"><a href="#cb35-55" tabindex="-1"></a>  <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb35-56"><a href="#cb35-56" tabindex="-1"></a>)</span>
<span id="cb35-57"><a href="#cb35-57" tabindex="-1"></a></span>
<span id="cb35-58"><a href="#cb35-58" tabindex="-1"></a><span class="fu">identical</span>(res_auto_opts_in_call, res_map)</span>
<span id="cb35-59"><a href="#cb35-59" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Let’s now look at some variants.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a>res_map_all_cols <span class="ot">&lt;-</span> <span class="fu">do_map_and_join</span>(</span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>  dat_with_cr_cm_kg,</span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a>  <span class="at">age =</span> age,</span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a>  <span class="at">sex =</span> sex,</span>
<span id="cb36-5"><a href="#cb36-5" tabindex="-1"></a>  <span class="at">sbp =</span> sbp,</span>
<span id="cb36-6"><a href="#cb36-6" tabindex="-1"></a>  <span class="at">bp_tx =</span> bp_tx,</span>
<span id="cb36-7"><a href="#cb36-7" tabindex="-1"></a>  <span class="at">total_c =</span> total_c,</span>
<span id="cb36-8"><a href="#cb36-8" tabindex="-1"></a>  <span class="at">hdl_c =</span> hdl_c,</span>
<span id="cb36-9"><a href="#cb36-9" tabindex="-1"></a>  <span class="at">statin =</span> statin,</span>
<span id="cb36-10"><a href="#cb36-10" tabindex="-1"></a>  <span class="at">dm =</span> dm,</span>
<span id="cb36-11"><a href="#cb36-11" tabindex="-1"></a>  <span class="at">smoking =</span> smoking,</span>
<span id="cb36-12"><a href="#cb36-12" tabindex="-1"></a>  <span class="co"># Note I&#39;m passing the call columns here, showing you can still use the</span></span>
<span id="cb36-13"><a href="#cb36-13" tabindex="-1"></a>  <span class="co"># convenience functions (stored as calls in list columns) with `Map()`.</span></span>
<span id="cb36-14"><a href="#cb36-14" tabindex="-1"></a>  <span class="at">egfr =</span> egfr_call,</span>
<span id="cb36-15"><a href="#cb36-15" tabindex="-1"></a>  <span class="at">bmi =</span> bmi_call,</span>
<span id="cb36-16"><a href="#cb36-16" tabindex="-1"></a>  <span class="at">hba1c =</span> hba1c,</span>
<span id="cb36-17"><a href="#cb36-17" tabindex="-1"></a>  <span class="at">uacr =</span> uacr,</span>
<span id="cb36-18"><a href="#cb36-18" tabindex="-1"></a>  <span class="at">zip =</span> zip,</span>
<span id="cb36-19"><a href="#cb36-19" tabindex="-1"></a>  <span class="at">model =</span> model,</span>
<span id="cb36-20"><a href="#cb36-20" tabindex="-1"></a>  <span class="at">time =</span> time,</span>
<span id="cb36-21"><a href="#cb36-21" tabindex="-1"></a>  <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb36-22"><a href="#cb36-22" tabindex="-1"></a>)</span>
<span id="cb36-23"><a href="#cb36-23" tabindex="-1"></a></span>
<span id="cb36-24"><a href="#cb36-24" tabindex="-1"></a><span class="fu">identical</span>(res_map_all_cols, res_basic_lapply)</span>
<span id="cb36-25"><a href="#cb36-25" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb36-26"><a href="#cb36-26" tabindex="-1"></a></span>
<span id="cb36-27"><a href="#cb36-27" tabindex="-1"></a><span class="co"># You can also pass applicable optional behavior variables.</span></span>
<span id="cb36-28"><a href="#cb36-28" tabindex="-1"></a>res_map_only_10yr_hba1c_not_quiet <span class="ot">&lt;-</span> <span class="fu">do_map_and_join</span>(</span>
<span id="cb36-29"><a href="#cb36-29" tabindex="-1"></a>  dat_with_cr_cm_kg,</span>
<span id="cb36-30"><a href="#cb36-30" tabindex="-1"></a>  <span class="at">age =</span> age,</span>
<span id="cb36-31"><a href="#cb36-31" tabindex="-1"></a>  <span class="at">sex =</span> sex,</span>
<span id="cb36-32"><a href="#cb36-32" tabindex="-1"></a>  <span class="at">sbp =</span> sbp,</span>
<span id="cb36-33"><a href="#cb36-33" tabindex="-1"></a>  <span class="at">bp_tx =</span> bp_tx,</span>
<span id="cb36-34"><a href="#cb36-34" tabindex="-1"></a>  <span class="at">total_c =</span> total_c,</span>
<span id="cb36-35"><a href="#cb36-35" tabindex="-1"></a>  <span class="at">hdl_c =</span> hdl_c,</span>
<span id="cb36-36"><a href="#cb36-36" tabindex="-1"></a>  <span class="at">statin =</span> statin,</span>
<span id="cb36-37"><a href="#cb36-37" tabindex="-1"></a>  <span class="at">dm =</span> dm,</span>
<span id="cb36-38"><a href="#cb36-38" tabindex="-1"></a>  <span class="at">smoking =</span> smoking,</span>
<span id="cb36-39"><a href="#cb36-39" tabindex="-1"></a>  <span class="at">egfr =</span> egfr_call,</span>
<span id="cb36-40"><a href="#cb36-40" tabindex="-1"></a>  <span class="at">bmi =</span> bmi_call,</span>
<span id="cb36-41"><a href="#cb36-41" tabindex="-1"></a>  <span class="at">hba1c =</span> hba1c,</span>
<span id="cb36-42"><a href="#cb36-42" tabindex="-1"></a>  <span class="at">uacr =</span> uacr,</span>
<span id="cb36-43"><a href="#cb36-43" tabindex="-1"></a>  <span class="at">zip =</span> zip,</span>
<span id="cb36-44"><a href="#cb36-44" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">&quot;hba1c&quot;</span>,</span>
<span id="cb36-45"><a href="#cb36-45" tabindex="-1"></a>  <span class="at">time =</span> <span class="st">&quot;10yr&quot;</span>,</span>
<span id="cb36-46"><a href="#cb36-46" tabindex="-1"></a>  <span class="at">quiet =</span> <span class="cn">FALSE</span></span>
<span id="cb36-47"><a href="#cb36-47" tabindex="-1"></a>)</span>
<span id="cb36-48"><a href="#cb36-48" tabindex="-1"></a><span class="co">#&gt; PREVENT estimates are from: Base model adding HbA1c.</span></span>
<span id="cb36-49"><a href="#cb36-49" tabindex="-1"></a><span class="co">#&gt; PREVENT estimates are from: Base model adding HbA1c.</span></span>
<span id="cb36-50"><a href="#cb36-50" tabindex="-1"></a><span class="co">#&gt; PREVENT estimates are from: Base model adding HbA1c.</span></span>
<span id="cb36-51"><a href="#cb36-51" tabindex="-1"></a><span class="co">#&gt; PREVENT estimates are from: Base model adding HbA1c.</span></span>
<span id="cb36-52"><a href="#cb36-52" tabindex="-1"></a><span class="co">#&gt; PREVENT estimates are from: Base model adding HbA1c.</span></span>
<span id="cb36-53"><a href="#cb36-53" tabindex="-1"></a><span class="co">#&gt; PREVENT estimates are from: Base model adding HbA1c.</span></span>
<span id="cb36-54"><a href="#cb36-54" tabindex="-1"></a><span class="co">#&gt; PREVENT estimates are from: Base model adding HbA1c.</span></span>
<span id="cb36-55"><a href="#cb36-55" tabindex="-1"></a><span class="co">#&gt; PREVENT estimates are from: Base model adding HbA1c.</span></span>
<span id="cb36-56"><a href="#cb36-56" tabindex="-1"></a><span class="co">#&gt; PREVENT estimates are from: Base model adding HbA1c.</span></span>
<span id="cb36-57"><a href="#cb36-57" tabindex="-1"></a><span class="co">#&gt; PREVENT estimates are from: Base model adding HbA1c.</span></span>
<span id="cb36-58"><a href="#cb36-58" tabindex="-1"></a></span>
<span id="cb36-59"><a href="#cb36-59" tabindex="-1"></a><span class="co"># Despite `dat_with_cr_cm_kg` having columns `time` and `model`, the `time` and</span></span>
<span id="cb36-60"><a href="#cb36-60" tabindex="-1"></a><span class="co"># `model` arguments in the call to `est_risk()` (via `Map()`) get priority.</span></span>
<span id="cb36-61"><a href="#cb36-61" tabindex="-1"></a>dat_with_cr_cm_kg[[<span class="st">&quot;model&quot;</span>]]</span>
<span id="cb36-62"><a href="#cb36-62" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb36-63"><a href="#cb36-63" tabindex="-1"></a><span class="co">#&gt; [[1]]$main_model</span></span>
<span id="cb36-64"><a href="#cb36-64" tabindex="-1"></a><span class="co">#&gt; [1] &quot;uacr&quot;</span></span>
<span id="cb36-65"><a href="#cb36-65" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-66"><a href="#cb36-66" tabindex="-1"></a><span class="co">#&gt; [[1]]$other_models</span></span>
<span id="cb36-67"><a href="#cb36-67" tabindex="-1"></a><span class="co">#&gt; [1] &quot;pce_both&quot;</span></span>
<span id="cb36-68"><a href="#cb36-68" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-69"><a href="#cb36-69" tabindex="-1"></a><span class="co">#&gt; [[1]]$race_eth</span></span>
<span id="cb36-70"><a href="#cb36-70" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Other&quot;</span></span>
<span id="cb36-71"><a href="#cb36-71" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-72"><a href="#cb36-72" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-73"><a href="#cb36-73" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb36-74"><a href="#cb36-74" tabindex="-1"></a><span class="co">#&gt; [1] NA</span></span>
<span id="cb36-75"><a href="#cb36-75" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-76"><a href="#cb36-76" tabindex="-1"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb36-77"><a href="#cb36-77" tabindex="-1"></a><span class="co">#&gt; [[3]]$main_model</span></span>
<span id="cb36-78"><a href="#cb36-78" tabindex="-1"></a><span class="co">#&gt; [1] &quot;full&quot;</span></span>
<span id="cb36-79"><a href="#cb36-79" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-80"><a href="#cb36-80" tabindex="-1"></a><span class="co">#&gt; [[3]]$other_models</span></span>
<span id="cb36-81"><a href="#cb36-81" tabindex="-1"></a><span class="co">#&gt; [1] &quot;pce_rev&quot;</span></span>
<span id="cb36-82"><a href="#cb36-82" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-83"><a href="#cb36-83" tabindex="-1"></a><span class="co">#&gt; [[3]]$race_eth</span></span>
<span id="cb36-84"><a href="#cb36-84" tabindex="-1"></a><span class="co">#&gt; [1] &quot;White&quot;</span></span>
<span id="cb36-85"><a href="#cb36-85" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-86"><a href="#cb36-86" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-87"><a href="#cb36-87" tabindex="-1"></a><span class="co">#&gt; [[4]]</span></span>
<span id="cb36-88"><a href="#cb36-88" tabindex="-1"></a><span class="co">#&gt; [1] NA</span></span>
<span id="cb36-89"><a href="#cb36-89" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-90"><a href="#cb36-90" tabindex="-1"></a><span class="co">#&gt; [[5]]</span></span>
<span id="cb36-91"><a href="#cb36-91" tabindex="-1"></a><span class="co">#&gt; [[5]]$main_model</span></span>
<span id="cb36-92"><a href="#cb36-92" tabindex="-1"></a><span class="co">#&gt; [1] &quot;hba1c&quot;</span></span>
<span id="cb36-93"><a href="#cb36-93" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-94"><a href="#cb36-94" tabindex="-1"></a><span class="co">#&gt; [[5]]$other_models</span></span>
<span id="cb36-95"><a href="#cb36-95" tabindex="-1"></a><span class="co">#&gt; [1] &quot;pce_rev&quot;</span></span>
<span id="cb36-96"><a href="#cb36-96" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-97"><a href="#cb36-97" tabindex="-1"></a><span class="co">#&gt; [[5]]$race_eth</span></span>
<span id="cb36-98"><a href="#cb36-98" tabindex="-1"></a><span class="co">#&gt; [1] &quot;White&quot;</span></span>
<span id="cb36-99"><a href="#cb36-99" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-100"><a href="#cb36-100" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-101"><a href="#cb36-101" tabindex="-1"></a><span class="co">#&gt; [[6]]</span></span>
<span id="cb36-102"><a href="#cb36-102" tabindex="-1"></a><span class="co">#&gt; [1] NA</span></span>
<span id="cb36-103"><a href="#cb36-103" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-104"><a href="#cb36-104" tabindex="-1"></a><span class="co">#&gt; [[7]]</span></span>
<span id="cb36-105"><a href="#cb36-105" tabindex="-1"></a><span class="co">#&gt; [[7]]$main_model</span></span>
<span id="cb36-106"><a href="#cb36-106" tabindex="-1"></a><span class="co">#&gt; [1] &quot;sdi&quot;</span></span>
<span id="cb36-107"><a href="#cb36-107" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-108"><a href="#cb36-108" tabindex="-1"></a><span class="co">#&gt; [[7]]$other_models</span></span>
<span id="cb36-109"><a href="#cb36-109" tabindex="-1"></a><span class="co">#&gt; [1] &quot;pce_both&quot;</span></span>
<span id="cb36-110"><a href="#cb36-110" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-111"><a href="#cb36-111" tabindex="-1"></a><span class="co">#&gt; [[7]]$race_eth</span></span>
<span id="cb36-112"><a href="#cb36-112" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Black&quot;</span></span>
<span id="cb36-113"><a href="#cb36-113" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-114"><a href="#cb36-114" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-115"><a href="#cb36-115" tabindex="-1"></a><span class="co">#&gt; [[8]]</span></span>
<span id="cb36-116"><a href="#cb36-116" tabindex="-1"></a><span class="co">#&gt; [1] NA</span></span>
<span id="cb36-117"><a href="#cb36-117" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-118"><a href="#cb36-118" tabindex="-1"></a><span class="co">#&gt; [[9]]</span></span>
<span id="cb36-119"><a href="#cb36-119" tabindex="-1"></a><span class="co">#&gt; [[9]]$main_model</span></span>
<span id="cb36-120"><a href="#cb36-120" tabindex="-1"></a><span class="co">#&gt; [1] &quot;hba1c&quot;</span></span>
<span id="cb36-121"><a href="#cb36-121" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-122"><a href="#cb36-122" tabindex="-1"></a><span class="co">#&gt; [[9]]$other_models</span></span>
<span id="cb36-123"><a href="#cb36-123" tabindex="-1"></a><span class="co">#&gt; [1] &quot;pce_rev&quot;</span></span>
<span id="cb36-124"><a href="#cb36-124" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-125"><a href="#cb36-125" tabindex="-1"></a><span class="co">#&gt; [[9]]$race_eth</span></span>
<span id="cb36-126"><a href="#cb36-126" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Black&quot;</span></span>
<span id="cb36-127"><a href="#cb36-127" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-128"><a href="#cb36-128" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-129"><a href="#cb36-129" tabindex="-1"></a><span class="co">#&gt; [[10]]</span></span>
<span id="cb36-130"><a href="#cb36-130" tabindex="-1"></a><span class="co">#&gt; [1] NA</span></span>
<span id="cb36-131"><a href="#cb36-131" tabindex="-1"></a>dat_with_cr_cm_kg[[<span class="st">&quot;time&quot;</span>]]</span>
<span id="cb36-132"><a href="#cb36-132" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;both&quot; &quot;10yr&quot; &quot;both&quot; &quot;both&quot; &quot;both&quot; &quot;both&quot; &quot;30yr&quot; &quot;both&quot; &quot;30yr&quot; &quot;both&quot;</span></span>
<span id="cb36-133"><a href="#cb36-133" tabindex="-1"></a></span>
<span id="cb36-134"><a href="#cb36-134" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">unique</span>(res_map_only_10yr_hba1c_not_quiet[[<span class="st">&quot;over_years&quot;</span>]]), <span class="dv">10</span>)</span>
<span id="cb36-135"><a href="#cb36-135" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb36-136"><a href="#cb36-136" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">unique</span>(res_map_only_10yr_hba1c_not_quiet[[<span class="st">&quot;model&quot;</span>]]), <span class="st">&quot;hba1c&quot;</span>)</span>
<span id="cb36-137"><a href="#cb36-137" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<div id="purrrpmap" class="section level3">
<h3><code>purrr::pmap()</code></h3>
<p>When calling <code>purrr::pmap()</code> with a bare call to the
function and the entire data frame, <code>purrr::pmap()</code> expects
either (1) no unused arguments (i.e., each column in the data frame will
match an argument in the function being mapped over), or (2) the unused
columns are absorbed by a <code>...</code> argument in the function over
which you are mapping. As such, we’ll need to slightly adjust the data
frame <code>dat_with_cr_cm_kg</code> to remove columns not corresponding
to an argument in <code>est_risk()</code>.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a>pmap_data_frame_approach <span class="ot">&lt;-</span> </span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a>  dat_with_cr_cm_kg <span class="sc">|&gt;</span></span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a>  <span class="co"># Remove columns not corresponding to an argument in `est_risk()`.</span></span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(preventr_id, cr, cm, kg, egfr_call, bmi_call)) <span class="sc">|&gt;</span> </span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">pmap</span>(est_risk)</span>
<span id="cb37-6"><a href="#cb37-6" tabindex="-1"></a><span class="co">#&gt; PREVENT estimates are from: Base model adding UACR.</span></span>
<span id="cb37-7"><a href="#cb37-7" tabindex="-1"></a><span class="co">#&gt; PREVENT estimates are from: Base model adding HbA1c, SDI, and UACR (also referred to as the full model).</span></span>
<span id="cb37-8"><a href="#cb37-8" tabindex="-1"></a><span class="co">#&gt; PREVENT estimates are from: Base model adding HbA1c, SDI, and UACR (also referred to as the full model).</span></span>
<span id="cb37-9"><a href="#cb37-9" tabindex="-1"></a><span class="co">#&gt; PREVENT estimates are from: Base model adding UACR.</span></span>
<span id="cb37-10"><a href="#cb37-10" tabindex="-1"></a><span class="co">#&gt; PREVENT estimates are from: Base model adding HbA1c.</span></span>
<span id="cb37-11"><a href="#cb37-11" tabindex="-1"></a><span class="co">#&gt; PREVENT estimates are from: Base model adding HbA1c, SDI, and UACR (also referred to as the full model).</span></span>
<span id="cb37-12"><a href="#cb37-12" tabindex="-1"></a><span class="co">#&gt; PREVENT estimates are from: Base model adding SDI.</span></span>
<span id="cb37-13"><a href="#cb37-13" tabindex="-1"></a><span class="co">#&gt; PREVENT estimates are from: Base model adding HbA1c, SDI, and UACR (also referred to as the full model).</span></span>
<span id="cb37-14"><a href="#cb37-14" tabindex="-1"></a><span class="co">#&gt; PREVENT estimates are from: Base model adding HbA1c.</span></span>
<span id="cb37-15"><a href="#cb37-15" tabindex="-1"></a><span class="co">#&gt; PREVENT estimates are from: Base model adding HbA1c.</span></span>
<span id="cb37-16"><a href="#cb37-16" tabindex="-1"></a></span>
<span id="cb37-17"><a href="#cb37-17" tabindex="-1"></a><span class="co"># Very similar to the `Map()` examples above, we&#39;ll need to bind the results</span></span>
<span id="cb37-18"><a href="#cb37-18" tabindex="-1"></a><span class="co"># from `purrr::pmap()` together and do some other minor actions, so I&#39;ve </span></span>
<span id="cb37-19"><a href="#cb37-19" tabindex="-1"></a><span class="co"># converted that into a mini-function to avoid repetition in these examples.</span></span>
<span id="cb37-20"><a href="#cb37-20" tabindex="-1"></a>combine_pmap_res_and_join <span class="ot">&lt;-</span> <span class="cf">function</span>(pmap_res, dat) {</span>
<span id="cb37-21"><a href="#cb37-21" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(pmap_res)) {</span>
<span id="cb37-22"><a href="#cb37-22" tabindex="-1"></a>    pmap_res[[i]] <span class="ot">&lt;-</span> pmap_res[[i]] <span class="sc">|&gt;</span> </span>
<span id="cb37-23"><a href="#cb37-23" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">bind_rows</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-24"><a href="#cb37-24" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">preventr_id =</span> i) <span class="sc">|&gt;</span> </span>
<span id="cb37-25"><a href="#cb37-25" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">relocate</span>(preventr_id)</span>
<span id="cb37-26"><a href="#cb37-26" tabindex="-1"></a>  }</span>
<span id="cb37-27"><a href="#cb37-27" tabindex="-1"></a>  </span>
<span id="cb37-28"><a href="#cb37-28" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb37-29"><a href="#cb37-29" tabindex="-1"></a>    <span class="at">x =</span> dat, </span>
<span id="cb37-30"><a href="#cb37-30" tabindex="-1"></a>    <span class="at">y =</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(pmap_res), </span>
<span id="cb37-31"><a href="#cb37-31" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">&quot;preventr_id&quot;</span>,</span>
<span id="cb37-32"><a href="#cb37-32" tabindex="-1"></a>    <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;_input&quot;</span>, <span class="st">&quot;&quot;</span>)  </span>
<span id="cb37-33"><a href="#cb37-33" tabindex="-1"></a>  )</span>
<span id="cb37-34"><a href="#cb37-34" tabindex="-1"></a>}</span>
<span id="cb37-35"><a href="#cb37-35" tabindex="-1"></a></span>
<span id="cb37-36"><a href="#cb37-36" tabindex="-1"></a>pmap_data_frame_approach <span class="ot">&lt;-</span> </span>
<span id="cb37-37"><a href="#cb37-37" tabindex="-1"></a>  <span class="fu">combine_pmap_res_and_join</span>(pmap_data_frame_approach, dat_with_cr_cm_kg)</span>
<span id="cb37-38"><a href="#cb37-38" tabindex="-1"></a></span>
<span id="cb37-39"><a href="#cb37-39" tabindex="-1"></a><span class="fu">identical</span>(pmap_data_frame_approach, res_basic_lapply)</span>
<span id="cb37-40"><a href="#cb37-40" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>As an alternative, you can leave the data frame alone, but pass
<code>purrr::pmap()</code> a more explicitly-delineated list for
argument <code>.l</code>.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a>pmap_list_approach <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">pmap</span>(</span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a>  <span class="fu">with</span>(</span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a>    dat_with_cr_cm_kg,</span>
<span id="cb38-4"><a href="#cb38-4" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb38-5"><a href="#cb38-5" tabindex="-1"></a>      <span class="at">age =</span> age,</span>
<span id="cb38-6"><a href="#cb38-6" tabindex="-1"></a>      <span class="at">sex =</span> sex,</span>
<span id="cb38-7"><a href="#cb38-7" tabindex="-1"></a>      <span class="at">sbp =</span> sbp,</span>
<span id="cb38-8"><a href="#cb38-8" tabindex="-1"></a>      <span class="at">bp_tx =</span> bp_tx,</span>
<span id="cb38-9"><a href="#cb38-9" tabindex="-1"></a>      <span class="at">total_c =</span> total_c,</span>
<span id="cb38-10"><a href="#cb38-10" tabindex="-1"></a>      <span class="at">hdl_c =</span> hdl_c,</span>
<span id="cb38-11"><a href="#cb38-11" tabindex="-1"></a>      <span class="at">statin =</span> statin,</span>
<span id="cb38-12"><a href="#cb38-12" tabindex="-1"></a>      <span class="at">dm =</span> dm,</span>
<span id="cb38-13"><a href="#cb38-13" tabindex="-1"></a>      <span class="at">smoking =</span> smoking,</span>
<span id="cb38-14"><a href="#cb38-14" tabindex="-1"></a>      <span class="at">egfr =</span> egfr,</span>
<span id="cb38-15"><a href="#cb38-15" tabindex="-1"></a>      <span class="at">bmi =</span> bmi,</span>
<span id="cb38-16"><a href="#cb38-16" tabindex="-1"></a>      <span class="at">hba1c =</span> hba1c,</span>
<span id="cb38-17"><a href="#cb38-17" tabindex="-1"></a>      <span class="at">uacr =</span> uacr,</span>
<span id="cb38-18"><a href="#cb38-18" tabindex="-1"></a>      <span class="at">zip =</span> zip,</span>
<span id="cb38-19"><a href="#cb38-19" tabindex="-1"></a>      <span class="at">model =</span> model,</span>
<span id="cb38-20"><a href="#cb38-20" tabindex="-1"></a>      <span class="at">time =</span> time,</span>
<span id="cb38-21"><a href="#cb38-21" tabindex="-1"></a>      <span class="co"># Note passing an explicitly-delineated list for argument `.l` allows us</span></span>
<span id="cb38-22"><a href="#cb38-22" tabindex="-1"></a>      <span class="co"># to easily specify the `quiet` argument here</span></span>
<span id="cb38-23"><a href="#cb38-23" tabindex="-1"></a>      <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb38-24"><a href="#cb38-24" tabindex="-1"></a>    )</span>
<span id="cb38-25"><a href="#cb38-25" tabindex="-1"></a>  ),</span>
<span id="cb38-26"><a href="#cb38-26" tabindex="-1"></a>  est_risk</span>
<span id="cb38-27"><a href="#cb38-27" tabindex="-1"></a>)</span>
<span id="cb38-28"><a href="#cb38-28" tabindex="-1"></a></span>
<span id="cb38-29"><a href="#cb38-29" tabindex="-1"></a>pmap_list_approach <span class="ot">&lt;-</span> </span>
<span id="cb38-30"><a href="#cb38-30" tabindex="-1"></a>  <span class="fu">combine_pmap_res_and_join</span>(pmap_list_approach, dat_with_cr_cm_kg)</span>
<span id="cb38-31"><a href="#cb38-31" tabindex="-1"></a></span>
<span id="cb38-32"><a href="#cb38-32" tabindex="-1"></a><span class="fu">identical</span>(pmap_list_approach, res_basic_lapply)</span>
<span id="cb38-33"><a href="#cb38-33" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Calls continue to be fine.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a>pmap_list_approach_with_call <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">pmap</span>(</span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a>  <span class="fu">with</span>(</span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a>    dat_with_cr_cm_kg,</span>
<span id="cb39-4"><a href="#cb39-4" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb39-5"><a href="#cb39-5" tabindex="-1"></a>      <span class="at">age =</span> age,</span>
<span id="cb39-6"><a href="#cb39-6" tabindex="-1"></a>      <span class="at">sex =</span> sex,</span>
<span id="cb39-7"><a href="#cb39-7" tabindex="-1"></a>      <span class="at">sbp =</span> sbp,</span>
<span id="cb39-8"><a href="#cb39-8" tabindex="-1"></a>      <span class="at">bp_tx =</span> bp_tx,</span>
<span id="cb39-9"><a href="#cb39-9" tabindex="-1"></a>      <span class="at">total_c =</span> total_c,</span>
<span id="cb39-10"><a href="#cb39-10" tabindex="-1"></a>      <span class="at">hdl_c =</span> hdl_c,</span>
<span id="cb39-11"><a href="#cb39-11" tabindex="-1"></a>      <span class="at">statin =</span> statin,</span>
<span id="cb39-12"><a href="#cb39-12" tabindex="-1"></a>      <span class="at">dm =</span> dm,</span>
<span id="cb39-13"><a href="#cb39-13" tabindex="-1"></a>      <span class="at">smoking =</span> smoking,</span>
<span id="cb39-14"><a href="#cb39-14" tabindex="-1"></a>      <span class="at">egfr =</span> egfr_call,</span>
<span id="cb39-15"><a href="#cb39-15" tabindex="-1"></a>      <span class="at">bmi =</span> bmi_call,</span>
<span id="cb39-16"><a href="#cb39-16" tabindex="-1"></a>      <span class="at">hba1c =</span> hba1c,</span>
<span id="cb39-17"><a href="#cb39-17" tabindex="-1"></a>      <span class="at">uacr =</span> uacr,</span>
<span id="cb39-18"><a href="#cb39-18" tabindex="-1"></a>      <span class="at">zip =</span> zip,</span>
<span id="cb39-19"><a href="#cb39-19" tabindex="-1"></a>      <span class="at">model =</span> model,</span>
<span id="cb39-20"><a href="#cb39-20" tabindex="-1"></a>      <span class="at">time =</span> time,</span>
<span id="cb39-21"><a href="#cb39-21" tabindex="-1"></a>      <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb39-22"><a href="#cb39-22" tabindex="-1"></a>    )</span>
<span id="cb39-23"><a href="#cb39-23" tabindex="-1"></a>  ),</span>
<span id="cb39-24"><a href="#cb39-24" tabindex="-1"></a>  est_risk</span>
<span id="cb39-25"><a href="#cb39-25" tabindex="-1"></a>)</span>
<span id="cb39-26"><a href="#cb39-26" tabindex="-1"></a></span>
<span id="cb39-27"><a href="#cb39-27" tabindex="-1"></a>pmap_list_approach_with_call <span class="ot">&lt;-</span> </span>
<span id="cb39-28"><a href="#cb39-28" tabindex="-1"></a>  <span class="fu">combine_pmap_res_and_join</span>(pmap_list_approach_with_call, dat_with_cr_cm_kg)</span>
<span id="cb39-29"><a href="#cb39-29" tabindex="-1"></a></span>
<span id="cb39-30"><a href="#cb39-30" tabindex="-1"></a><span class="fu">identical</span>(pmap_list_approach_with_call, res_basic_lapply)</span>
<span id="cb39-31"><a href="#cb39-31" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
</div>
<div id="wrap-up" class="section level2">
<h2>Wrap-up</h2>
<p>If you’ve made it this far, kudos on reading through the whole thing.
Admittedly, I didn’t anticipate this vignette getting this long when I
starting writing it, but here we are. I hope this has been helpful.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
